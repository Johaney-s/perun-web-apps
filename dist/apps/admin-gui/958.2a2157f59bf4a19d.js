"use strict";(self.webpackChunkadmin_gui=self.webpackChunkadmin_gui||[]).push([[958],{12958:(so,W,c)=>{c.r(W),c.d(W,{FacilitiesModule:()=>io});var m=c(36895),v=c(94364),tt=c(86353),q=c(36769),St=c(69024),f=c(32105),p=c(9244),d=c(69723),P=c(36792),Ct=c(54037),At=c(22158),It=c(82722),t=c(94650),u=c(65412),bt=c(77968),yt=c(15003),R=c(97392),C=c(4859),T=c(51572),U=c(10266),et=c(61283),vt=c(4235),h=c(89383);function xt(i,n){1&i&&t._UZ(0,"mat-spinner",3)}function Dt(i,n){if(1&i){const e=t.EpF();t.TgZ(0,"button",12),t.NdJ("click",function(){t.CHM(e);const a=t.oxw(2);return t.KtG(a.editFacility())}),t.TgZ(1,"mat-icon"),t._uU(2,"edit"),t.qZA()()}}function Et(i,n){if(1&i){const e=t.EpF();t.TgZ(0,"button",12),t.NdJ("click",function(){t.CHM(e);const a=t.oxw(2);return t.KtG(a.deleteFacility())}),t.TgZ(1,"mat-icon"),t._uU(2,"delete_forever"),t.qZA()()}}const Lt=function(){return{color:"black"}},Zt=function(i){return["/facilities",i]};function Ot(i,n){if(1&i&&(t.TgZ(0,"div")(1,"div",4),t._UZ(2,"mat-icon",5),t.ALo(3,"translate"),t.TgZ(4,"div",6)(5,"div",7)(6,"a",8),t._uU(7),t.qZA(),t.TgZ(8,"span",9),t._uU(9),t.qZA(),t.YNc(10,Dt,3,0,"button",10),t.YNc(11,Et,3,0,"button",10),t.qZA(),t.TgZ(12,"span",11),t._uU(13),t.ALo(14,"translate"),t.ALo(15,"translate"),t.qZA()()(),t._UZ(16,"app-animated-router-outlet"),t.qZA()),2&i){const e=t.oxw();t.xp6(2),t.s9C("matTooltip",t.lcZ(3,10,"FACILITY_DETAIL.ENTITY")),t.Q6J("ngStyle",t.DdM(16,Lt)),t.xp6(4),t.Q6J("routerLink",t.VKq(17,Zt,e.facility.id)),t.xp6(1),t.Oqu(e.facility.name),t.xp6(2),t.hij(" \xa0#",e.facility.id," "),t.xp6(1),t.Q6J("ngIf",e.editFacilityAuth),t.xp6(1),t.Q6J("ngIf",e.deleteAuth),t.xp6(2),t.lnq(" ",t.lcZ(14,12,"FACILITY_DETAIL.ENTITY"),", ",t.lcZ(15,14,"FACILITY_DETAIL.DESCRIPTION"),": ",e.facility.description," ")}}let Rt=(()=>{class i extends((0,At.T)()){constructor(e,s,a,o,r,_,S,b,E){super(),this.dialog=e,this.facilityManager=s,this.route=a,this.sideMenuService=o,this.sideMenuItemService=r,this.guiAuthResolver=_,this.router=S,this.entityStorageService=b,this.reloadEntityDetail=E,this.editFacilityAuth=!1,this.deleteAuth=!1,this.loading=!1}ngOnInit(){this.reloadData(),this.reloadEntityDetail.entityDetailChange.pipe((0,It.R)(this.destroyed$)).subscribe(()=>{this.reloadData()})}reloadData(){this.loading=!0,this.route.params.subscribe(e=>{const s=Number(e.facilityId);this.facilityManager.getFacilityById(s).subscribe(a=>{this.facility=a,this.entityStorageService.setEntity({id:a.id,beanName:a.beanName}),this.setMenuItems(),this.editFacilityAuth=this.guiAuthResolver.isAuthorized("updateFacility_Facility_policy",[this.facility]),this.deleteAuth=this.guiAuthResolver.isAuthorized("deleteFacility_Facility_Boolean_policy",[this.facility]),(0,p.sF)("facilities",this.facility),(0,p.XI)(this.facility),this.loading=!1},()=>this.loading=!1)})}setMenuItems(){const e=this.sideMenuItemService.parseFacility(this.facility);this.sideMenuService.setFacilityMenuItems([e])}editFacility(){const e=(0,p.kZ)();e.width="450px",e.data={theme:"facility-theme",facility:this.facility,dialogType:P.Eg.FACILITY},this.dialog.open(P.rd,e).afterClosed().subscribe(a=>{a&&this.facilityManager.getFacilityById(this.facility.id).subscribe(o=>{this.facility=o,this.setMenuItems()})})}deleteFacility(){const e=(0,p.kZ)();e.width="500px",e.data={theme:"facility-theme",facility:this.facility},this.dialog.open(Ct.Y,e).afterClosed().subscribe(a=>{a&&this.router.navigate([""])})}}return i.\u0275fac=function(e){return new(e||i)(t.Y36(u.uw),t.Y36(f.IQ),t.Y36(v.gz),t.Y36(bt.D),t.Y36(St.V),t.Y36(d.x4),t.Y36(v.F0),t.Y36(d.fb),t.Y36(yt.G))},i.\u0275cmp=t.Xpm({type:i,selectors:[["app-facility-detail-page"]],features:[t.qOj],decls:4,vars:2,consts:[[1,"container-fluid","pl-xl-5","pr-xl-5","facility-theme"],["class","mr-auto ml-auto",4,"ngIf"],[4,"ngIf"],[1,"mr-auto","ml-auto"],[1,"d-flex","page-title-headtitle"],["svgIcon","perun-facility-black",1,"perun-icon","perun-icon-detail",3,"matTooltip","ngStyle"],[1,"page-title-block"],[1,"page-title-headline","d-flex","align-items-center"],["queryParamsHandling","merge",1,"facility-link",3,"routerLink"],[1,"text-muted"],["mat-icon-button","",3,"click",4,"ngIf"],[1,"mt-1","entity-info"],["mat-icon-button","",3,"click"]],template:function(e,s){1&e&&(t.TgZ(0,"div",0),t._UZ(1,"perun-web-apps-back-button"),t.YNc(2,xt,1,0,"mat-spinner",1),t.YNc(3,Ot,17,19,"div",2),t.qZA()),2&e&&(t.xp6(2),t.Q6J("ngIf",s.loading),t.xp6(1),t.Q6J("ngIf",!s.loading&&void 0!==s.facility))},dependencies:[m.O5,m.PC,v.yS,R.Hw,C.lW,T.Ou,U.gM,et.A,vt.W,h.X$],data:{animation:[q.Ji]}}),i})();var it=c(71135);function Ft(i,n){1&i&&t._UZ(0,"mat-spinner",2)}function Nt(i,n){if(1&i&&(t.TgZ(0,"div"),t._UZ(1,"perun-web-apps-menu-buttons-field",3),t.qZA()),2&i){const e=t.oxw();t.xp6(1),t.Q6J("items",e.navItems)("size","small")}}let kt=(()=>{class i{constructor(e,s,a,o){this.facilityManager=e,this.authResolver=s,this.entityStorageService=a,this.routePolicyService=o,this.navItems=[],this.loading=!1}ngOnInit(){this.loading=!0,this.facility=this.entityStorageService.getEntity(),this.initItems(),this.loading=!1}initItems(){this.navItems=[],this.routePolicyService.canNavigate("facilities-resources",this.facility)&&this.navItems.push({cssIcon:"perun-manage-facility",url:`/facilities/${this.facility.id}/resources`,label:"MENU_ITEMS.FACILITY.RESOURCES",style:"facility-btn"}),this.routePolicyService.canNavigate("facilities-allowed-users",this.facility)&&this.navItems.push({cssIcon:"perun-user",url:`/facilities/${this.facility.id}/allowed-users`,label:"MENU_ITEMS.FACILITY.ALLOWED_USERS",style:"facility-btn"}),this.routePolicyService.canNavigate("facilities-allowed-groups",this.facility)&&this.navItems.push({cssIcon:"perun-group",url:`/facilities/${this.facility.id}/allowed-groups`,label:"MENU_ITEMS.FACILITY.ALLOWED_GROUPS",style:"facility-btn"}),this.routePolicyService.canNavigate("facilities-services-status",this.facility)&&this.navItems.push({cssIcon:"perun-service-status",url:`/facilities/${this.facility.id}/services-status`,label:"MENU_ITEMS.FACILITY.SERVICES_STATUS",style:"facility-btn"}),this.routePolicyService.canNavigate("facilities-services-destinations",this.facility)&&this.navItems.push({cssIcon:"perun-service_destination",url:`/facilities/${this.facility.id}/services-destinations`,label:"MENU_ITEMS.FACILITY.SERVICES_DESTINATIONS",style:"facility-btn"}),this.routePolicyService.canNavigate("facilities-hosts",this.facility)&&this.navItems.push({cssIcon:"perun-hosts",url:`/facilities/${this.facility.id}/hosts`,label:"MENU_ITEMS.FACILITY.HOSTS",style:"facility-btn"}),this.routePolicyService.canNavigate("facilities-attributes",this.facility)&&this.navItems.push({cssIcon:"perun-attributes",url:`/facilities/${this.facility.id}/attributes`,label:"MENU_ITEMS.FACILITY.ATTRIBUTES",style:"facility-btn"}),this.routePolicyService.canNavigate("facilities-settings",this.facility)&&this.navItems.push({cssIcon:"perun-settings2",url:`/facilities/${this.facility.id}/settings`,label:"MENU_ITEMS.FACILITY.SETTINGS",style:"facility-btn"})}}return i.\u0275fac=function(e){return new(e||i)(t.Y36(f.IQ),t.Y36(d.x4),t.Y36(d.fb),t.Y36(d.Ip))},i.\u0275cmp=t.Xpm({type:i,selectors:[["app-facility-overview"]],hostVars:2,hostBindings:function(e,s){2&e&&t.ekj("router-component",s.true)},decls:2,vars:2,consts:[["class","mr-auto ml-auto",4,"ngIf"],[4,"ngIf"],[1,"mr-auto","ml-auto"],[3,"items","size"]],template:function(e,s){1&e&&(t.YNc(0,Ft,1,0,"mat-spinner",0),t.YNc(1,Nt,2,2,"div",1)),2&e&&(t.Q6J("ngIf",s.loading),t.xp6(1),t.Q6J("ngIf",!s.loading))},dependencies:[m.O5,T.Ou,it.L]}),i})();var wt=c(34904),Yt=c(37380),Ut=c(98918),Mt=c(4675);let Jt=(()=>{class i{}return i.\u0275fac=function(e){return new(e||i)},i.\u0275cmp=t.Xpm({type:i,selectors:[["app-facility-settings"]],hostVars:2,hostBindings:function(e,s){2&e&&t.ekj("router-component",s.true)},decls:1,vars:0,template:function(e,s){1&e&&t._UZ(0,"app-animated-router-outlet")},dependencies:[et.A],data:{animation:[q.Ji]}}),i})();function Ht(i,n){1&i&&t._UZ(0,"mat-spinner",2)}function Qt(i,n){if(1&i&&(t.TgZ(0,"div"),t._UZ(1,"perun-web-apps-menu-buttons-field",3),t.qZA()),2&i){const e=t.oxw();t.xp6(1),t.Q6J("items",e.items)("size","small")}}let Gt=(()=>{class i{constructor(e,s,a,o){this.facilityManager=e,this.authResolver=s,this.entityStorageService=a,this.routePolicyService=o,this.items=[],this.loading=!1}ngOnInit(){this.loading=!0,this.facility=this.entityStorageService.getEntity(),this.initItems(),this.loading=!1}initItems(){this.items=[],this.routePolicyService.canNavigate("facilities-settings-owners",this.facility)&&this.items.push({cssIcon:"perun-owner-grey",url:`/facilities/${this.facility.id}/settings/owners`,label:"MENU_ITEMS.FACILITY.OWNERS",style:"facility-btn"}),this.routePolicyService.canNavigate("facilities-settings-managers",this.facility)&&this.items.push({cssIcon:"perun-manager",url:`/facilities/${this.facility.id}/settings/managers`,label:"MENU_ITEMS.FACILITY.MANAGERS",style:"facility-btn"}),this.routePolicyService.canNavigate("facilities-settings-security-teams",this.facility)&&this.items.push({cssIcon:"perun-security-teams",url:`/facilities/${this.facility.id}/settings/security-teams`,label:"MENU_ITEMS.FACILITY.SECURITY_TEAMS",style:"facility-btn"}),this.routePolicyService.canNavigate("facilities-settings-blacklist",this.facility)&&this.items.push({cssIcon:"perun-black-list",url:`/facilities/${this.facility.id}/settings/blacklist`,label:"MENU_ITEMS.FACILITY.BLACKLIST",style:"facility-btn"})}}return i.\u0275fac=function(e){return new(e||i)(t.Y36(f.IQ),t.Y36(d.x4),t.Y36(d.fb),t.Y36(d.Ip))},i.\u0275cmp=t.Xpm({type:i,selectors:[["app-facility-settings-overview"]],hostVars:2,hostBindings:function(e,s){2&e&&t.ekj("router-component",s.true)},decls:2,vars:2,consts:[["class","mr-auto ml-auto",4,"ngIf"],[4,"ngIf"],[1,"mr-auto","ml-auto"],[3,"items","size"]],template:function(e,s){1&e&&(t.YNc(0,Ht,1,0,"mat-spinner",0),t.YNc(1,Qt,2,2,"div",1)),2&e&&(t.Q6J("ngIf",s.loading),t.xp6(1),t.Q6J("ngIf",!s.loading))},dependencies:[m.O5,T.Ou,it.L]}),i})();var M=c(3848),qt=c(48323),Pt=c(12651);function Vt(i,n){1&i&&(t._uU(0),t.ALo(1,"translate")),2&i&&t.hij(" ",t.lcZ(1,1,"FACILITY_DETAIL.ENTITY")," ")}function Bt(i,n){if(1&i&&t._UZ(0,"app-one-entity-attribute-page",4),2&i){const e=t.oxw();t.Q6J("entityId",e.facility.id)("entity","facility")}}function jt(i,n){1&i&&(t._uU(0),t.ALo(1,"translate"),t.ALo(2,"translate")),2&i&&t.AsE(" ",t.lcZ(1,2,"FACILITY_DETAIL.ENTITY")," - ",t.lcZ(2,4,"ADMIN_USER.ENTITY")," ")}function Kt(i,n){if(1&i&&t._UZ(0,"app-two-entity-attribute-page",5),2&i){const e=t.oxw(2);t.Q6J("firstEntity","facility")("firstEntityId",e.facility.id)("secondEntity","user")}}function zt(i,n){1&i&&(t.TgZ(0,"mat-tab"),t.YNc(1,jt,3,6,"ng-template",1),t.YNc(2,Kt,1,3,"ng-template",2),t.qZA())}let $t=(()=>{class i{constructor(e,s){this.authResolver=e,this.entityStorageService=s}ngOnInit(){this.facility=this.entityStorageService.getEntity(),this.facilityUserAttAuth=this.authResolver.isAuthorized("getAssignedUsers_Facility_policy",[this.facility])}}return i.\u0275fac=function(e){return new(e||i)(t.Y36(d.x4),t.Y36(d.fb))},i.\u0275cmp=t.Xpm({type:i,selectors:[["app-facility-attributes"]],hostVars:2,hostBindings:function(e,s){2&e&&t.ekj("router-component",s.true)},decls:9,vars:4,consts:[[1,"page-subtitle"],["matTabLabel",""],["matTabContent",""],[4,"ngIf"],[3,"entityId","entity"],[3,"firstEntity","firstEntityId","secondEntity"]],template:function(e,s){1&e&&(t.TgZ(0,"div")(1,"h1",0),t._uU(2),t.ALo(3,"translate"),t.qZA(),t.TgZ(4,"mat-tab-group")(5,"mat-tab"),t.YNc(6,Vt,2,3,"ng-template",1),t.YNc(7,Bt,1,2,"ng-template",2),t.qZA(),t.YNc(8,zt,3,0,"mat-tab",3),t.qZA()()),2&e&&(t.xp6(2),t.Oqu(t.lcZ(3,2,"FACILITY_DETAIL.SETTINGS.ATTRIBUTES.TITLE")),t.xp6(6),t.Q6J("ngIf",s.facilityUserAttAuth))},dependencies:[m.O5,M.SP,M.uD,M.uX,M.Vc,qt.Y,Pt.t,h.X$]}),i})();var Xt=c(60113),Wt=c(16500),te=c(92090),ee=c(258),g=c(24006),J=c(68675),H=c(54004),V=c(19516),st=c(47957),at=c(3238),F=c(59549),B=c(284),L=c(56709),nt=c(31359);function ie(i,n){if(1&i){const e=t.EpF();t.TgZ(0,"mat-option",10),t.NdJ("onSelectionChange",function(){const o=t.CHM(e).$implicit,r=t.oxw(3);return t.KtG(r.onSelectedService(o))}),t._uU(1),t.qZA()}if(2&i){const e=n.$implicit;t.Q6J("value",e),t.xp6(1),t.hij(" ",e.name," ")}}function se(i,n){if(1&i){const e=t.EpF();t.TgZ(0,"mat-form-field",6)(1,"input",7),t.NdJ("keyup",function(a){t.CHM(e);const o=t.oxw(2);return t.KtG(o.updatedSerVal(a))}),t.ALo(2,"translate"),t.qZA(),t.TgZ(3,"mat-autocomplete",8,9)(5,"mat-option",10),t.NdJ("onSelectionChange",function(){t.CHM(e);const a=t.oxw(2);return t.KtG(a.onSelectedService("NOT_SELECTED"))}),t._uU(6),t.ALo(7,"translate"),t.qZA(),t.TgZ(8,"mat-option",10),t.NdJ("onSelectionChange",function(){t.CHM(e);const a=t.oxw(2);return t.KtG(a.onSelectedService("ALL"))}),t._uU(9),t.ALo(10,"translate"),t.qZA(),t.YNc(11,ie,2,2,"mat-option",11),t.ALo(12,"async"),t.qZA()()}if(2&i){const e=t.MAs(4),s=t.oxw(2);t.xp6(1),t.s9C("placeholder",t.lcZ(2,9,"FACILITY_DETAIL.SERVICE_CONFIG.SERVICE_SELECT")),t.Q6J("formControl",s.serviceField)("matAutocomplete",e),t.xp6(2),t.Q6J("displayWith",s.serviceDisplayFn.bind(s)),t.xp6(2),t.Q6J("value","NOT_SELECTED"),t.xp6(1),t.hij(" ",t.lcZ(7,11,"FACILITY_DETAIL.SERVICE_CONFIG.NOT_SELECTED")," "),t.xp6(2),t.Q6J("value","ALL"),t.xp6(1),t.hij(" ",t.lcZ(10,13,"FACILITY_DETAIL.SERVICE_CONFIG.ALL")," "),t.xp6(2),t.Q6J("ngForOf",t.lcZ(12,15,s.filteredServices))}}function ae(i,n){if(1&i){const e=t.EpF();t.TgZ(0,"mat-option",10),t.NdJ("onSelectionChange",function(){const o=t.CHM(e).$implicit,r=t.oxw(3);return t.KtG(r.onSelectedResource(o))}),t._uU(1),t.qZA()}if(2&i){const e=n.$implicit;t.Q6J("value",e),t.xp6(1),t.hij(" ",e.name," ")}}function ne(i,n){if(1&i){const e=t.EpF();t.TgZ(0,"mat-form-field",6)(1,"input",12),t.NdJ("keyup",function(a){t.CHM(e);const o=t.oxw(2);return t.KtG(o.updatedResVal(a))}),t.ALo(2,"translate"),t.qZA(),t.TgZ(3,"mat-autocomplete",8,9),t.YNc(5,ae,2,2,"mat-option",11),t.ALo(6,"async"),t.qZA()()}if(2&i){const e=t.MAs(4),s=t.oxw(2);t.xp6(1),t.s9C("placeholder",t.lcZ(2,5,"FACILITY_DETAIL.SERVICE_CONFIG.RES_SELECT")),t.Q6J("formControl",s.resourceField)("matAutocomplete",e),t.xp6(2),t.Q6J("displayWith",s.resourceDisplayFn.bind(s)),t.xp6(2),t.Q6J("ngForOf",t.lcZ(6,7,s.filteredResources))}}function oe(i,n){if(1&i){const e=t.EpF();t.TgZ(0,"mat-option",10),t.NdJ("onSelectionChange",function(){const o=t.CHM(e).$implicit,r=t.oxw(3);return t.KtG(r.onSelectedGroup(o))}),t._uU(1),t.qZA()}if(2&i){const e=n.$implicit;t.Q6J("value",e),t.xp6(1),t.hij(" ",e.name," ")}}function le(i,n){if(1&i){const e=t.EpF();t.TgZ(0,"mat-form-field",6)(1,"input",12),t.NdJ("keyup",function(a){t.CHM(e);const o=t.oxw(2);return t.KtG(o.updatedGroupVal(a))}),t.ALo(2,"translate"),t.qZA(),t.TgZ(3,"mat-autocomplete",13,9),t.YNc(5,oe,2,2,"mat-option",11),t.ALo(6,"async"),t.qZA()()}if(2&i){const e=t.MAs(4),s=t.oxw(2);t.xp6(1),t.s9C("placeholder",t.lcZ(2,5,"FACILITY_DETAIL.SERVICE_CONFIG.GROUP_SELECT")),t.Q6J("formControl",s.groupField)("matAutocomplete",e),t.xp6(2),t.Q6J("displayWith",s.groupDisplayFn.bind(s)),t.xp6(2),t.Q6J("ngForOf",t.lcZ(6,7,s.filteredGroups))}}function ce(i,n){if(1&i){const e=t.EpF();t.TgZ(0,"mat-option",10),t.NdJ("onSelectionChange",function(){const o=t.CHM(e).$implicit,r=t.oxw(3);return t.KtG(r.onSelectedMember(o))}),t._uU(1),t.ALo(2,"userFullName"),t.qZA()}if(2&i){const e=n.$implicit;t.Q6J("value",e),t.xp6(1),t.hij(" ",t.lcZ(2,2,e.user)," ")}}function re(i,n){if(1&i&&(t.TgZ(0,"mat-form-field",6),t._UZ(1,"input",14),t.ALo(2,"translate"),t.TgZ(3,"mat-autocomplete",8,9),t.YNc(5,ce,3,4,"mat-option",11),t.ALo(6,"async"),t.qZA()()),2&i){const e=t.MAs(4),s=t.oxw(2);t.xp6(1),t.s9C("placeholder",t.lcZ(2,5,"FACILITY_DETAIL.SERVICE_CONFIG.MEMBER_SELECT")),t.Q6J("matAutocomplete",e)("formControl",s.memberField),t.xp6(2),t.Q6J("displayWith",s.memberDisplayFn.bind(s)),t.xp6(2),t.Q6J("ngForOf",t.lcZ(6,7,s.filteredMembers))}}function ue(i,n){if(1&i){const e=t.EpF();t.TgZ(0,"div",3),t.YNc(1,se,13,17,"mat-form-field",4),t.TgZ(2,"mat-checkbox",5),t.NdJ("change",function(a){t.CHM(e);const o=t.oxw();return t.KtG(o.onOfferAllServices(a))}),t._uU(3),t.ALo(4,"translate"),t.qZA(),t.YNc(5,ne,7,9,"mat-form-field",4),t.YNc(6,le,7,9,"mat-form-field",4),t.YNc(7,re,7,9,"mat-form-field",4),t.qZA()}if(2&i){const e=t.oxw();t.xp6(1),t.Q6J("ngIf",void 0!==e.services),t.xp6(2),t.hij(" ",t.lcZ(4,5,"FACILITY_DETAIL.SERVICE_CONFIG.ALL_SERVICES")," "),t.xp6(2),t.Q6J("ngIf",void 0!==e.resources&&0!==e.resources.length),t.xp6(1),t.Q6J("ngIf",void 0!==e.selectedResource&&void 0!==e.groups&&0!==e.groups.length),t.xp6(1),t.Q6J("ngIf",void 0!==e.selectedGroup&&void 0!==e.members&&0!==e.members.length)}}function pe(i,n){if(1&i&&t._UZ(0,"perun-web-apps-service-configurator",15),2&i){const e=t.oxw();t.Q6J("facility",e.facility)("resource",e.selectedResource)("group",e.selectedGroup)("member",e.selectedMember)("service",e.selectedService)}}let de=(()=>{class i{constructor(e,s,a,o,r,_,S){this.facilityManager=e,this.resourceManager=s,this.serviceManager=a,this.membersManager=o,this.namePipe=r,this.translate=_,this.entityStorageService=S,this.serviceField=new g.p4,this.resourceField=new g.p4,this.groupField=new g.p4,this.memberField=new g.p4,this.allowedStatuses=["INVALID","VALID"],this.selectedService="NOT_SELECTED",this.attrNames=[],this.translate.get("FACILITY_DETAIL.SERVICE_CONFIG.ALL").subscribe(b=>this.serviceAllTranslation=b),this.translate.get("FACILITY_DETAIL.SERVICE_CONFIG.NOT_SELECTED").subscribe(b=>this.serviceNotSelectedTranslation=b)}ngOnInit(){this.facility=this.entityStorageService.getEntity(),this.facilityManager.getFacilityById(this.facility.id).subscribe(e=>{this.facility=e,this.facilityManager.getAssignedResourcesForFacility(e.id).subscribe(s=>this.resources=s),this.serviceManager.getAssignedServices(e.id).subscribe(s=>this.services=s)}),this.filteredServices=this.serviceField.valueChanges.pipe((0,J.O)(""),(0,H.U)(e=>this._filterServices(e))),this.filteredResources=this.resourceField.valueChanges.pipe((0,J.O)(""),(0,H.U)(e=>this._filterResources(e))),this.filteredGroups=this.groupField.valueChanges.pipe((0,J.O)(""),(0,H.U)(e=>this._filterGroups(e))),this.filteredMembers=this.memberField.valueChanges.pipe((0,J.O)(""),(0,H.U)(e=>this._filterMembers(e)))}onSelectedService(e){this.selectedService=e}onSelectedResource(e){this.selectedResource=e,void 0!==this.selectedResource?(this.resourceManager.getAssignedGroups(this.selectedResource.id).subscribe(s=>this.groups=s),this.selectedGroup=void 0,this.selectedMember=void 0):this.groups=void 0}onOfferAllServices(e){e.checked||this.serviceManager.getAssignedServices(this.facility.id).subscribe(s=>this.services=s)}onSelectedGroup(e){this.selectedGroup=e,void 0!==this.selectedGroup?(this.membersManager.getCompleteRichMembersForGroup(this.selectedGroup.id,!1,this.allowedStatuses,[],this.attrNames).subscribe(s=>this.members=s),this.selectedMember=void 0):this.members=void 0}onSelectedMember(e){this.selectedMember=e}serviceDisplayFn(e){if(null!==e)return"ALL"===e?this.serviceAllTranslation:"NOT_SELECTED"===e?this.serviceNotSelectedTranslation:"string"!=typeof e?e.name:e}resourceDisplayFn(e){if(null!==e)return e.name}groupDisplayFn(e){if(null!==e)return e.name}memberDisplayFn(e){if(null!==e)return this.namePipe.transform(e.user)}updatedSerVal(e){""===e.target.value&&(this.selectedService="NOT_SELECTED")}updatedResVal(e){""===e.target.value&&(this.groups=void 0,this.members=void 0)}updatedGroupVal(e){""===e.target.value&&(this.members=void 0)}_filterServices(e){const s=e.toString().toLowerCase();return this.services.filter(a=>a.name.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").includes(s))}_filterResources(e){const s=e.toString().toLowerCase();return this.resources.filter(a=>a.name.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").includes(s))}_filterGroups(e){const s=e.toString().toLowerCase();return this.groups.filter(a=>a.name.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").includes(s))}_filterMembers(e){const s=e.toString().toLowerCase();return this.members.filter(a=>this.namePipe.transform(a.user).toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").includes(s))}}return i.\u0275fac=function(e){return new(e||i)(t.Y36(f.IQ),t.Y36(f.xk),t.Y36(f.KK),t.Y36(f.uq),t.Y36(V.dp),t.Y36(h.sK),t.Y36(d.fb))},i.\u0275cmp=t.Xpm({type:i,selectors:[["app-facility-service-config"]],decls:6,vars:5,consts:[[1,"page-subtitle"],["class","col-12 col-lg-6 mb-2",4,"ngIf"],[3,"facility","resource","group","member","service",4,"ngIf"],[1,"col-12","col-lg-6","mb-2"],["class","w-100",4,"ngIf"],[3,"change"],[1,"w-100"],["matInput","","type","text",3,"placeholder","formControl","matAutocomplete","keyup"],["autoActiveFirstOption","",3,"displayWith"],["auto","matAutocomplete"],[3,"value","onSelectionChange"],[3,"value","onSelectionChange",4,"ngFor","ngForOf"],["matInput","","type","text",3,"formControl","matAutocomplete","placeholder","keyup"],["autoActiveFirstOption","",3,"displayWith","ngClass"],["matInput","","type","text",3,"matAutocomplete","placeholder","formControl"],[3,"facility","resource","group","member","service"]],template:function(e,s){1&e&&(t.TgZ(0,"div")(1,"h1",0),t._uU(2),t.ALo(3,"translate"),t.qZA(),t.YNc(4,ue,8,7,"div",1),t.YNc(5,pe,1,5,"perun-web-apps-service-configurator",2),t.qZA()),2&e&&(t.xp6(2),t.Oqu(t.lcZ(3,3,"FACILITY_DETAIL.SERVICE_CONFIG.TITLE")),t.xp6(2),t.Q6J("ngIf",!!s.facility),t.xp6(1),t.Q6J("ngIf",!!s.facility))},dependencies:[m.mk,m.sg,m.O5,st.XC,st.ZL,at.ey,F.KE,B.Nt,g.Fj,g.JJ,g.oH,L.oG,m.Ov,h.X$,nt.d]}),i})();var ot=c(28361);let lt=(()=>{class i{constructor(e,s,a){this.facilityService=e,this.guiAuthResolver=s,this.entityStorageService=a,this.disableRouting=!1,this.disableSelf=!1,this.availableRoles=[],this.selected="user",this.type="Facility",this.theme="facility-theme"}ngOnInit(){this.facility=this.entityStorageService.getEntity(),this.guiAuthResolver.assignAvailableRoles(this.availableRoles,"Facility")}}return i.\u0275fac=function(e){return new(e||i)(t.Y36(f.IQ),t.Y36(d.x4),t.Y36(d.fb))},i.\u0275cmp=t.Xpm({type:i,selectors:[["app-perun-web-apps-facility-settings-managers"]],hostVars:2,hostBindings:function(e,s){2&e&&t.ekj("router-component",s.true)},inputs:{disableRouting:"disableRouting",disableSelf:"disableSelf"},decls:1,vars:6,consts:[[3,"complementaryObject","availableRoles","complementaryObjectType","disableSelf","disableRouting","theme"]],template:function(e,s){1&e&&t._UZ(0,"app-managers-page",0),2&e&&t.Q6J("complementaryObject",s.facility)("availableRoles",s.availableRoles)("complementaryObjectType",s.type)("disableSelf",s.disableSelf)("disableRouting",s.disableRouting)("theme",s.theme)},dependencies:[ot.s]}),i})();var x=c(10036),A=c(95017),_e=c(89466),me=c(84385);function he(i,n){1&i&&t._UZ(0,"mat-spinner",6)}function fe(i,n){1&i&&(t.TgZ(0,"mat-option",19),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&i&&(t.xp6(1),t.Oqu(t.lcZ(2,1,"DIALOGS.ADD_SERVICE_DESTINATION.SELECTION_ALL")))}function ge(i,n){1&i&&(t.TgZ(0,"mat-option",20),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&i&&(t.xp6(1),t.Oqu(t.lcZ(2,1,"DIALOGS.ADD_SERVICE_DESTINATION.NO_SERVICE")))}function Te(i,n){if(1&i&&(t.TgZ(0,"mat-option",21),t._uU(1),t.qZA()),2&i){const e=n.$implicit;t.Q6J("value",e),t.xp6(1),t.hij(" ",e.name," ")}}function Se(i,n){1&i&&(t.TgZ(0,"mat-error"),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&i&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"DIALOGS.ADD_SERVICE_DESTINATION.CHOOSE_SERVICE")," "))}function Ce(i,n){if(1&i&&(t.TgZ(0,"mat-option",21),t._uU(1),t.qZA()),2&i){const e=n.$implicit,s=t.oxw(2);t.Q6J("value",e),t.xp6(1),t.hij(" ",s.getTypeForView(e)," ")}}function Ae(i,n){1&i&&(t.TgZ(0,"mat-error"),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&i&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"DIALOGS.ADD_SERVICE_DESTINATION.REQUIRED_FIELD")," "))}function Ie(i,n){1&i&&(t.TgZ(0,"mat-error"),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&i&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"DIALOGS.ADD_SERVICE_DESTINATION.INVALID_DESTINATION")," "))}function be(i,n){if(1&i&&(t.TgZ(0,"mat-form-field",22),t._UZ(1,"input",23),t.YNc(2,Ae,3,3,"mat-error",13),t.YNc(3,Ie,3,3,"mat-error",13),t.qZA()),2&i){const e=t.oxw(2);t.xp6(1),t.s9C("placeholder",e.getTypeForView(e.selectedType)),t.Q6J("formControl",e.destinationControl),t.xp6(1),t.Q6J("ngIf","host"===e.selectedType&&!e.useFacilityHost&&e.destinationControl.hasError("required")),t.xp6(1),t.Q6J("ngIf",e.destinationControl.hasError("invalidDestination"))}}function ye(i,n){if(1&i){const e=t.EpF();t.TgZ(0,"mat-checkbox",24),t.NdJ("ngModelChange",function(a){t.CHM(e);const o=t.oxw(2);return t.KtG(o.useFacilityHost=a)}),t._uU(1),t.ALo(2,"translate"),t.qZA()}if(2&i){const e=t.oxw(2);t.Q6J("ngModel",e.useFacilityHost),t.xp6(1),t.hij(" ",t.lcZ(2,2,"DIALOGS.ADD_SERVICE_DESTINATION.USE_FACILITY_HOST")," ")}}function ve(i,n){if(1&i&&(t.TgZ(0,"mat-option",21),t._uU(1),t.qZA()),2&i){const e=n.$implicit;t.Q6J("value",e),t.xp6(1),t.hij(" ",e," ")}}function xe(i,n){if(1&i){const e=t.EpF();t.TgZ(0,"div",7)(1,"div",8),t._uU(2),t.ALo(3,"translate"),t.qZA(),t.TgZ(4,"mat-form-field")(5,"mat-select",9),t.ALo(6,"translate"),t.YNc(7,fe,3,3,"mat-option",10),t.YNc(8,ge,3,3,"mat-option",11),t.YNc(9,Te,2,2,"mat-option",12),t.qZA(),t.YNc(10,Se,3,3,"mat-error",13),t.qZA(),t.TgZ(11,"mat-checkbox",14),t.NdJ("change",function(){t.CHM(e);const a=t.oxw();return t.KtG(a.getServices())})("ngModelChange",function(a){t.CHM(e);const o=t.oxw();return t.KtG(o.servicesOnFacility=a)}),t._uU(12),t.ALo(13,"translate"),t.qZA(),t.TgZ(14,"mat-form-field")(15,"mat-select",15),t.NdJ("ngModelChange",function(a){t.CHM(e);const o=t.oxw();return t.KtG(o.selectedType=a)})("selectionChange",function(){t.CHM(e);const a=t.oxw();return t.KtG(a.destinationControl.updateValueAndValidity())}),t.ALo(16,"translate"),t.YNc(17,Ce,2,2,"mat-option",12),t.qZA()(),t.YNc(18,be,4,4,"mat-form-field",16),t.YNc(19,ye,3,4,"mat-checkbox",17),t.TgZ(20,"mat-form-field")(21,"mat-select",18),t.NdJ("ngModelChange",function(a){t.CHM(e);const o=t.oxw();return t.KtG(o.selectedPropagation=a)}),t.ALo(22,"translate"),t.YNc(23,ve,2,2,"mat-option",12),t.qZA()(),t.TgZ(24,"div",8),t._uU(25),t.ALo(26,"translate"),t.qZA()()}if(2&i){const e=t.oxw();t.xp6(2),t.Oqu(t.lcZ(3,18,"DIALOGS.ADD_SERVICE_DESTINATION.DESCRIPTION")),t.xp6(3),t.s9C("placeholder",t.lcZ(6,20,"DIALOGS.ADD_SERVICE_DESTINATION.SERVICE")),t.Q6J("formControl",e.serviceControl),t.xp6(2),t.Q6J("ngIf",0!==e.services.length),t.xp6(1),t.Q6J("ngIf",0===e.services.length),t.xp6(1),t.Q6J("ngForOf",e.services),t.xp6(1),t.Q6J("ngIf",void 0===e.serviceControl.value),t.xp6(1),t.Q6J("ngModel",e.servicesOnFacility),t.xp6(1),t.Oqu(t.lcZ(13,22,"DIALOGS.ADD_SERVICE_DESTINATION.IS_SERVICES_ONLY_ON_FACILITY")),t.xp6(3),t.s9C("placeholder",t.lcZ(16,24,"DIALOGS.ADD_SERVICE_DESTINATION.TYPE")),t.Q6J("ngModel",e.selectedType),t.xp6(2),t.Q6J("ngForOf",e.types),t.xp6(1),t.Q6J("ngIf",!("host"===e.selectedType&&e.useFacilityHost)),t.xp6(1),t.Q6J("ngIf","host"===e.selectedType),t.xp6(2),t.s9C("placeholder",t.lcZ(22,26,"DIALOGS.ADD_SERVICE_DESTINATION.PROPAGATION")),t.Q6J("ngModel",e.selectedPropagation),t.xp6(2),t.Q6J("ngForOf",e.propagations),t.xp6(2),t.hij(" ",t.lcZ(26,28,"DIALOGS.ADD_SERVICE_DESTINATION.PROPAGATION_TYPE_"+e.selectedPropagation)," ")}}let De=(()=>{class i{constructor(e,s,a,o){this.dialogRef=e,this.data=s,this.facilitiesManager=a,this.servicesManager=o,this.services=[],this.types=["host","user@host","user@host:port","user@host-windows","host-windows-proxy","url","email","semail","service-specific"],this.selectedType="host",this.propagations=["PARALLEL","DUMMY"],this.selectedPropagation="PARALLEL",this.useFacilityHost=!1,this.loading=!1,this.emailRegex=new RegExp(p.B2),this.hostPattern=new RegExp("^(?!:\\/\\/)(?=.{1,255}$)((.{1,63}\\.){1,127}(?![0-9]*$)[a-z0-9-]+\\.?)$|^(25[0-5]|2[0-4]\\d|[0-1]?\\d?\\d)(\\.(25[0-5]|2[0-4]\\d|[0-1]?\\d?\\d)){3}$"),this.urlPattern=new RegExp("^(https?|ftp|file)://[-a-zA-Z0-9+&@#/%?=~_|!:,.;()*$']*[-a-zA-Z0-9+&@#/%=~_|()*$']$"),this.userAtHostPattern=new RegExp("^[a-z_]([a-z0-9_-]{0,31}|[a-z0-9_-]{0,30}\\$)@(?:(?!:\\/\\/)(?=.{1,255}$)((.{1,63}\\.){1,127}(?![0-9]*$)[a-z0-9-]+\\.?)$|(25[0-5]|2[0-4]\\d|[0-1]?\\d?\\d)(\\.(25[0-5]|2[0-4]\\d|[0-1]?\\d?\\d)){3}$)"),this.userAtHostPortPattern=new RegExp("^[a-z_]([a-z0-9_-]{0,31}|[a-z0-9_-]{0,30}\\$)@(?:(?!:\\/\\/)(?=.{1,255}$)((.{1,63}\\.){1,127}(?![0-9]*$)[a-z0-9-]+\\.?)|(25[0-5]|2[0-4]\\d|[0-1]?\\d?\\d)(\\.(25[0-5]|2[0-4]\\d|[0-1]?\\d?\\d)){3}):[0-9]+"),this.serviceSpecificPattern=new RegExp("^(?!-)[a-zA-Z0-9-_.:/]*$")}ngOnInit(){this.serviceControl=new g.p4(void 0,g.kI.required),this.destinationControl=new g.p4("",this.getDestinationValidator()),this.emailControl=new g.p4("",[g.kI.required,g.kI.pattern(this.emailRegex)]),this.servicesOnFacility=!0,this.getServices()}onCancel(){this.dialogRef.close()}onSubmit(){this.loading=!0,"all"===this.serviceControl.value?this.useFacilityHost?this.servicesManager.addDestinationsDefinedByHostsOnFacilityWithListOfServiceAndFacility({services:this.services,facility:this.data.facility.id}).subscribe(()=>{this.dialogRef.close(!0)},()=>this.loading=!1):this.servicesManager.addDestinationToMultipleServices({services:this.services,facility:this.data.facility.id,destination:this.destinationControl.value,type:this.selectedType,propagationType:this.selectedPropagation}).subscribe(()=>{this.dialogRef.close(!0)},()=>this.loading=!1):this.useFacilityHost?this.servicesManager.addDestinationsDefinedByHostsOnFacilityWithServiceAndFacility(this.serviceControl.value.id,this.data.facility.id).subscribe(()=>{this.dialogRef.close(!0)},()=>this.loading=!1):this.servicesManager.addDestination(this.serviceControl.value.id,this.data.facility.id,this.destinationControl.value,this.selectedType,this.selectedPropagation).subscribe(()=>{this.dialogRef.close(!0)},()=>this.loading=!1)}getServices(){this.loading=!0,this.servicesOnFacility?0!==this.data.configServices.length?this.services=this.data.configServices:this.servicesManager.getAssignedServices(this.data.facility.id).subscribe(e=>{this.services=e},()=>this.loading=!1):this.servicesManager.getServices().subscribe(e=>{this.services=e},()=>this.loading=!1),this.loading=!1,this.serviceControl.setValue(void 0)}getTypeForView(e){return"semail"===e?"Send Mail":"service-specific"===e?"Service Specific":e}invalidDestination(){return("host"!==this.selectedType||!this.useFacilityHost)&&this.destinationControl.invalid}getDestinationValidator(){return e=>{if(!e.value)return null;let s;switch(this.selectedType){case"host":case"host-windows-proxy":s=this.hostPattern;break;case"email":case"semail":s=this.emailRegex;break;case"url":s=this.urlPattern;break;case"user@host":case"user@host-windows":s=this.userAtHostPattern;break;case"user@host:port":s=this.userAtHostPortPattern;break;case"service-specific":s=this.serviceSpecificPattern;break;default:return null}return s.test(e.value)?null:{invalidDestination:{value:e.value}}}}}return i.\u0275fac=function(e){return new(e||i)(t.Y36(u.so),t.Y36(u.WI),t.Y36(f.IQ),t.Y36(f.KK))},i.\u0275cmp=t.Xpm({type:i,selectors:[["app-perun-web-apps-add-services-destination-dialog"]],decls:13,vars:15,consts:[["mat-dialog-title",""],["class","mr-auto ml-auto",4,"ngIf"],["class","dialog-container","mat-dialog-content","",4,"ngIf"],["mat-dialog-actions",""],["mat-flat-button","",1,"ml-auto",3,"click"],["color","accent","mat-flat-button","",1,"ml-2",3,"disabled","click"],[1,"mr-auto","ml-auto"],["mat-dialog-content","",1,"dialog-container"],[1,"font-italic"],["required","",3,"formControl","placeholder"],["value","all",4,"ngIf"],["value","noService",4,"ngIf"],[3,"value",4,"ngFor","ngForOf"],[4,"ngIf"],[3,"ngModel","change","ngModelChange"],[3,"ngModel","placeholder","ngModelChange","selectionChange"],["class","w-100",4,"ngIf"],[3,"ngModel","ngModelChange",4,"ngIf"],[3,"ngModel","placeholder","ngModelChange"],["value","all"],["value","noService"],[3,"value"],[1,"w-100"],["matInput","","required","",3,"formControl","placeholder"],[3,"ngModel","ngModelChange"]],template:function(e,s){1&e&&(t.TgZ(0,"div")(1,"h1",0),t._uU(2),t.ALo(3,"translate"),t.qZA(),t.YNc(4,he,1,0,"mat-spinner",1),t.YNc(5,xe,27,30,"div",2),t.TgZ(6,"div",3)(7,"button",4),t.NdJ("click",function(){return s.onCancel()}),t._uU(8),t.ALo(9,"translate"),t.qZA(),t.TgZ(10,"button",5),t.NdJ("click",function(){return s.onSubmit()}),t._uU(11),t.ALo(12,"translate"),t.qZA()()()),2&e&&(t.Tol(s.data.theme),t.xp6(2),t.Oqu(t.lcZ(3,9,"DIALOGS.ADD_SERVICE_DESTINATION.TITLE")),t.xp6(2),t.Q6J("ngIf",s.loading),t.xp6(1),t.Q6J("ngIf",!s.loading),t.xp6(3),t.hij(" ",t.lcZ(9,11,"DIALOGS.ADD_SERVICE_DESTINATION.CANCEL")," "),t.xp6(2),t.Q6J("disabled",s.loading||s.invalidDestination()||s.serviceControl.invalid||"noService"===s.serviceControl.value),t.xp6(1),t.hij(" ",t.lcZ(12,13,"DIALOGS.ADD_SERVICE_DESTINATION.ADD")," "))},dependencies:[m.sg,m.O5,at.ey,F.TO,F.KE,B.Nt,g.Fj,g.JJ,g.Q7,g.oH,g.On,C.lW,L.oG,u.uh,u.xY,u.H8,me.gD,T.Ou,h.X$],data:{animation:[q.BQ]}}),i})();var ct=c(70242),Z=c(98380),O=c(96214),D=c(7434);function Ee(i,n){1&i&&(t.TgZ(0,"perun-web-apps-alert",9),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&i&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"FACILITY_DETAIL.SERVICES_DESTINATIONS.DESTINATIONS_INFO")," "))}function Le(i,n){if(1&i){const e=t.EpF();t.TgZ(0,"button",10),t.NdJ("click",function(){t.CHM(e);const a=t.oxw();return t.KtG(a.addDestination())}),t._uU(1),t.ALo(2,"translate"),t.qZA()}2&i&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"FACILITY_DETAIL.SERVICES_DESTINATIONS.ADD")," "))}function Ze(i,n){if(1&i){const e=t.EpF();t.TgZ(0,"button",11),t.NdJ("click",function(){t.CHM(e);const a=t.oxw();return t.KtG(a.removeDestination())}),t._uU(1),t.ALo(2,"translate"),t.qZA()}if(2&i){const e=t.oxw();t.Q6J("disabled",0===e.selected.selected.length),t.xp6(1),t.hij(" ",t.lcZ(2,2,"FACILITY_DETAIL.SERVICES_DESTINATIONS.REMOVE")," ")}}function Oe(i,n){if(1&i){const e=t.EpF();t.TgZ(0,"button",12),t.NdJ("click",function(){t.CHM(e);const a=t.oxw();return t.KtG(a.onAllow())}),t.TgZ(1,"mat-icon"),t._uU(2," check_circle_outline "),t.qZA(),t._uU(3),t.ALo(4,"translate"),t.qZA()}if(2&i){const e=t.oxw();t.Q6J("disabled",0===e.selected.selected.length||e.allSelectedAllowed()),t.xp6(3),t.hij(" ",t.lcZ(4,2,"FACILITY_DETAIL.SERVICES_DESTINATIONS.ALLOW")," ")}}function Re(i,n){if(1&i){const e=t.EpF();t.TgZ(0,"button",12),t.NdJ("click",function(){t.CHM(e);const a=t.oxw();return t.KtG(a.onBlock())}),t.TgZ(1,"mat-icon"),t._uU(2," block "),t.qZA(),t._uU(3),t.ALo(4,"translate"),t.qZA()}if(2&i){const e=t.oxw();t.Q6J("disabled",0===e.selected.selected.length||e.allSelectedBlocked()),t.xp6(3),t.hij(" ",t.lcZ(4,2,"FACILITY_DETAIL.SERVICES_DESTINATIONS.BLOCK")," ")}}function Fe(i,n){1&i&&t._UZ(0,"mat-spinner",13)}function Ne(i,n){if(1&i&&t._UZ(0,"app-perun-web-apps-destination-list",14),2&i){const e=t.oxw();t.Q6J("filterValue",e.filterValue)("selection",e.selected)("destinations",e.destinations)("services",e.configServicesIds)("displayedColumns",e.displayedColumns)("tableId",e.tableId)}}let rt=(()=>{class i{constructor(e,s,a,o,r,_,S,b){this.dialog=e,this.facilitiesManager=s,this.servicesManager=a,this.translate=o,this.notificator=r,this.authResolver=_,this.serviceManager=S,this.entityStorageService=b,this.displayedColumns=["select","destinationId","service","destination","type","status","propagationType"],this.configServices=[],this.configServicesIds=new Set,this.title="FACILITY_DETAIL.SERVICES_DESTINATIONS.TITLE",this.destinationEmitter=new t.vpe,this.selected=new A.Ov(!0,[]),this.filterValue="",this.tableId=x.Cf}ngOnInit(){this.loading=!0,this.facility=this.entityStorageService.getEntity(),this.setAuthRights(),this.refreshTable()}refreshTable(){this.loading=!0,this.servicesManager.getAllRichDestinationsForFacility(this.facility.id).subscribe(e=>{this.destinations=e,this.destinationEmitter.emit(this.destinations),this.selected.clear(),this.setAuthRights(),this.loading=!1})}setAuthRights(){this.addAuth=this.authResolver.isAuthorized("addDestination_Service_Facility_Destination_policy",[this.facility]),this.removeAuth=this.authResolver.isAuthorized("removeDestination_Service_Facility_Destination_policy",[this.facility]),this.allowAuth=this.authResolver.isAuthorized("unblockServiceOnDestination_Service_int_policy",[this.facility]),this.blockAuth=this.authResolver.isAuthorized("blockServiceOnDestination_Service_int_policy",[this.facility]),this.displayedColumns=this.removeAuth?this.displayedColumns:this.displayedColumns.filter(e=>"select"!==e)}addDestination(){const e=(0,p.kZ)();e.width="600px",e.data={facility:this.facility,theme:"facility-theme",configServices:this.configServices},this.dialog.open(De,e).afterClosed().subscribe(a=>{a&&this.translate.get("FACILITY_DETAIL.SERVICES_DESTINATIONS.ADD_SUCCESS").subscribe(o=>{this.refreshTable(),this.notificator.showSuccess(o)})})}removeDestination(){const e=(0,p.kZ)();e.width="600px",e.data={destinations:this.selected.selected,theme:"facility-theme"},this.dialog.open(_e.u,e).afterClosed().subscribe(a=>{a&&this.refreshTable()})}blockServiceOnDestinations(e){if(0===e.length)return this.notificator.showSuccess(this.translate.instant("FACILITY_DETAIL.SERVICES_DESTINATIONS.BLOCK_SUCCESS")),void this.refreshTable();const s=e.pop();this.serviceManager.blockServiceOnDestination(s.service.id,s.id).subscribe(()=>{this.blockServiceOnDestinations(e)},()=>this.loading=!1)}onBlock(){this.loading=!0,this.blockServiceOnDestinations(this.selected.selected)}allowServiceOnDestinations(e){if(0===e.length)return this.notificator.showSuccess(this.translate.instant("FACILITY_DETAIL.SERVICES_DESTINATIONS.ALLOW_SUCCESS")),void this.refreshTable();const s=e.pop();this.serviceManager.unblockServiceOnDestinationById(s.service.id,s.id).subscribe(()=>{this.allowServiceOnDestinations(e)},()=>this.loading=!1)}onAllow(){this.loading=!0,this.allowServiceOnDestinations(this.selected.selected)}applyFilter(e){this.filterValue=e}allSelectedAllowed(){return this.selected.selected.reduce((e,s)=>e&&!s.blocked,!0)}allSelectedBlocked(){return this.selected.selected.reduce((e,s)=>e&&s.blocked,!0)}}return i.id="FacilityServicesDestinationsComponent",i.\u0275fac=function(e){return new(e||i)(t.Y36(u.uw),t.Y36(f.IQ),t.Y36(f.KK),t.Y36(h.sK),t.Y36(d.V6),t.Y36(d.x4),t.Y36(f.KK),t.Y36(d.fb))},i.\u0275cmp=t.Xpm({type:i,selectors:[["app-perun-web-apps-facility-services-destinations"]],hostVars:2,hostBindings:function(e,s){2&e&&t.ekj("router-component",s.true)},inputs:{displayedColumns:"displayedColumns",configServices:"configServices",configServicesIds:"configServicesIds",title:"title",loading:"loading"},outputs:{destinationEmitter:"destinationEmitter"},decls:13,vars:11,consts:[[1,"page-subtitle"],["alert_type","info",4,"ngIf"],[3,"refresh"],["color","accent","class","mr-2 action-button","mat-flat-button","",3,"click",4,"ngIf"],["class","mr-2","color","warn","mat-flat-button","",3,"disabled","click",4,"ngIf"],["class","mr-2","mat-stroked-button","",3,"disabled","click",4,"ngIf"],[3,"placeholder","filter"],["class","ml-auto mr-auto",4,"ngIf"],[3,"filterValue","selection","destinations","services","displayedColumns","tableId",4,"ngIf"],["alert_type","info"],["color","accent","mat-flat-button","",1,"mr-2","action-button",3,"click"],["color","warn","mat-flat-button","",1,"mr-2",3,"disabled","click"],["mat-stroked-button","",1,"mr-2",3,"disabled","click"],[1,"ml-auto","mr-auto"],[3,"filterValue","selection","destinations","services","displayedColumns","tableId"]],template:function(e,s){1&e&&(t.TgZ(0,"div")(1,"h1",0),t._uU(2),t.ALo(3,"translate"),t.qZA(),t.YNc(4,Ee,3,3,"perun-web-apps-alert",1),t.TgZ(5,"perun-web-apps-refresh-button",2),t.NdJ("refresh",function(){return s.refreshTable()}),t.qZA(),t.YNc(6,Le,3,3,"button",3),t.YNc(7,Ze,3,4,"button",4),t.YNc(8,Oe,5,4,"button",5),t.YNc(9,Re,5,4,"button",5),t.TgZ(10,"perun-web-apps-immediate-filter",6),t.NdJ("filter",function(o){return s.applyFilter(o)}),t.qZA(),t.YNc(11,Fe,1,0,"mat-spinner",7),t.YNc(12,Ne,1,6,"app-perun-web-apps-destination-list",8),t.qZA()),2&e&&(t.xp6(2),t.Oqu(t.lcZ(3,9,s.title)),t.xp6(2),t.Q6J("ngIf",s.title.includes("CONFIG")),t.xp6(2),t.Q6J("ngIf",s.addAuth),t.xp6(1),t.Q6J("ngIf",s.removeAuth),t.xp6(1),t.Q6J("ngIf",s.allowAuth),t.xp6(1),t.Q6J("ngIf",s.blockAuth),t.xp6(1),t.Q6J("placeholder","FACILITY_DETAIL.SERVICES_DESTINATIONS.FILTER"),t.xp6(1),t.Q6J("ngIf",s.loading),t.xp6(1),t.Q6J("ngIf",!s.loading))},dependencies:[m.O5,R.Hw,C.lW,T.Ou,ct.q,Z.w,O.t,D.L,h.X$]}),i})();var j=c(23256);function ke(i,n){1&i&&t._UZ(0,"mat-spinner",3)}function we(i,n){if(1&i){const e=t.EpF();t.TgZ(0,"div")(1,"perun-web-apps-immediate-filter",4),t.NdJ("filter",function(a){t.CHM(e);const o=t.oxw();return t.KtG(o.applyFilter(a))}),t.qZA(),t.TgZ(2,"div",5),t._UZ(3,"perun-web-apps-owners-list",6),t.qZA(),t.TgZ(4,"div",7)(5,"button",8),t.NdJ("click",function(){t.CHM(e);const a=t.oxw();return t.KtG(a.onCancel())}),t._uU(6),t.ALo(7,"translate"),t.qZA(),t.TgZ(8,"button",9),t.NdJ("click",function(){t.CHM(e);const a=t.oxw();return t.KtG(a.onAdd())}),t._uU(9),t.ALo(10,"translate"),t.qZA()()()}if(2&i){const e=t.oxw();t.xp6(1),t.Q6J("placeholder","DIALOGS.ADD_OWNERS.FILTER"),t.xp6(2),t.Q6J("filterValue",e.filterValue)("selection",e.selection)("owners",e.owners)("tableId",e.tableId),t.xp6(3),t.hij(" ",t.lcZ(7,8,"DIALOGS.ADD_OWNERS.CANCEL")," "),t.xp6(2),t.Q6J("disabled",0===e.selection.selected.length||e.loading),t.xp6(1),t.hij(" ",t.lcZ(10,10,"DIALOGS.ADD_OWNERS.ADD")," ")}}let Ye=(()=>{class i{constructor(e,s,a,o,r,_){this.dialogRef=e,this.data=s,this.notificator=a,this.translate=o,this.ownersManagerService=r,this.facilitiesManagerService=_,this.extSources=[],this.selection=new A.Ov(!0,[]),this.filterValue="",this.tableId=x.BV,this.owners=[],this.translate.get("DIALOGS.ADD_OWNERS.SUCCESS").subscribe(S=>this.successMessage=S)}ngOnInit(){this.theme=this.data.theme,this.loading=!0,this.ownersManagerService.getAllOwners().subscribe(e=>{this.owners=e.filter(s=>!this.data.forbiddenOwners.includes(s.id)),this.loading=!1},()=>this.loading=!1)}applyFilter(e){this.filterValue=e}onAdd(){this.loading=!0,0!==this.selection.selected.length?this.facilitiesManagerService.addFacilityOwner(this.data.facilityId,this.selection.selected.pop().id).subscribe(()=>this.onAdd(),()=>this.loading=!1):(this.loading=!1,this.notificator.showSuccess(this.successMessage),this.dialogRef.close(!0))}onCancel(){this.dialogRef.close(!1)}}return i.\u0275fac=function(e){return new(e||i)(t.Y36(u.so),t.Y36(u.WI),t.Y36(d.V6),t.Y36(h.sK),t.Y36(f.aC),t.Y36(f.IQ))},i.\u0275cmp=t.Xpm({type:i,selectors:[["app-add-facility-owner-dialog"]],decls:6,vars:8,consts:[["mat-dialog-title",""],["class","mr-auto ml-auto",4,"ngIf"],[4,"ngIf"],[1,"mr-auto","ml-auto"],[1,"font-size-1rem",3,"placeholder","filter"],["mat-dialog-content",""],[3,"filterValue","selection","owners","tableId"],["mat-dialog-actions",""],["mat-flat-button","",1,"ml-auto",3,"click"],["color","accent","mat-flat-button","",1,"ml-2",3,"disabled","click"]],template:function(e,s){1&e&&(t.TgZ(0,"h1",0),t._uU(1),t.ALo(2,"translate"),t.qZA(),t.TgZ(3,"div"),t.YNc(4,ke,1,0,"mat-spinner",1),t.YNc(5,we,11,12,"div",2),t.qZA()),2&e&&(t.xp6(1),t.Oqu(t.lcZ(2,6,"DIALOGS.ADD_OWNERS.TITLE")),t.xp6(2),t.Tol(s.theme),t.xp6(1),t.Q6J("ngIf",s.loading),t.xp6(1),t.Q6J("ngIf",!s.loading))},dependencies:[m.O5,C.lW,u.uh,u.xY,u.H8,T.Ou,D.L,j.Q,h.X$]}),i})();var l=c(30671);function Ue(i,n){1&i&&t._UZ(0,"mat-spinner",6)}function Me(i,n){1&i&&t._UZ(0,"th",15)}function Je(i,n){if(1&i&&(t.TgZ(0,"td",16),t._uU(1),t.qZA()),2&i){const e=n.$implicit;t.xp6(1),t.Oqu(e.name)}}function He(i,n){1&i&&t._UZ(0,"tr",17)}function Qe(i,n){1&i&&t._UZ(0,"tr",18)}function Ge(i,n){if(1&i&&(t.TgZ(0,"div",7)(1,"p"),t._uU(2),t.ALo(3,"translate"),t.qZA(),t.TgZ(4,"div",8),t._uU(5),t.ALo(6,"translate"),t.qZA(),t.TgZ(7,"table",9),t.ynx(8,10),t.YNc(9,Me,1,0,"th",11),t.YNc(10,Je,2,1,"td",12),t.BQk(),t.YNc(11,He,1,0,"tr",13),t.YNc(12,Qe,1,0,"tr",14),t.qZA()()),2&i){const e=t.oxw();t.xp6(2),t.hij(" ",t.lcZ(3,5,"DIALOGS.REMOVE_OWNERS.DESCRIPTION")," "),t.xp6(3),t.hij(" ",t.lcZ(6,7,"DIALOGS.REMOVE_OWNERS.ASK")," "),t.xp6(2),t.Q6J("dataSource",e.dataSource),t.xp6(4),t.Q6J("matHeaderRowDef",e.displayedColumns),t.xp6(1),t.Q6J("matRowDefColumns",e.displayedColumns)}}let qe=(()=>{class i{constructor(e,s,a,o,r){this.dialogRef=e,this.data=s,this.notificator=a,this.translate=o,this.facilitiesManagerService=r,this.displayedColumns=["name"],o.get("DIALOGS.REMOVE_OWNERS.SUCCESS").subscribe(_=>this.successMessage=_)}ngOnInit(){this.dataSource=new l.by(this.data.owners),this.theme=this.data.theme}onCancel(){this.dialogRef.close(!1)}onSubmit(){this.loading=!0,0!==this.data.owners.length?this.facilitiesManagerService.removeFacilityOwner(this.data.facilityId,this.data.owners.pop().id).subscribe(()=>this.onSubmit(),()=>this.loading=!1):(this.loading=!1,this.notificator.showSuccess(this.successMessage),this.dialogRef.close(!0))}}return i.\u0275fac=function(e){return new(e||i)(t.Y36(u.so),t.Y36(u.WI),t.Y36(d.V6),t.Y36(h.sK),t.Y36(f.IQ))},i.\u0275cmp=t.Xpm({type:i,selectors:[["app-remove-facility-owner-dialog"]],decls:13,vars:15,consts:[["mat-dialog-title",""],["class","mr-auto ml-auto",4,"ngIf"],["mat-dialog-content","",4,"ngIf"],["mat-dialog-actions",""],["mat-flat-button","",1,"ml-auto",3,"click"],["color","warn","mat-flat-button","",1,"ml-2",3,"disabled","click"],[1,"mr-auto","ml-auto"],["mat-dialog-content",""],[1,"font-weight-bold"],["mat-table","",1,"w-100",3,"dataSource"],["matColumnDef","name"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["class","font-weight-bolder","mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["mat-header-cell",""],["mat-cell",""],["mat-header-row","",1,"font-weight-bolder"],["mat-row",""]],template:function(e,s){1&e&&(t.TgZ(0,"h1",0),t._uU(1),t.ALo(2,"translate"),t.qZA(),t.TgZ(3,"div"),t.YNc(4,Ue,1,0,"mat-spinner",1),t.YNc(5,Ge,13,9,"div",2),t.TgZ(6,"div",3)(7,"button",4),t.NdJ("click",function(){return s.onCancel()}),t._uU(8),t.ALo(9,"translate"),t.qZA(),t.TgZ(10,"button",5),t.NdJ("click",function(){return s.onSubmit()}),t._uU(11),t.ALo(12,"translate"),t.qZA()()()),2&e&&(t.xp6(1),t.Oqu(t.lcZ(2,9,"DIALOGS.REMOVE_OWNERS.TITLE")),t.xp6(2),t.Tol(s.theme),t.xp6(1),t.Q6J("ngIf",s.loading),t.xp6(1),t.Q6J("ngIf",!s.loading),t.xp6(3),t.hij(" ",t.lcZ(9,11,"DIALOGS.REMOVE_OWNERS.CANCEL")," "),t.xp6(2),t.Q6J("disabled",s.loading),t.xp6(1),t.hij(" ",t.lcZ(12,13,"DIALOGS.REMOVE_OWNERS.DELETE")," "))},dependencies:[m.O5,C.lW,l.BZ,l.fO,l.as,l.w1,l.Dz,l.nj,l.ge,l.ev,l.XQ,l.Gk,u.uh,u.xY,u.H8,T.Ou,h.X$]}),i})();function Pe(i,n){if(1&i){const e=t.EpF();t.TgZ(0,"button",7),t.NdJ("click",function(){t.CHM(e);const a=t.oxw();return t.KtG(a.onCreate())}),t._uU(1),t.ALo(2,"translate"),t.qZA()}2&i&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"FACILITY_DETAIL.SETTINGS.OWNERS.ADD"),"\n"))}function Ve(i,n){if(1&i){const e=t.EpF();t.TgZ(0,"button",8),t.NdJ("click",function(){t.CHM(e);const a=t.oxw();return t.KtG(a.onRemove())}),t._uU(1),t.ALo(2,"translate"),t.qZA()}if(2&i){const e=t.oxw();t.Q6J("disabled",0===e.selection.selected.length),t.xp6(1),t.hij(" ",t.lcZ(2,2,"FACILITY_DETAIL.SETTINGS.OWNERS.DELETE"),"\n")}}function Be(i,n){1&i&&t._UZ(0,"mat-spinner",9)}function je(i,n){if(1&i&&t._UZ(0,"perun-web-apps-owners-list",10),2&i){const e=t.oxw();t.Q6J("displayedColumns",e.displayedColumns)("filterValue",e.filterValue)("owners",e.owners)("selection",e.selection)("tableId",e.tableId)}}let ut=(()=>{class i{constructor(e,s,a,o){this.facilitiesManagerService=e,this.dialog=s,this.authResolver=a,this.entityStorageService=o,this.ownerEmitter=new t.vpe,this.owners=[],this.selection=new A.Ov(!0,[]),this.displayedColumns=["id","name","contact","type"],this.tableId=x.zp}ngOnInit(){this.filterValue="",this.facility=this.entityStorageService.getEntity(),this.setAuthRights(),this.refreshTable()}refreshTable(){this.loading=!0,this.selection.clear(),this.facilitiesManagerService.getFacilityOwners(this.facility.id).subscribe(e=>{this.owners=e,this.ownerEmitter.emit(this.owners),this.loading=!1})}setAuthRights(){this.addAuth=this.authResolver.isAuthorized("addOwner_Facility_Owner_policy",[this.facility]),this.removeAuth=this.authResolver.isAuthorized("removeOwner_Facility_Owner_policy",[this.facility]),this.displayedColumns=this.removeAuth?["select","id","name","contact","type"]:["id","name","contact","type"]}applyFilter(e){this.filterValue=e}onCreate(){const e=(0,p.kZ)();e.width="800px",e.data={theme:"facility-theme",facilityId:this.facility.id,forbiddenOwners:this.owners.map(a=>a.id)},this.dialog.open(Ye,e).afterClosed().subscribe(a=>{a&&this.refreshTable()})}onRemove(){const e=(0,p.kZ)();e.width="600px",e.data={theme:"facility-theme",owners:this.selection.selected,facilityId:this.facility.id},this.dialog.open(qe,e).afterClosed().subscribe(a=>{a&&this.refreshTable()})}}return i.\u0275fac=function(e){return new(e||i)(t.Y36(f.IQ),t.Y36(u.uw),t.Y36(d.x4),t.Y36(d.fb))},i.\u0275cmp=t.Xpm({type:i,selectors:[["app-facility-settings-owners"]],outputs:{ownerEmitter:"ownerEmitter"},decls:9,vars:8,consts:[[1,"page-subtitle"],[3,"refresh"],["class","mr-2 action-button","color","accent","mat-flat-button","",3,"click",4,"ngIf"],["class","mr-2","color","warn","mat-flat-button","",3,"disabled","click",4,"ngIf"],[3,"placeholder","filter"],["class","ml-auto mr-auto",4,"ngIf"],[3,"displayedColumns","filterValue","owners","selection","tableId",4,"ngIf"],["color","accent","mat-flat-button","",1,"mr-2","action-button",3,"click"],["color","warn","mat-flat-button","",1,"mr-2",3,"disabled","click"],[1,"ml-auto","mr-auto"],[3,"displayedColumns","filterValue","owners","selection","tableId"]],template:function(e,s){1&e&&(t.TgZ(0,"h1",0),t._uU(1),t.ALo(2,"translate"),t.qZA(),t.TgZ(3,"perun-web-apps-refresh-button",1),t.NdJ("refresh",function(){return s.refreshTable()}),t.qZA(),t.YNc(4,Pe,3,3,"button",2),t.YNc(5,Ve,3,4,"button",3),t.TgZ(6,"perun-web-apps-immediate-filter",4),t.NdJ("filter",function(o){return s.applyFilter(o)}),t.qZA(),t.YNc(7,Be,1,0,"mat-spinner",5),t.YNc(8,je,1,5,"perun-web-apps-owners-list",6)),2&e&&(t.xp6(1),t.Oqu(t.lcZ(2,6,"FACILITY_DETAIL.SETTINGS.OWNERS.TITLE")),t.xp6(3),t.Q6J("ngIf",s.addAuth),t.xp6(1),t.Q6J("ngIf",s.removeAuth),t.xp6(1),t.Q6J("placeholder","VO_MANAGEMENT.FILTER_PLACEHOLDER"),t.xp6(1),t.Q6J("ngIf",s.loading),t.xp6(1),t.Q6J("ngIf",!s.loading))},dependencies:[m.O5,C.lW,T.Ou,O.t,D.L,j.Q,h.X$]}),i})();var K=c(19309);function Ke(i,n){1&i&&t._UZ(0,"mat-spinner",6)}function ze(i,n){1&i&&(t.TgZ(0,"mat-error"),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&i&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"DIALOGS.ADD_HOST.EMPTY_MESSAGE")," "))}function $e(i,n){if(1&i&&(t.TgZ(0,"mat-error"),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&i){const e=t.oxw(2);t.xp6(1),t.AsE(" ",t.lcZ(2,2,"DIALOGS.ADD_HOST.INVALID_HOST")," ",e.hostsCtrl.getError("invalidHost").value," ")}}function Xe(i,n){if(1&i&&(t.TgZ(0,"div",7)(1,"mat-form-field")(2,"textarea",8),t.ALo(3,"translate"),t._uU(4,"      "),t.qZA(),t.YNc(5,ze,3,3,"mat-error",9),t.YNc(6,$e,3,4,"mat-error",9),t.qZA(),t.TgZ(7,"perun-web-apps-alert",10),t._uU(8),t.ALo(9,"translate"),t.qZA()()),2&i){const e=t.oxw();t.xp6(2),t.Q6J("formControl",e.hostsCtrl)("placeholder",t.lcZ(3,5,"DIALOGS.ADD_HOST.SUBTITLE")),t.xp6(3),t.Q6J("ngIf",e.hostsCtrl.hasError("required")),t.xp6(1),t.Q6J("ngIf",e.hostsCtrl.hasError("invalidHost")),t.xp6(2),t.Oqu(t.lcZ(9,7,"DIALOGS.ADD_HOST.HINT"))}}let We=(()=>{class i{constructor(e,s,a,o,r){this.dialogRef=e,this.data=s,this.facilitiesManager=a,this.notificator=o,this.translate=r,this.loading=!1,this.hostPattern=new RegExp("^(?!:\\/\\/)(?=.{1,255}$)((.{1,63}\\.){1,127}(?![0-9]*$)[a-z0-9-]+\\.?)$|^(25[0-5]|2[0-4]\\d|[0-1]?\\d?\\d)(\\.(25[0-5]|2[0-4]\\d|[0-1]?\\d?\\d)){3}$")}static parseRange(e){const[s,a]=e.split("-");return[parseInt(s.substring(1,s.length),10),parseInt(a.substring(0,a.length),10)]}ngOnInit(){this.theme=this.data.theme,this.hostsCtrl=new g.p4("",[g.kI.required,this.hostsNameValidator()]),this.hostsCtrl.markAllAsTouched()}onAdd(){this.loading=!0;const e=this.hostsCtrl.value.split("\n");let s=[];for(const a of e)s=s.concat(this.parseHostName(a));this.facilitiesManager.addHosts(this.data.facilityId,s).subscribe(()=>{this.notificator.showSuccess(this.translate.instant("DIALOGS.ADD_HOST.SUCCESS")),this.dialogRef.close(!0)},()=>this.loading=!1)}onCancel(){this.dialogRef.close(!1)}hostsNameValidator(){return e=>{let s=[];const a=e.value.split("\n");for(const o of a)s=s.concat(this.parseHostName(o));for(const o of s)if(!this.hostPattern.test(o))return{invalidHost:{value:o}};return null}}parseHostName(e){const s=new RegExp("[[0-9]+-[0-9]+]","g"),a=e.split(s),o=e.match(s);if(null==o)return""===e?[]:[e];let r=[];for(let _=0;_<a.length-1;_++){const[S,b]=i.parseRange(o[_]);let E=[];for(let y=S;y<=b;y++)E=E.concat(a[_].concat(y.toString()));r=r.concat([E])}return r=r.concat([a[a.length-1]]),this.joinHostNames(r,0)}joinHostNames(e,s){if(s===e.length-1)return e[s];const a=this.joinHostNames(e,s+1),o=[];for(const r of e[s])for(const _ of a)o.push(r.concat(_));return o}}return i.\u0275fac=function(e){return new(e||i)(t.Y36(u.so),t.Y36(u.WI),t.Y36(f.IQ),t.Y36(d.V6),t.Y36(h.sK))},i.\u0275cmp=t.Xpm({type:i,selectors:[["app-add-host-dialog"]],decls:13,vars:15,consts:[["mat-dialog-title",""],["class","ml-auto mr-auto",4,"ngIf"],["class","dialog-container","mat-dialog-content","",4,"ngIf"],["mat-dialog-actions",""],["mat-flat-button","",1,"ml-auto",3,"click"],["color","accent","mat-flat-button","",1,"ml-2",3,"disabled","click"],[1,"ml-auto","mr-auto"],["mat-dialog-content","",1,"dialog-container"],["id","facilityAddHost","name","facilityAddHost","cols","50","required","","matInput","","perunWebAppsAutoFocus","","rows","8",1,"md-textarea","form-control",3,"formControl","placeholder"],[4,"ngIf"],["alert_type","info"]],template:function(e,s){1&e&&(t.TgZ(0,"div")(1,"h1",0),t._uU(2),t.ALo(3,"translate"),t.qZA(),t.YNc(4,Ke,1,0,"mat-spinner",1),t.YNc(5,Xe,10,9,"div",2),t.TgZ(6,"div",3)(7,"button",4),t.NdJ("click",function(){return s.onCancel()}),t._uU(8),t.ALo(9,"translate"),t.qZA(),t.TgZ(10,"button",5),t.NdJ("click",function(){return s.onAdd()}),t._uU(11),t.ALo(12,"translate"),t.qZA()()()),2&e&&(t.Tol(s.theme),t.xp6(2),t.Oqu(t.lcZ(3,9,"DIALOGS.ADD_HOST.TITLE")),t.xp6(2),t.Q6J("ngIf",s.loading),t.xp6(1),t.Q6J("ngIf",!s.loading),t.xp6(3),t.hij(" ",t.lcZ(9,11,"DIALOGS.ADD_HOST.CANCEL")," "),t.xp6(2),t.Q6J("disabled",s.hostsCtrl.invalid||s.loading),t.xp6(1),t.hij(" ",t.lcZ(12,13,"DIALOGS.ADD_HOST.ADD")," "))},dependencies:[m.O5,F.TO,F.KE,B.Nt,g.Fj,g.JJ,g.Q7,g.oH,C.lW,u.uh,u.xY,u.H8,T.Ou,Z.w,K.hT,h.X$]}),i})();function ti(i,n){1&i&&t._UZ(0,"mat-spinner",6)}function ei(i,n){1&i&&t._UZ(0,"th",15)}function ii(i,n){if(1&i&&(t.TgZ(0,"td",16),t._uU(1),t.qZA()),2&i){const e=n.$implicit;t.xp6(1),t.Oqu(e.hostname)}}function si(i,n){1&i&&t._UZ(0,"tr",17)}function ai(i,n){1&i&&t._UZ(0,"tr",18)}function ni(i,n){if(1&i&&(t.TgZ(0,"div",7)(1,"p"),t._uU(2),t.ALo(3,"translate"),t.qZA(),t.TgZ(4,"div",8),t._uU(5),t.ALo(6,"translate"),t.qZA(),t.TgZ(7,"table",9),t.ynx(8,10),t.YNc(9,ei,1,0,"th",11),t.YNc(10,ii,2,1,"td",12),t.BQk(),t.YNc(11,si,1,0,"tr",13),t.YNc(12,ai,1,0,"tr",14),t.qZA()()),2&i){const e=t.oxw();t.xp6(2),t.Oqu(t.lcZ(3,5,"DIALOGS.REMOVE_HOST.DESCRIPTION")),t.xp6(3),t.hij(" ",t.lcZ(6,7,"DIALOGS.REMOVE_HOST.ASK")," "),t.xp6(2),t.Q6J("dataSource",e.dataSource),t.xp6(4),t.Q6J("matHeaderRowDef",e.displayedColumns),t.xp6(1),t.Q6J("matRowDefColumns",e.displayedColumns)}}let oi=(()=>{class i{constructor(e,s,a,o,r){this.dialogRef=e,this.data=s,this.facilitiesManager=a,this.notificator=o,this.translate=r,this.displayedColumns=["name"],this.loading=!1}ngOnInit(){this.theme=this.data.theme,this.hosts=this.data.hosts,this.dataSource=new l.by(this.data.hosts)}onConfirm(){this.loading=!0,this.facilitiesManager.removeHosts(this.data.facilityId,this.hosts.map(e=>e.id)).subscribe(()=>{this.notificator.showSuccess(this.translate.instant("DIALOGS.REMOVE_HOST.SUCCESS")),this.dialogRef.close(!0)},()=>this.loading=!1)}onCancel(){this.dialogRef.close(!1)}}return i.\u0275fac=function(e){return new(e||i)(t.Y36(u.so),t.Y36(u.WI),t.Y36(f.IQ),t.Y36(d.V6),t.Y36(h.sK))},i.\u0275cmp=t.Xpm({type:i,selectors:[["app-remove-host-dialog"]],decls:13,vars:15,consts:[["mat-dialog-title",""],["class","mr-auto ml-auto",4,"ngIf"],["mat-dialog-content","",4,"ngIf"],["mat-dialog-actions",""],["mat-flat-button","",1,"ml-auto",3,"click"],["color","warn","mat-flat-button","",1,"ml-2",3,"disabled","click"],[1,"mr-auto","ml-auto"],["mat-dialog-content",""],[1,"font-weight-bold"],["mat-table","",1,"w-100",3,"dataSource"],["matColumnDef","name"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["class","font-weight-bolder","mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["mat-header-cell",""],["mat-cell",""],["mat-header-row","",1,"font-weight-bolder"],["mat-row",""]],template:function(e,s){1&e&&(t.TgZ(0,"h1",0),t._uU(1),t.ALo(2,"translate"),t.qZA(),t.TgZ(3,"div"),t.YNc(4,ti,1,0,"mat-spinner",1),t.YNc(5,ni,13,9,"div",2),t.TgZ(6,"div",3)(7,"button",4),t.NdJ("click",function(){return s.onCancel()}),t._uU(8),t.ALo(9,"translate"),t.qZA(),t.TgZ(10,"button",5),t.NdJ("click",function(){return s.onConfirm()}),t._uU(11),t.ALo(12,"translate"),t.qZA()()()),2&e&&(t.xp6(1),t.Oqu(t.lcZ(2,9,"DIALOGS.REMOVE_HOST.TITLE")),t.xp6(2),t.Tol(s.theme),t.xp6(1),t.Q6J("ngIf",s.loading),t.xp6(1),t.Q6J("ngIf",!s.loading),t.xp6(3),t.hij(" ",t.lcZ(9,11,"DIALOGS.REMOVE_HOST.CANCEL")," "),t.xp6(2),t.Q6J("disabled",s.loading),t.xp6(1),t.hij(" ",t.lcZ(12,13,"DIALOGS.REMOVE_HOST.CONFIRM")," "))},dependencies:[m.O5,C.lW,l.BZ,l.fO,l.as,l.w1,l.Dz,l.nj,l.ge,l.ev,l.XQ,l.Gk,u.uh,u.xY,u.H8,T.Ou,h.X$]}),i})();var I=c(96308),N=c(18750),pt=c(64597),k=c(9185),w=c(8231),Y=c(14849);function li(i,n){if(1&i){const e=t.EpF();t.TgZ(0,"th",15)(1,"mat-checkbox",16),t.NdJ("change",function(a){t.CHM(e);const o=t.oxw(2);return t.KtG(a?o.masterToggle():null)}),t.ALo(2,"translate"),t.ALo(3,"masterCheckboxLabel"),t.qZA()()}if(2&i){const e=t.oxw().ngIf,s=t.oxw();t.xp6(1),t.Q6J("aria-label",t.lcZ(2,3,t.lcZ(3,5,e.all)))("checked",s.selection.hasValue()&&e.all)("indeterminate",s.selection.hasValue()&&!e.all)}}const ci=function(i){return{name:i}};function ri(i,n){if(1&i){const e=t.EpF();t.TgZ(0,"td",17)(1,"mat-checkbox",18),t.NdJ("change",function(a){const r=t.CHM(e).$implicit,_=t.oxw(2);return t.KtG(a?_.selection.toggle(r):null)})("click",function(a){return a.stopPropagation()}),t.ALo(2,"translate"),t.ALo(3,"checkboxLabel"),t.qZA()()}if(2&i){const e=n.$implicit,s=t.oxw(2);t.xp6(1),t.Q6J("aria-label",t.xi3(2,2,t.lcZ(3,5,s.selection.isSelected(e)),t.VKq(7,ci,e.hostname)))("checked",s.selection.isSelected(e))}}function ui(i,n){1&i&&(t.ynx(0,12),t.YNc(1,li,4,7,"th",13),t.YNc(2,ri,4,9,"td",14),t.BQk())}function pi(i,n){1&i&&(t.TgZ(0,"th",19),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&i&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"SHARED.COMPONENTS.HOSTS_LIST.TABLE_HOST_ID")," "))}function di(i,n){if(1&i&&(t.TgZ(0,"td",20),t._uU(1),t.qZA()),2&i){const e=n.$implicit;t.xp6(1),t.Oqu(e.id)}}function _i(i,n){1&i&&(t.TgZ(0,"th",19),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&i&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"SHARED.COMPONENTS.HOSTS_LIST.TABLE_HOST_NAME")," "))}function mi(i,n){if(1&i&&(t.TgZ(0,"td",21),t.ALo(1,"multiWordDataCy"),t._uU(2),t.qZA()),2&i){const e=n.$implicit;t.uIk("data-cy",t.lcZ(1,2,e.hostname)),t.xp6(2),t.hij(" ",e.hostname," ")}}function hi(i,n){1&i&&t._UZ(0,"tr",22)}const dt=function(i,n){return["/facilities",i,"hosts",n]};function fi(i,n){if(1&i&&t._UZ(0,"tr",23),2&i){const e=n.$implicit,s=t.oxw();t.Q6J("perunWebAppsMiddleClickRouterLink",s.disableRouting?null:t.WLB(2,dt,s.facilityId,e.id))("routerLink",s.disableRouting?null:t.WLB(5,dt,s.facilityId,e.id))}}function gi(i,n){1&i&&(t.TgZ(0,"perun-web-apps-alert",24),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&i&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"SHARED_LIB.UI.ALERTS.NO_FILTER_RESULTS_ALERT"),"\n"))}function Ti(i,n){1&i&&(t.TgZ(0,"perun-web-apps-alert",24),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&i&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"SHARED.COMPONENTS.HOSTS_LIST.NO_HOST_WARNING"),"\n"))}const Si=function(i){return{all:i}};let _t=(()=>{class i{constructor(e,s){this.authResolver=e,this.tableCheckbox=s,this.hosts=[],this.selection=new A.Ov(!0,[]),this.disableRouting=!1,this.displayedColumns=["select","id","name"],this.pageSizeOptions=p.f7}set matSort(e){this.sort=e,this.setDataSource()}static getDataForColumn(e,s){switch(s){case"id":return e.id.toString();case"name":return e.hostname;default:return""}}ngOnChanges(){this.authResolver.isPerunAdminOrObserver()||(this.displayedColumns=this.displayedColumns.filter(e=>"id"!==e)),this.dataSource=new l.by(this.hosts),this.setDataSource(),this.dataSource.filter=this.filterValue}exportAllData(e){(0,p.O6)((0,p.Xn)(this.dataSource.filteredData,this.displayedColumns,i.getDataForColumn),e)}exportDisplayedData(e){const s=this.dataSource.paginator.pageIndex*this.dataSource.paginator.pageSize,a=s+this.dataSource.paginator.pageSize;(0,p.O6)((0,p.Xn)(this.dataSource.sortData(this.dataSource.filteredData,this.dataSource.sort).slice(s,a),this.displayedColumns,i.getDataForColumn),e)}setDataSource(){this.dataSource&&(this.dataSource.sort=this.sort,this.dataSource.filterPredicate=(e,s)=>(0,p.Sd)(e,s,this.displayedColumns,i.getDataForColumn),this.dataSource.sortData=(e,s)=>(0,p.pR)(e,s,i.getDataForColumn),this.dataSource.paginator=this.child.paginator)}isAllSelected(){return this.tableCheckbox.isAllSelected(this.selection.selected.length,this.dataSource)}masterToggle(){this.tableCheckbox.masterToggle(this.isAllSelected(),this.selection,this.filterValue,this.dataSource,this.sort,this.child.paginator.pageSize,this.child.paginator.pageIndex,!1)}ngAfterViewInit(){this.dataSource.paginator=this.child.paginator}}return i.\u0275fac=function(e){return new(e||i)(t.Y36(d.x4),t.Y36(d.UA))},i.\u0275cmp=t.Xpm({type:i,selectors:[["app-hosts-list"]],viewQuery:function(e,s){if(1&e&&(t.Gf(p.l9,7),t.Gf(I.YE,7)),2&e){let a;t.iGM(a=t.CRH())&&(s.child=a.first),t.iGM(a=t.CRH())&&(s.matSort=a.first)}},inputs:{hosts:"hosts",selection:"selection",filterValue:"filterValue",tableId:"tableId",facilityId:"facilityId",disableRouting:"disableRouting",displayedColumns:"displayedColumns"},features:[t.TTD],decls:15,vars:15,consts:[[1,"card","mt-3",3,"hidden"],[3,"pageSizeOptions","dataLength","tableId","exportDisplayedData","exportAllData"],["mat-table","","matSort","","matSortActive","id","matSortDirection","asc","matSortDisableClear","",1,"w-100",3,"dataSource"],["matColumnDef","select",4,"ngIf"],["matColumnDef","id"],["mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["class","static-column-size","mat-cell","",4,"matCellDef"],["matColumnDef","name"],["mat-cell","",4,"matCellDef"],["mat-header-row","",4,"matHeaderRowDef"],["class","dark-hover-list-item","mat-row","",3,"perunWebAppsMiddleClickRouterLink","routerLink",4,"matRowDef","matRowDefColumns"],["alert_type","warn",4,"ngIf"],["matColumnDef","select"],["class","align-checkbox","mat-header-cell","",4,"matHeaderCellDef"],["class","static-column-size align-checkbox","mat-cell","",4,"matCellDef"],["mat-header-cell","",1,"align-checkbox"],["color","primary",3,"aria-label","checked","indeterminate","change"],["mat-cell","",1,"static-column-size","align-checkbox"],["color","primary",3,"aria-label","checked","change","click"],["mat-header-cell","","mat-sort-header",""],["mat-cell","",1,"static-column-size"],["mat-cell",""],["mat-header-row",""],["mat-row","",1,"dark-hover-list-item",3,"perunWebAppsMiddleClickRouterLink","routerLink"],["alert_type","warn"]],template:function(e,s){1&e&&(t.TgZ(0,"div",0)(1,"perun-web-apps-table-wrapper",1),t.NdJ("exportDisplayedData",function(o){return s.exportDisplayedData(o)})("exportAllData",function(o){return s.exportAllData(o)}),t.TgZ(2,"table",2),t.YNc(3,ui,3,0,"ng-container",3),t.ALo(4,"isAllSelected"),t.ynx(5,4),t.YNc(6,pi,3,3,"th",5),t.YNc(7,di,2,1,"td",6),t.BQk(),t.ynx(8,7),t.YNc(9,_i,3,3,"th",5),t.YNc(10,mi,3,4,"td",8),t.BQk(),t.YNc(11,hi,1,0,"tr",9),t.YNc(12,fi,1,8,"tr",10),t.qZA()()(),t.YNc(13,gi,3,3,"perun-web-apps-alert",11),t.YNc(14,Ti,3,3,"perun-web-apps-alert",11)),2&e&&(t.Q6J("hidden",0===s.dataSource.filteredData.length||0===s.hosts.length),t.xp6(1),t.Q6J("pageSizeOptions",s.pageSizeOptions)("dataLength",s.dataSource.filteredData.length)("tableId",s.tableId),t.xp6(1),t.Q6J("dataSource",s.dataSource),t.xp6(1),t.Q6J("ngIf",t.VKq(13,Si,t.xi3(4,10,s.dataSource,s.selection.selected.length))),t.xp6(8),t.Q6J("matHeaderRowDef",s.displayedColumns),t.xp6(1),t.Q6J("matRowDefColumns",s.displayedColumns),t.xp6(1),t.Q6J("ngIf",0===s.dataSource.filteredData.length&&0!==s.hosts.length),t.xp6(1),t.Q6J("ngIf",0===s.hosts.length))},dependencies:[m.O5,v.rH,I.YE,I.nU,l.BZ,l.fO,l.as,l.w1,l.Dz,l.nj,l.ge,l.ev,l.XQ,l.Gk,L.oG,Z.w,K.YH,N.l,h.X$,pt.R,k.I,w.G,Y.r],styles:[".disable-outline[_ngcontent-%COMP%]{outline:none!important}.cursor-pointer[_ngcontent-%COMP%]{cursor:pointer}"]}),i})();function Ci(i,n){if(1&i){const e=t.EpF();t.TgZ(0,"button",7),t.NdJ("click",function(){t.CHM(e);const a=t.oxw();return t.KtG(a.addHost())}),t._uU(1),t.ALo(2,"translate"),t.qZA()}2&i&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"FACILITY_DETAIL.HOSTS.ADD")," "))}function Ai(i,n){if(1&i){const e=t.EpF();t.TgZ(0,"button",8),t.NdJ("click",function(){t.CHM(e);const a=t.oxw();return t.KtG(a.removeHost())}),t._uU(1),t.ALo(2,"translate"),t.qZA()}if(2&i){const e=t.oxw();t.Q6J("disabled",0===e.selected.selected.length),t.xp6(1),t.hij(" ",t.lcZ(2,2,"FACILITY_DETAIL.HOSTS.REMOVE")," ")}}function Ii(i,n){1&i&&t._UZ(0,"mat-spinner",9)}function bi(i,n){if(1&i&&t._UZ(0,"app-hosts-list",10),2&i){const e=t.oxw();t.Q6J("disableRouting",!e.routeAuth||e.disableRouting)("filterValue",e.filterValue)("hosts",e.hosts)("selection",e.selected)("displayedColumns",e.displayedColumns)("facilityId",e.facility.id)("tableId",e.tableId)}}let mt=(()=>{class i{constructor(e,s,a,o){this.dialog=e,this.facilitiesManager=s,this.authResolver=a,this.entityStorageService=o,this.disableRouting=!1,this.hostEmitter=new t.vpe,this.hosts=[],this.selected=new A.Ov(!0,[]),this.filterValue="",this.tableId=x.eq,this.displayedColumns=["id","name"]}ngOnInit(){this.loading=!0,this.facility=this.entityStorageService.getEntity(),this.setAuthRights(),this.facilitiesManager.getFacilityById(this.facility.id).subscribe(e=>{this.facility=e,this.refreshTable()})}refreshTable(){this.loading=!0,this.facilitiesManager.getHosts(this.facility.id).subscribe(e=>{this.hosts=e,this.hostEmitter.emit(this.hosts),this.selected.clear(),this.setAuthRights(),this.loading=!1})}setAuthRights(){this.addAuth=this.authResolver.isAuthorized("addHosts_Facility_List<String>_policy",[this.facility]),this.removeAuth=this.authResolver.isAuthorized("removeHosts_List<Host>_Facility_policy",[this.facility]),this.displayedColumns=this.removeAuth?["select","id","name"]:["id","name"],0!==this.hosts.length&&(this.routeAuth=this.authResolver.isAuthorized("getHostById_int_policy",[this.facility,this.hosts[0]]))}addHost(){const e=(0,p.kZ)();e.width="600px",e.data={facilityId:this.facility.id,theme:"facility-theme"},this.dialog.open(We,e).afterClosed().subscribe(a=>{a&&this.refreshTable()})}removeHost(){const e=(0,p.kZ)();e.width="600px",e.data={facilityId:this.facility.id,theme:"facility-theme",hosts:this.selected.selected},this.dialog.open(oi,e).afterClosed().subscribe(a=>{a&&this.refreshTable()})}applyFilter(e){this.filterValue=e}}return i.\u0275fac=function(e){return new(e||i)(t.Y36(u.uw),t.Y36(f.IQ),t.Y36(d.x4),t.Y36(d.fb))},i.\u0275cmp=t.Xpm({type:i,selectors:[["app-facility-hosts"]],inputs:{disableRouting:"disableRouting"},outputs:{hostEmitter:"hostEmitter"},decls:10,vars:8,consts:[[1,"page-subtitle"],[3,"refresh"],["color","accent","class","mr-2 action-button","mat-flat-button","",3,"click",4,"ngIf"],["class","mr-2","color","warn","mat-flat-button","",3,"disabled","click",4,"ngIf"],[3,"placeholder","filter"],["class","ml-auto mr-auto",4,"ngIf"],[3,"disableRouting","filterValue","hosts","selection","displayedColumns","facilityId","tableId",4,"ngIf"],["color","accent","mat-flat-button","",1,"mr-2","action-button",3,"click"],["color","warn","mat-flat-button","",1,"mr-2",3,"disabled","click"],[1,"ml-auto","mr-auto"],[3,"disableRouting","filterValue","hosts","selection","displayedColumns","facilityId","tableId"]],template:function(e,s){1&e&&(t.TgZ(0,"div")(1,"h1",0),t._uU(2),t.ALo(3,"translate"),t.qZA(),t.TgZ(4,"perun-web-apps-refresh-button",1),t.NdJ("refresh",function(){return s.refreshTable()}),t.qZA(),t.YNc(5,Ci,3,3,"button",2),t.YNc(6,Ai,3,4,"button",3),t.TgZ(7,"perun-web-apps-immediate-filter",4),t.NdJ("filter",function(o){return s.applyFilter(o)}),t.qZA(),t.YNc(8,Ii,1,0,"mat-spinner",5),t.YNc(9,bi,1,7,"app-hosts-list",6),t.qZA()),2&e&&(t.xp6(2),t.Oqu(t.lcZ(3,6,"FACILITY_DETAIL.HOSTS.TITLE")),t.xp6(3),t.Q6J("ngIf",s.addAuth),t.xp6(1),t.Q6J("ngIf",s.removeAuth),t.xp6(1),t.Q6J("placeholder","FACILITY_DETAIL.HOSTS.FILTER"),t.xp6(1),t.Q6J("ngIf",s.loading),t.xp6(1),t.Q6J("ngIf",!s.loading))},dependencies:[m.O5,C.lW,T.Ou,_t,O.t,D.L,h.X$]}),i})();function yi(i,n){if(1&i){const e=t.EpF();t.TgZ(0,"th",16)(1,"mat-checkbox",17),t.NdJ("change",function(a){t.CHM(e);const o=t.oxw(2);return t.KtG(a?o.masterToggle():null)}),t.ALo(2,"translate"),t.ALo(3,"masterCheckboxLabel"),t.qZA()()}if(2&i){const e=t.oxw().ngIf,s=t.oxw();t.xp6(1),t.Q6J("aria-label",t.lcZ(2,3,t.lcZ(3,5,e.all)))("checked",s.selection.hasValue()&&e.all)("indeterminate",s.selection.hasValue()&&!e.all)}}const vi=function(i){return{name:i}};function xi(i,n){if(1&i){const e=t.EpF();t.TgZ(0,"td",18)(1,"mat-checkbox",19),t.NdJ("change",function(a){const r=t.CHM(e).$implicit,_=t.oxw(2);return t.KtG(a?_.selection.toggle(r):null)})("click",function(a){return a.stopPropagation()}),t.ALo(2,"translate"),t.ALo(3,"checkboxLabel"),t.ALo(4,"userFullName"),t.qZA()()}if(2&i){const e=n.$implicit,s=t.oxw(2);t.xp6(1),t.Q6J("aria-label",t.xi3(2,2,t.lcZ(3,5,s.selection.isSelected(e)),t.VKq(9,vi,t.lcZ(4,7,e[1]))))("checked",s.selection.isSelected(e))}}function Di(i,n){1&i&&(t.ynx(0,13),t.YNc(1,yi,4,7,"th",14),t.YNc(2,xi,5,11,"td",15),t.BQk())}function Ei(i,n){1&i&&(t.TgZ(0,"th",20),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&i&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"SHARED.COMPONENTS.BLACKLIST_LIST.USER_ID")," "))}function Li(i,n){if(1&i&&(t.TgZ(0,"td",21),t._uU(1),t.qZA()),2&i){const e=n.$implicit;t.xp6(1),t.hij(" ",e[1].id," ")}}function Zi(i,n){1&i&&(t.TgZ(0,"th",20),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&i&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"SHARED.COMPONENTS.BLACKLIST_LIST.NAME")," "))}function Oi(i,n){if(1&i&&(t.TgZ(0,"td",22),t._uU(1),t.ALo(2,"userFullName"),t.qZA()),2&i){const e=n.$implicit;t.xp6(1),t.hij(" ",t.lcZ(2,1,e[1])," ")}}function Ri(i,n){1&i&&(t.TgZ(0,"th",20),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&i&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"SHARED.COMPONENTS.BLACKLIST_LIST.REASON")," "))}function Fi(i,n){if(1&i&&(t.TgZ(0,"td",22),t._uU(1),t.qZA()),2&i){const e=n.$implicit;t.xp6(1),t.hij(" ",e[0].description," ")}}function Ni(i,n){1&i&&t._UZ(0,"tr",23)}function ki(i,n){1&i&&t._UZ(0,"tr",24)}function wi(i,n){1&i&&(t.TgZ(0,"perun-web-apps-alert",25),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&i&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"SHARED_LIB.UI.ALERTS.NO_FILTER_RESULTS_ALERT"),"\n"))}function Yi(i,n){1&i&&(t.TgZ(0,"perun-web-apps-alert",25),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&i&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"SHARED.COMPONENTS.BLACKLIST_LIST.NO_BANS_WARNING"),"\n"))}const Ui=function(i){return{all:i}};let Mi=(()=>{class i{constructor(e,s){this.authResolver=e,this.tableCheckbox=s,this.bansOnFacilitiesWithUsers=[],this.selection=new A.Ov(!0,[]),this.pageSizeOptions=p.f7,this.displayedColumns=["select","userId","name","reason"]}set matSort(e){this.sort=e,this.setDataSource()}static getDataForColumn(e,s){switch(s){case"userId":return e[1].id.toString();case"reason":return e[0].description;case"name":return(0,p.hu)(e[1]);default:return""}}ngOnChanges(){this.authResolver.isPerunAdminOrObserver()||(this.displayedColumns=this.displayedColumns.filter(e=>"userId"!==e)),this.dataSource=new l.by(this.bansOnFacilitiesWithUsers),this.setDataSource(),this.dataSource.filter=this.filterValue}exportAllData(e){(0,p.O6)((0,p.Xn)(this.dataSource.filteredData,this.displayedColumns,i.getDataForColumn),e)}exportDisplayedData(e){const s=this.dataSource.paginator.pageIndex*this.dataSource.paginator.pageSize,a=s+this.dataSource.paginator.pageSize;(0,p.O6)((0,p.Xn)(this.dataSource.sortData(this.dataSource.filteredData,this.dataSource.sort).slice(s,a),this.displayedColumns,i.getDataForColumn),e)}setDataSource(){this.dataSource&&(this.dataSource.filterPredicate=(e,s)=>(0,p.Sd)(e,s,this.displayedColumns,i.getDataForColumn),this.dataSource.sortData=(e,s)=>(0,p.pR)(e,s,i.getDataForColumn),this.dataSource.sort=this.sort,this.dataSource.paginator=this.child.paginator)}isAllSelected(){return this.tableCheckbox.isAllSelected(this.selection.selected.length,this.dataSource)}masterToggle(){this.tableCheckbox.masterToggle(this.isAllSelected(),this.selection,this.filterValue,this.dataSource,this.sort,this.child.paginator.pageSize,this.child.paginator.pageIndex,!1)}ngAfterViewInit(){this.dataSource.paginator=this.child.paginator}}return i.\u0275fac=function(e){return new(e||i)(t.Y36(d.x4),t.Y36(d.UA))},i.\u0275cmp=t.Xpm({type:i,selectors:[["app-perun-web-apps-blacklist-list"]],viewQuery:function(e,s){if(1&e&&(t.Gf(p.l9,7),t.Gf(I.YE,7)),2&e){let a;t.iGM(a=t.CRH())&&(s.child=a.first),t.iGM(a=t.CRH())&&(s.matSort=a.first)}},inputs:{bansOnFacilitiesWithUsers:"bansOnFacilitiesWithUsers",selection:"selection",filterValue:"filterValue",tableId:"tableId"},features:[t.TTD],decls:18,vars:15,consts:[[1,"card","mt-3",3,"hidden"],[3,"pageSizeOptions","dataLength","tableId","exportDisplayedData","exportAllData"],["mat-table","","matSort","","matSortActive","id","matSortDirection","asc","matSortDisableClear","",1,"w-100",3,"dataSource"],["matColumnDef","select",4,"ngIf"],["matColumnDef","userId"],["mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["class","static-column-size","mat-cell","",4,"matCellDef"],["matColumnDef","name"],["mat-cell","",4,"matCellDef"],["matColumnDef","reason"],["mat-header-row","",4,"matHeaderRowDef"],["class","dark-hover-list-item","mat-row","",4,"matRowDef","matRowDefColumns"],["alert_type","warn",4,"ngIf"],["matColumnDef","select"],["class","align-checkbox","mat-header-cell","",4,"matHeaderCellDef"],["class","static-column-size align-checkbox","mat-cell","",4,"matCellDef"],["mat-header-cell","",1,"align-checkbox"],["color","primary",3,"aria-label","checked","indeterminate","change"],["mat-cell","",1,"static-column-size","align-checkbox"],["color","primary",3,"aria-label","checked","change","click"],["mat-header-cell","","mat-sort-header",""],["mat-cell","",1,"static-column-size"],["mat-cell",""],["mat-header-row",""],["mat-row","",1,"dark-hover-list-item"],["alert_type","warn"]],template:function(e,s){1&e&&(t.TgZ(0,"div",0)(1,"perun-web-apps-table-wrapper",1),t.NdJ("exportDisplayedData",function(o){return s.exportDisplayedData(o)})("exportAllData",function(o){return s.exportAllData(o)}),t.TgZ(2,"table",2),t.YNc(3,Di,3,0,"ng-container",3),t.ALo(4,"isAllSelected"),t.ynx(5,4),t.YNc(6,Ei,3,3,"th",5),t.YNc(7,Li,2,1,"td",6),t.BQk(),t.ynx(8,7),t.YNc(9,Zi,3,3,"th",5),t.YNc(10,Oi,3,3,"td",8),t.BQk(),t.ynx(11,9),t.YNc(12,Ri,3,3,"th",5),t.YNc(13,Fi,2,1,"td",8),t.BQk(),t.YNc(14,Ni,1,0,"tr",10),t.YNc(15,ki,1,0,"tr",11),t.qZA()()(),t.YNc(16,wi,3,3,"perun-web-apps-alert",12),t.YNc(17,Yi,3,3,"perun-web-apps-alert",12)),2&e&&(t.Q6J("hidden",0===s.dataSource.filteredData.length||0===s.bansOnFacilitiesWithUsers.length),t.xp6(1),t.Q6J("pageSizeOptions",s.pageSizeOptions)("dataLength",s.dataSource.filteredData.length)("tableId",s.tableId),t.xp6(1),t.Q6J("dataSource",s.dataSource),t.xp6(1),t.Q6J("ngIf",t.VKq(13,Ui,t.xi3(4,10,s.dataSource,s.selection.selected.length))),t.xp6(11),t.Q6J("matHeaderRowDef",s.displayedColumns),t.xp6(1),t.Q6J("matRowDefColumns",s.displayedColumns),t.xp6(1),t.Q6J("ngIf",0===s.dataSource.filteredData.length&&0!==s.bansOnFacilitiesWithUsers.length),t.xp6(1),t.Q6J("ngIf",0===s.bansOnFacilitiesWithUsers.length))},dependencies:[m.O5,I.YE,I.nU,l.BZ,l.fO,l.as,l.w1,l.Dz,l.nj,l.ge,l.ev,l.XQ,l.Gk,L.oG,Z.w,N.l,h.X$,nt.d,k.I,w.G,Y.r]}),i})();function Ji(i,n){1&i&&t._UZ(0,"mat-spinner",5)}function Hi(i,n){if(1&i&&t._UZ(0,"app-perun-web-apps-blacklist-list",6),2&i){const e=t.oxw();t.Q6J("bansOnFacilitiesWithUsers",e.bansOnFacilitiesWithUsers)("filterValue",e.filterValue)("selection",e.selected)("tableId",e.tableId)}}let Qi=(()=>{class i{constructor(e,s,a){this.facilitiesManager=e,this.usersManager=s,this.entityStorageService=a,this.bansOnFacilitiesWithUsers=[],this.selected=new A.Ov(!0,[]),this.filterValue="",this.tableId=x.NG}ngOnInit(){this.loading=!0,this.facility=this.entityStorageService.getEntity(),this.refreshTable()}refreshTable(){this.loading=!0,this.facilitiesManager.getBansForFacility(this.facility.id).subscribe(e=>{const s=e;for(const a of s){let o;this.usersManager.getUserById(a.userId).subscribe(r=>{o=r}),this.bansOnFacilitiesWithUsers.push([a,o])}this.selected.clear(),this.loading=!1})}applyFilter(e){this.filterValue=e}}return i.\u0275fac=function(e){return new(e||i)(t.Y36(f.IQ),t.Y36(f.Fv),t.Y36(d.fb))},i.\u0275cmp=t.Xpm({type:i,selectors:[["app-perun-web-apps-facility-settings-blacklist"]],decls:9,vars:8,consts:[[1,"page-subtitle"],[3,"refresh"],[3,"placeholder","filter"],["class","ml-auto mr-auto",4,"ngIf"],[3,"bansOnFacilitiesWithUsers","filterValue","selection","tableId",4,"ngIf"],[1,"ml-auto","mr-auto"],[3,"bansOnFacilitiesWithUsers","filterValue","selection","tableId"]],template:function(e,s){1&e&&(t.TgZ(0,"div")(1,"h1",0),t._uU(2),t.ALo(3,"translate"),t.qZA(),t.TgZ(4,"perun-web-apps-refresh-button",1),t.NdJ("refresh",function(){return s.refreshTable()}),t.qZA(),t.TgZ(5,"perun-web-apps-immediate-filter",2),t.NdJ("filter",function(o){return s.applyFilter(o)}),t.ALo(6,"translate"),t.qZA(),t.YNc(7,Ji,1,0,"mat-spinner",3),t.YNc(8,Hi,1,4,"app-perun-web-apps-blacklist-list",4),t.qZA()),2&e&&(t.xp6(2),t.Oqu(t.lcZ(3,4,"FACILITY_DETAIL.SETTINGS.BLACKLIST.TITLE")),t.xp6(3),t.Q6J("placeholder",t.lcZ(6,6,"FACILITY_DETAIL.SETTINGS.BLACKLIST.FILTER")),t.xp6(2),t.Q6J("ngIf",s.loading),t.xp6(1),t.Q6J("ngIf",!s.loading))},dependencies:[m.O5,T.Ou,Mi,O.t,D.L,h.X$]}),i})();var Gi=c(85147),qi=c(61365),Pi=c(71103),ht=c(53984);const Vi=["list"];function Bi(i,n){1&i&&t._UZ(0,"mat-spinner",7)}function ji(i,n){if(1&i&&t._UZ(0,"perun-web-apps-attributes-list",8,9),2&i){const e=t.oxw();t.Q6J("selection",e.selected)("attributes",e.attributes)("tableId",e.tableId)}}let Ki=(()=>{class i{constructor(e,s,a,o){this.dialog=e,this.attributesManager=s,this.facilityManager=a,this.route=o,this.attributes=[],this.selected=new A.Ov(!0,[]),this.host={beanName:"",id:0},this.tableId=x.rF}ngOnInit(){this.route.params.subscribe(e=>{this.hostId=Number(e.hostId),this.facilityManager.getHostById(this.hostId).subscribe(s=>{this.host=s}),this.refreshTable()})}refreshTable(){this.loading=!0,this.attributesManager.getHostAttributes(this.hostId).subscribe(e=>{this.attributes=(0,p.MX)(e),this.selected.clear(),this.loading=!1})}onSave(){this.list.updateMapAttributes();const e=(0,p.kZ)();e.width="450px",e.data={entityId:this.hostId,entity:"host",attributes:this.selected.selected},this.dialog.open(P.wA,e).afterClosed().subscribe(a=>{a&&this.refreshTable()})}addAttribute(){const e=(0,p.kZ)();e.width="1050px",e.data={entityId:this.hostId,entity:"host",notEmptyAttributes:this.attributes,style:"facility-theme"},this.dialog.open(Pi.n,e).afterClosed().subscribe(a=>{"saved"===a&&this.refreshTable()})}removeAttribute(){const e=(0,p.kZ)();e.width="450px",e.data={entityId:this.hostId,entity:"host",attributes:this.selected.selected,theme:"facility-theme"},this.dialog.open(qi.k,e).afterClosed().subscribe(a=>{a&&this.refreshTable()})}}return i.\u0275fac=function(e){return new(e||i)(t.Y36(u.uw),t.Y36(f.H8),t.Y36(f.IQ),t.Y36(v.gz))},i.\u0275cmp=t.Xpm({type:i,selectors:[["app-facility-hosts-detail"]],viewQuery:function(e,s){if(1&e&&t.Gf(Vi,5),2&e){let a;t.iGM(a=t.CRH())&&(s.list=a.first)}},decls:16,vars:17,consts:[[1,"page-subtitle"],[3,"refresh"],["color","accent","mat-flat-button","",1,"mr-2",3,"click"],["color","accent","mat-flat-button","",1,"mr-2",3,"disabled","click"],["color","warn","mat-flat-button","",3,"disabled","click"],["class","ml-auto mr-auto",4,"ngIf"],[3,"selection","attributes","tableId",4,"ngIf"],[1,"ml-auto","mr-auto"],[3,"selection","attributes","tableId"],["list",""]],template:function(e,s){1&e&&(t.TgZ(0,"div")(1,"h1",0),t._uU(2),t.ALo(3,"translate"),t.qZA(),t.TgZ(4,"perun-web-apps-refresh-button",1),t.NdJ("refresh",function(){return s.refreshTable()}),t.qZA(),t.TgZ(5,"button",2),t.NdJ("click",function(){return s.addAttribute()}),t._uU(6),t.ALo(7,"translate"),t.qZA(),t.TgZ(8,"button",3),t.NdJ("click",function(){return s.onSave()}),t._uU(9),t.ALo(10,"translate"),t.qZA(),t.TgZ(11,"button",4),t.NdJ("click",function(){return s.removeAttribute()}),t._uU(12),t.ALo(13,"translate"),t.qZA(),t.YNc(14,Bi,1,0,"mat-spinner",5),t.YNc(15,ji,2,3,"perun-web-apps-attributes-list",6),t.qZA()),2&e&&(t.xp6(2),t.AsE(" ",t.lcZ(3,9,"FACILITY_DETAIL.HOSTS.HOSTS_DETAIL.TITLE")," ",s.host.hostname," "),t.xp6(4),t.hij(" ",t.lcZ(7,11,"FACILITY_DETAIL.HOSTS.HOSTS_DETAIL.ADD")," "),t.xp6(2),t.Q6J("disabled",0===s.selected.selected.length),t.xp6(1),t.hij(" ",t.lcZ(10,13,"FACILITY_DETAIL.HOSTS.HOSTS_DETAIL.SAVE")," "),t.xp6(2),t.Q6J("disabled",0===s.selected.selected.length),t.xp6(1),t.hij(" ",t.lcZ(13,15,"FACILITY_DETAIL.HOSTS.HOSTS_DETAIL.REMOVE")," "),t.xp6(2),t.Q6J("ngIf",s.loading),t.xp6(1),t.Q6J("ngIf",!s.loading))},dependencies:[m.O5,C.lW,T.Ou,O.t,ht.p,h.X$]}),i})();function zi(i,n){if(1&i){const e=t.EpF();t.TgZ(0,"th",16)(1,"mat-checkbox",17),t.NdJ("change",function(a){t.CHM(e);const o=t.oxw(2);return t.KtG(a?o.masterToggle():null)}),t.ALo(2,"translate"),t.ALo(3,"masterCheckboxLabel"),t.qZA()()}if(2&i){const e=t.oxw().ngIf,s=t.oxw();t.xp6(1),t.Q6J("aria-label",t.lcZ(2,3,t.lcZ(3,5,e.all)))("checked",s.selection.hasValue()&&e.all)("indeterminate",s.selection.hasValue()&&!e.all)}}const $i=function(i){return{name:i}};function Xi(i,n){if(1&i){const e=t.EpF();t.TgZ(0,"td",18)(1,"mat-checkbox",19),t.NdJ("change",function(a){const r=t.CHM(e).$implicit,_=t.oxw(2);return t.KtG(a?_.selection.toggle(r):null)})("click",function(a){return a.stopPropagation()}),t.ALo(2,"translate"),t.ALo(3,"checkboxLabel"),t.qZA()()}if(2&i){const e=n.$implicit,s=t.oxw(2);t.xp6(1),t.Q6J("aria-label",t.xi3(2,2,t.lcZ(3,5,s.selection.isSelected(e)),t.VKq(7,$i,e.name)))("checked",s.selection.isSelected(e))}}function Wi(i,n){1&i&&(t.ynx(0,13),t.YNc(1,zi,4,7,"th",14),t.YNc(2,Xi,4,9,"td",15),t.BQk())}function ts(i,n){1&i&&(t.TgZ(0,"th",20),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&i&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"SHARED.COMPONENTS.SECURITY_TEAMS_LIST.ID")," "))}function es(i,n){if(1&i&&(t.TgZ(0,"td",21),t._uU(1),t.qZA()),2&i){const e=n.$implicit;t.xp6(1),t.hij(" ",e.id," ")}}function is(i,n){1&i&&(t.TgZ(0,"th",20),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&i&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"SHARED.COMPONENTS.SECURITY_TEAMS_LIST.NAME")," "))}function ss(i,n){if(1&i&&(t.TgZ(0,"td",22),t._uU(1),t.qZA()),2&i){const e=n.$implicit;t.xp6(1),t.Oqu(e.name)}}function as(i,n){1&i&&(t.TgZ(0,"th",20),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&i&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"SHARED.COMPONENTS.SECURITY_TEAMS_LIST.DESCRIPTION")," "))}function ns(i,n){if(1&i&&(t.TgZ(0,"td",22),t._uU(1),t.qZA()),2&i){const e=n.$implicit;t.xp6(1),t.Oqu(e.description)}}function os(i,n){1&i&&t._UZ(0,"tr",23)}function ls(i,n){1&i&&t._UZ(0,"tr",24)}function cs(i,n){1&i&&(t.TgZ(0,"perun-web-apps-alert",25),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&i&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"SHARED_LIB.UI.ALERTS.NO_FILTER_RESULTS_ALERT"),"\n"))}function rs(i,n){1&i&&(t.TgZ(0,"perun-web-apps-alert",25),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&i&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"SHARED.COMPONENTS.SECURITY_TEAMS_LIST.NO_SECURITY_TEAMS_WARNING"),"\n"))}const us=function(i){return{all:i}};let ps=(()=>{class i{constructor(e,s){this.authResolver=e,this.tableCheckbox=s,this.securityTeams=[],this.selection=new A.Ov(!0,[]),this.displayedColumns=["select","id","name","description"],this.pageSizeOptions=p.f7}set matSort(e){this.sort=e,this.setDataSource()}static getDataForColumn(e,s){switch(s){case"id":return e.id.toString();case"name":return e.name;case"description":return e.description;default:return""}}ngOnChanges(){this.authResolver.isPerunAdminOrObserver()||(this.displayedColumns=this.displayedColumns.filter(e=>"id"!==e)),this.dataSource=new l.by(this.securityTeams),this.setDataSource(),this.dataSource.filter=this.filterValue}exportAllData(e){(0,p.O6)((0,p.Xn)(this.dataSource.filteredData,this.displayedColumns,i.getDataForColumn),e)}exportDisplayedData(e){const s=this.dataSource.paginator.pageIndex*this.dataSource.paginator.pageSize,a=s+this.dataSource.paginator.pageSize;(0,p.O6)((0,p.Xn)(this.dataSource.sortData(this.dataSource.filteredData,this.dataSource.sort).slice(s,a),this.displayedColumns,i.getDataForColumn),e)}setDataSource(){this.dataSource&&(this.dataSource.filterPredicate=(e,s)=>(0,p.Sd)(e,s,this.displayedColumns,i.getDataForColumn),this.dataSource.sortData=(e,s)=>(0,p.pR)(e,s,i.getDataForColumn),this.dataSource.sort=this.sort,this.dataSource.paginator=this.child.paginator)}isAllSelected(){return this.tableCheckbox.isAllSelected(this.selection.selected.length,this.dataSource)}masterToggle(){this.tableCheckbox.masterToggle(this.isAllSelected(),this.selection,this.filterValue,this.dataSource,this.sort,this.child.paginator.pageSize,this.child.paginator.pageIndex,!1)}ngAfterViewInit(){this.dataSource.paginator=this.child.paginator}}return i.\u0275fac=function(e){return new(e||i)(t.Y36(d.x4),t.Y36(d.UA))},i.\u0275cmp=t.Xpm({type:i,selectors:[["app-security-teams-list"]],viewQuery:function(e,s){if(1&e&&(t.Gf(p.l9,7),t.Gf(I.YE,7)),2&e){let a;t.iGM(a=t.CRH())&&(s.child=a.first),t.iGM(a=t.CRH())&&(s.matSort=a.first)}},inputs:{securityTeams:"securityTeams",selection:"selection",filterValue:"filterValue",tableId:"tableId",displayedColumns:"displayedColumns"},features:[t.TTD],decls:18,vars:15,consts:[[1,"card","mt-3",3,"hidden"],[3,"pageSizeOptions","dataLength","tableId","exportDisplayedData","exportAllData"],["mat-table","","matSort","","matSortActive","id","matSortDirection","asc","matSortDisableClear","",1,"w-100",3,"dataSource"],["matColumnDef","select",4,"ngIf"],["matColumnDef","id"],["mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["class","static-column-size","mat-cell","",4,"matCellDef"],["matColumnDef","name"],["mat-cell","",4,"matCellDef"],["matColumnDef","description"],["mat-header-row","",4,"matHeaderRowDef"],["class","dark-hover-list-item","mat-row","",4,"matRowDef","matRowDefColumns"],["alert_type","warn",4,"ngIf"],["matColumnDef","select"],["class","align-checkbox","mat-header-cell","",4,"matHeaderCellDef"],["class","static-column-size align-checkbox","mat-cell","",4,"matCellDef"],["mat-header-cell","",1,"align-checkbox"],["color","primary",3,"aria-label","checked","indeterminate","change"],["mat-cell","",1,"static-column-size","align-checkbox"],["color","primary",3,"aria-label","checked","change","click"],["mat-header-cell","","mat-sort-header",""],["mat-cell","",1,"static-column-size"],["mat-cell",""],["mat-header-row",""],["mat-row","",1,"dark-hover-list-item"],["alert_type","warn"]],template:function(e,s){1&e&&(t.TgZ(0,"div",0)(1,"perun-web-apps-table-wrapper",1),t.NdJ("exportDisplayedData",function(o){return s.exportDisplayedData(o)})("exportAllData",function(o){return s.exportAllData(o)}),t.TgZ(2,"table",2),t.YNc(3,Wi,3,0,"ng-container",3),t.ALo(4,"isAllSelected"),t.ynx(5,4),t.YNc(6,ts,3,3,"th",5),t.YNc(7,es,2,1,"td",6),t.BQk(),t.ynx(8,7),t.YNc(9,is,3,3,"th",5),t.YNc(10,ss,2,1,"td",8),t.BQk(),t.ynx(11,9),t.YNc(12,as,3,3,"th",5),t.YNc(13,ns,2,1,"td",8),t.BQk(),t.YNc(14,os,1,0,"tr",10),t.YNc(15,ls,1,0,"tr",11),t.qZA()()(),t.YNc(16,cs,3,3,"perun-web-apps-alert",12),t.YNc(17,rs,3,3,"perun-web-apps-alert",12)),2&e&&(t.Q6J("hidden",0===s.dataSource.filteredData.length||0===s.securityTeams.length),t.xp6(1),t.Q6J("pageSizeOptions",s.pageSizeOptions)("dataLength",s.dataSource.filteredData.length)("tableId",s.tableId),t.xp6(1),t.Q6J("dataSource",s.dataSource),t.xp6(1),t.Q6J("ngIf",t.VKq(13,us,t.xi3(4,10,s.dataSource,s.selection.selected.length))),t.xp6(11),t.Q6J("matHeaderRowDef",s.displayedColumns),t.xp6(1),t.Q6J("matRowDefColumns",s.displayedColumns),t.xp6(1),t.Q6J("ngIf",0===s.dataSource.filteredData.length&&0!==s.securityTeams.length),t.xp6(1),t.Q6J("ngIf",0===s.securityTeams.length))},dependencies:[m.O5,I.YE,I.nU,l.BZ,l.fO,l.as,l.w1,l.Dz,l.nj,l.ge,l.ev,l.XQ,l.Gk,L.oG,Z.w,N.l,h.X$,k.I,w.G,Y.r]}),i})();function ds(i,n){1&i&&t._UZ(0,"mat-spinner",5)}function _s(i,n){if(1&i&&t._UZ(0,"app-security-teams-list",6),2&i){const e=t.oxw();t.Q6J("displayedColumns",e.displayedColumns)("filterValue",e.filterValue)("securityTeams",e.securityTeams)("selection",e.selected)("tableId",e.tableId)}}let ms=(()=>{class i{constructor(e,s,a,o){this.dialog=e,this.facilitiesManager=s,this.authResolver=a,this.entityStorageService=o,this.securityTeams=[],this.selected=new A.Ov(!0,[]),this.filterValue="",this.tableId=x.O9,this.displayedColumns=[]}ngOnInit(){this.facility=this.entityStorageService.getEntity(),this.refreshTable()}refreshTable(){this.loading=!0,this.facilitiesManager.getAssignedSecurityTeams(this.facility.id).subscribe(e=>{this.securityTeams=e,this.selected.clear(),this.setAuthRights(),this.loading=!1})}setAuthRights(){this.addAuth=this.authResolver.isAuthorized("assignSecurityTeam_Facility_SecurityTeam_policy",[this.facility]),this.removeAuth=this.authResolver.isAuthorized("removeSecurityTeam_Facility_SecurityTeam_policy",[this.facility]),this.displayedColumns=this.removeAuth?["select","id","name","description"]:["id","name","description"]}applyFilter(e){this.filterValue=e}}return i.\u0275fac=function(e){return new(e||i)(t.Y36(u.uw),t.Y36(f.IQ),t.Y36(d.x4),t.Y36(d.fb))},i.\u0275cmp=t.Xpm({type:i,selectors:[["app-facility-security-teams"]],decls:8,vars:6,consts:[[1,"page-subtitle"],[3,"refresh"],[3,"placeholder","filter"],["class","ml-auto mr-auto",4,"ngIf"],[3,"displayedColumns","filterValue","securityTeams","selection","tableId",4,"ngIf"],[1,"ml-auto","mr-auto"],[3,"displayedColumns","filterValue","securityTeams","selection","tableId"]],template:function(e,s){1&e&&(t.TgZ(0,"div")(1,"h1",0),t._uU(2),t.ALo(3,"translate"),t.qZA(),t.TgZ(4,"perun-web-apps-refresh-button",1),t.NdJ("refresh",function(){return s.refreshTable()}),t.qZA(),t.TgZ(5,"perun-web-apps-immediate-filter",2),t.NdJ("filter",function(o){return s.applyFilter(o)}),t.qZA(),t.YNc(6,ds,1,0,"mat-spinner",3),t.YNc(7,_s,1,5,"app-security-teams-list",4),t.qZA()),2&e&&(t.xp6(2),t.Oqu(t.lcZ(3,4,"FACILITY_DETAIL.SECURITY_TEAMS.TITLE")),t.xp6(3),t.Q6J("placeholder","FACILITY_DETAIL.SECURITY_TEAMS.FILTER"),t.xp6(1),t.Q6J("ngIf",s.loading),t.xp6(1),t.Q6J("ngIf",!s.loading))},dependencies:[m.O5,T.Ou,ps,O.t,D.L,h.X$]}),i})();var hs=c(20057),fs=c(49546);function gs(i,n){1&i&&t._UZ(0,"mat-spinner",6)}function Ts(i,n){1&i&&(t.TgZ(0,"th",17),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&i&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"DIALOGS.DELETE_TASK_RESULT.RESULT_ID")," "))}function Ss(i,n){if(1&i&&(t.TgZ(0,"td",18),t._uU(1),t.qZA()),2&i){const e=n.$implicit;t.xp6(1),t.Oqu(e.id)}}function Cs(i,n){1&i&&(t.TgZ(0,"th",17),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&i&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"DIALOGS.DELETE_TASK_RESULT.DESTINATION")," "))}function As(i,n){if(1&i&&(t.TgZ(0,"td",18),t._uU(1),t.qZA()),2&i){const e=n.$implicit;t.xp6(1),t.Oqu(e.destination.destination)}}function Is(i,n){1&i&&(t.TgZ(0,"th",17),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&i&&(t.xp6(1),t.Oqu(t.lcZ(2,1,"DIALOGS.DELETE_TASK_RESULT.TIME")))}function bs(i,n){if(1&i&&(t.TgZ(0,"td",18),t._uU(1),t.ALo(2,"date"),t.qZA()),2&i){const e=n.$implicit;t.xp6(1),t.hij(" ",t.xi3(2,1,e.timestamp,"d.M.y H:mm:ss")," ")}}function ys(i,n){1&i&&t._UZ(0,"tr",19)}function vs(i,n){1&i&&t._UZ(0,"tr",20)}function xs(i,n){if(1&i&&(t.TgZ(0,"div",7)(1,"p"),t._uU(2),t.ALo(3,"translate"),t.qZA(),t.TgZ(4,"div",8),t._uU(5),t.ALo(6,"translate"),t.qZA(),t.TgZ(7,"table",9),t.ynx(8,10),t.YNc(9,Ts,3,3,"th",11),t.YNc(10,Ss,2,1,"td",12),t.BQk(),t.ynx(11,13),t.YNc(12,Cs,3,3,"th",11),t.YNc(13,As,2,1,"td",12),t.BQk(),t.ynx(14,14),t.YNc(15,Is,3,3,"th",11),t.YNc(16,bs,3,4,"td",12),t.BQk(),t.YNc(17,ys,1,0,"tr",15),t.YNc(18,vs,1,0,"tr",16),t.qZA()()),2&i){const e=t.oxw();t.xp6(2),t.Oqu(t.lcZ(3,5,"DIALOGS.DELETE_TASK_RESULT.DESCRIPTION")),t.xp6(3),t.hij(" ",t.lcZ(6,7,"DIALOGS.DELETE_TASK_RESULT.ASK")," "),t.xp6(2),t.Q6J("dataSource",e.dataSource),t.xp6(10),t.Q6J("matHeaderRowDef",e.displayedColumns),t.xp6(1),t.Q6J("matRowDefColumns",e.displayedColumns)}}let ft=(()=>{class i{constructor(e,s,a,o,r){this.dialogRef=e,this.data=s,this.taskManager=a,this.notificator=o,this.translate=r,this.loading=!1,this.dataSource=new l.by(this.data.taskResults),this.displayedColumns=["id","destination","time"]}ngOnInit(){this.theme=this.data.theme,this.taskResults=this.data.taskResults}onDelete(){if(this.loading=!0,0===this.taskResults.length)return this.dialogRef.close(!0),this.loading=!1,void this.notificator.showSuccess(this.translate.instant("DIALOGS.DELETE_TASK_RESULT.SUCCESS"));this.taskManager.deleteTaskResultById({taskResultId:this.taskResults.pop().id}).subscribe(()=>{this.onDelete()},()=>this.loading=!1)}onCancel(){this.dialogRef.close(!1)}}return i.\u0275fac=function(e){return new(e||i)(t.Y36(u.so),t.Y36(u.WI),t.Y36(f.Ob),t.Y36(d.V6),t.Y36(h.sK))},i.\u0275cmp=t.Xpm({type:i,selectors:[["app-delete-task-result-dialog"]],decls:13,vars:15,consts:[["mat-dialog-title",""],["class","ml-auto mr-auto",4,"ngIf"],["mat-dialog-content","",4,"ngIf"],["mat-dialog-actions",""],["mat-flat-button","",1,"ml-auto",3,"click"],["color","warn","mat-flat-button","",1,"ml-2",3,"disabled","click"],[1,"ml-auto","mr-auto"],["mat-dialog-content",""],[1,"font-weight-bold"],["mat-table","",1,"w-100",3,"dataSource"],["matColumnDef","id"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","destination"],["matColumnDef","time"],["class","font-weight-bolder","mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["mat-header-cell",""],["mat-cell",""],["mat-header-row","",1,"font-weight-bolder"],["mat-row",""]],template:function(e,s){1&e&&(t.TgZ(0,"h1",0),t._uU(1),t.ALo(2,"translate"),t.qZA(),t.TgZ(3,"div"),t.YNc(4,gs,1,0,"mat-spinner",1),t.YNc(5,xs,19,9,"div",2),t.TgZ(6,"div",3)(7,"button",4),t.NdJ("click",function(){return s.onCancel()}),t._uU(8),t.ALo(9,"translate"),t.qZA(),t.TgZ(10,"button",5),t.NdJ("click",function(){return s.onDelete()}),t._uU(11),t.ALo(12,"translate"),t.qZA()()()),2&e&&(t.xp6(1),t.Oqu(t.lcZ(2,9,"DIALOGS.DELETE_TASK_RESULT.TITLE")),t.xp6(2),t.Tol(s.theme),t.xp6(1),t.Q6J("ngIf",s.loading),t.xp6(1),t.Q6J("ngIf",!s.loading),t.xp6(3),t.hij(" ",t.lcZ(9,11,"DIALOGS.DELETE_TASK_RESULT.CANCEL")," "),t.xp6(2),t.Q6J("disabled",s.loading),t.xp6(1),t.hij(" ",t.lcZ(12,13,"DIALOGS.DELETE_TASK_RESULT.REMOVE")," "))},dependencies:[m.O5,C.lW,l.BZ,l.fO,l.as,l.w1,l.Dz,l.nj,l.ge,l.ev,l.XQ,l.Gk,u.uh,u.xY,u.H8,T.Ou,m.uU,h.X$]}),i})();var Ds=c(62109);function Es(i,n){1&i&&t._UZ(0,"mat-spinner",6)}function Ls(i,n){if(1&i){const e=t.EpF();t.TgZ(0,"mat-checkbox",13),t.NdJ("change",function(a){t.CHM(e);const o=t.oxw(2);return t.KtG(o.change(a))}),t.ALo(1,"translate"),t._uU(2),t.ALo(3,"translate"),t.qZA()}if(2&i){const e=t.oxw(2);t.s9C("matTooltip",t.lcZ(1,5,"DIALOGS.REMOVE_SERVICE_FROM_FACILITY.CHECKBOXES_DISABLED")),t.Q6J("checked",e.taskChecked)("disabled",e.checkboxesDisabled)("matTooltipDisabled",!e.checkboxesDisabled),t.xp6(2),t.hij(" ",t.lcZ(3,7,"DIALOGS.REMOVE_SERVICE_FROM_FACILITY.CHECKBOX_TASK_AND_TASK_RESULTS")," ")}}function Zs(i,n){if(1&i){const e=t.EpF();t.TgZ(0,"mat-checkbox",14),t.NdJ("change",function(a){t.CHM(e);const o=t.oxw(2);return t.KtG(o.change(a))}),t.ALo(1,"translate"),t._uU(2),t.ALo(3,"translate"),t.qZA()}if(2&i){const e=t.oxw(2);t.s9C("matTooltip",t.lcZ(1,5,"DIALOGS.REMOVE_SERVICE_FROM_FACILITY.CHECKBOXES_DISABLED")),t.Q6J("checked",e.taskResultsChecked)("disabled",e.checkboxesDisabled)("matTooltipDisabled",!e.checkboxesDisabled),t.xp6(2),t.hij(" ",t.lcZ(3,7,"DIALOGS.REMOVE_SERVICE_FROM_FACILITY.CHECKBOX_TASK_RESULTS")," ")}}function Os(i,n){if(1&i){const e=t.EpF();t.TgZ(0,"perun-web-apps-resources-list",15),t.NdJ("allSelected",function(a){t.CHM(e);const o=t.oxw(2);return t.KtG(o.disableCheckboxes(a))}),t.qZA()}if(2&i){const e=t.oxw(2);t.Q6J("displayedColumns",e.displayedColumns)("disableRouting",!0)("resources",e.resources)("selection",e.selected)("tableId",e.tableId)}}function Rs(i,n){if(1&i){const e=t.EpF();t.TgZ(0,"div",7)(1,"p"),t._uU(2),t.ALo(3,"translate"),t.qZA(),t.TgZ(4,"div"),t.YNc(5,Ls,4,9,"mat-checkbox",8),t.YNc(6,Zs,4,9,"mat-checkbox",9),t.TgZ(7,"mat-checkbox",10),t.NdJ("change",function(a){t.CHM(e);const o=t.oxw();return t.KtG(o.change(a))}),t.ALo(8,"translate"),t._uU(9),t.ALo(10,"translate"),t.qZA()(),t.TgZ(11,"p"),t._uU(12),t.ALo(13,"translate"),t.qZA(),t.TgZ(14,"div",11),t._uU(15),t.ALo(16,"translate"),t.qZA(),t.YNc(17,Os,1,5,"perun-web-apps-resources-list",12),t.qZA()}if(2&i){const e=t.oxw();t.xp6(2),t.Oqu(t.lcZ(3,11,"DIALOGS.REMOVE_SERVICE_FROM_FACILITY.CHECKBOXES_DESCRIPTION")),t.xp6(3),t.Q6J("ngIf",null!==e.taskId),t.xp6(1),t.Q6J("ngIf",null!==e.taskId),t.xp6(1),t.s9C("matTooltip",t.lcZ(8,13,"DIALOGS.REMOVE_SERVICE_FROM_FACILITY.CHECKBOXES_DISABLED")),t.Q6J("disabled",e.checkboxesDisabled)("matTooltipDisabled",!e.checkboxesDisabled)("checked",e.destinationChecked),t.xp6(2),t.hij(" ",t.lcZ(10,15,"DIALOGS.REMOVE_SERVICE_FROM_FACILITY.CHECKBOX_DESTINATION")," "),t.xp6(3),t.Oqu(t.lcZ(13,17,"DIALOGS.REMOVE_SERVICE_FROM_FACILITY.DESCRIPTION")),t.xp6(3),t.hij(" ",t.lcZ(16,19,"DIALOGS.REMOVE_SERVICE_FROM_FACILITY.ASK")," "),t.xp6(2),t.Q6J("ngIf",!e.loading)}}let Fs=(()=>{class i{constructor(e,s,a,o,r,_,S,b){this.dialogRef=e,this.data=s,this.resourcesManager=a,this.tasksManager=o,this.serviceManager=r,this.translate=_,this.notificator=S,this.cd=b,this.loading=!1,this.resources=[],this.displayedColumns=["select","id","vo","name"],this.checkboxesDisabled=!1,this.taskChecked=!0,this.taskResultsChecked=!0,this.destinationChecked=!0,this.tableId=x.$V,this.dataSource=new l.by(this.data.resource),this.selected=new A.Ov(!0,[...this.dataSource.data])}ngOnInit(){this.theme=this.data.theme,this.taskId=this.data.taskId,this.serviceId=this.data.serviceId,this.facilityId=this.data.facilityId,this.resources=this.data.resource}remove(){this.loading=!0,this.taskResultsChecked&&!this.taskChecked&&null!==this.taskId&&this.tasksManager.getTaskResultsForGUIByTask(this.taskId).subscribe(e=>{e.forEach(s=>{this.tasksManager.deleteTaskResultById({taskResultId:s.id}).subscribe()})}),this.taskChecked&&null!==this.taskId&&this.tasksManager.deleteTask({task:this.taskId}).subscribe(),this.destinationChecked&&this.serviceManager.getDestinations(this.serviceId,this.facilityId).subscribe(e=>{e.forEach(s=>{this.serviceManager.removeDestination(this.serviceId,this.facilityId,s.destination,s.type).subscribe()})}),this.selected.selected.forEach(e=>{this.resourcesManager.removeService(e.id,this.serviceId).subscribe(()=>{this.translate.get("DIALOGS.REMOVE_SERVICE_FROM_FACILITY.SUCCESS").subscribe(s=>{this.notificator.showSuccess(s),this.dialogRef.close(!0)})},()=>this.loading=!1)})}cancel(){this.dialogRef.close(!1)}disableCheckboxes(e){e&&this.checkboxesDisabled&&this.changeCheckboxes(!0),!e&&!this.checkboxesDisabled&&this.changeCheckboxes(!1)}changeCheckboxes(e){this.checkboxesDisabled=!e,this.taskChecked=e,this.taskResultsChecked=e,this.destinationChecked=e,this.cd.detectChanges()}change(e){switch(e.source.id){case"task":this.taskChecked=e.checked;break;case"taskResults":this.taskResultsChecked=e.checked;break;case"destination":this.destinationChecked=e.checked}}}return i.\u0275fac=function(e){return new(e||i)(t.Y36(u.so),t.Y36(u.WI),t.Y36(f.xk),t.Y36(f.Ob),t.Y36(f.KK),t.Y36(h.sK),t.Y36(d.V6),t.Y36(t.sBO))},i.\u0275cmp=t.Xpm({type:i,selectors:[["app-delete-service-from-facility"]],decls:13,vars:15,consts:[["mat-dialog-title",""],["class","ml-auto mr-auto",4,"ngIf"],["mat-dialog-content","",4,"ngIf"],["mat-dialog-actions",""],["mat-flat-button","",1,"ml-auto",3,"click"],["color","warn","mat-flat-button","",1,"ml-2",3,"disabled","click"],[1,"ml-auto","mr-auto"],["mat-dialog-content",""],["class","right-space","color","warn","id","task",3,"checked","disabled","matTooltipDisabled","matTooltip","change",4,"ngIf"],["class","right-space","color","warn","id","taskResults",3,"checked","disabled","matTooltipDisabled","matTooltip","change",4,"ngIf"],["color","warn","id","destination",3,"disabled","matTooltipDisabled","checked","matTooltip","change"],[1,"font-weight-bold"],[3,"displayedColumns","disableRouting","resources","selection","tableId","allSelected",4,"ngIf"],["color","warn","id","task",1,"right-space",3,"checked","disabled","matTooltipDisabled","matTooltip","change"],["color","warn","id","taskResults",1,"right-space",3,"checked","disabled","matTooltipDisabled","matTooltip","change"],[3,"displayedColumns","disableRouting","resources","selection","tableId","allSelected"]],template:function(e,s){1&e&&(t.TgZ(0,"h1",0),t._uU(1),t.ALo(2,"translate"),t.qZA(),t.TgZ(3,"div"),t.YNc(4,Es,1,0,"mat-spinner",1),t.YNc(5,Rs,18,21,"div",2),t.TgZ(6,"div",3)(7,"button",4),t.NdJ("click",function(){return s.cancel()}),t._uU(8),t.ALo(9,"translate"),t.qZA(),t.TgZ(10,"button",5),t.NdJ("click",function(){return s.remove()}),t._uU(11),t.ALo(12,"translate"),t.qZA()()()),2&e&&(t.xp6(1),t.Oqu(t.lcZ(2,9,"DIALOGS.REMOVE_SERVICE_FROM_FACILITY.TITLE")),t.xp6(2),t.Tol(s.theme),t.xp6(1),t.Q6J("ngIf",s.loading),t.xp6(1),t.Q6J("ngIf",!s.loading),t.xp6(3),t.hij(" ",t.lcZ(9,11,"DIALOGS.REMOVE_SERVICE_FROM_FACILITY.CANCEL")," "),t.xp6(2),t.Q6J("disabled",s.loading||0===s.selected.selected.length),t.xp6(1),t.hij(" ",t.lcZ(12,13,"DIALOGS.REMOVE_SERVICE_FROM_FACILITY.REMOVE")," "))},dependencies:[m.O5,C.lW,L.oG,u.uh,u.xY,u.H8,T.Ou,U.gM,Ds.C,h.X$],styles:[".right-space[_ngcontent-%COMP%]{margin-right:40px}"]}),i})();function Ns(i,n){1&i&&t._UZ(0,"mat-spinner",6)}function ks(i,n){1&i&&(t.TgZ(0,"div",7)(1,"div",8),t._uU(2),t.ALo(3,"translate"),t.qZA()()),2&i&&(t.xp6(2),t.hij(" ",t.lcZ(3,1,"DIALOGS.DELETE_TASK.DESCRIPTION")," "))}let ws=(()=>{class i{constructor(e,s,a,o,r){this.dialogRef=e,this.data=s,this.tasksManager=a,this.translate=o,this.notificator=r,this.loading=!1}ngOnInit(){this.theme=this.data.theme,this.taskId=this.data.taskId}remove(){this.loading=!0,this.tasksManager.deleteTask({task:this.taskId}).subscribe(()=>{this.translate.get("DIALOGS.DELETE_TASK.SUCCESS").subscribe(e=>{this.notificator.showSuccess(e),this.dialogRef.close(!0)})},()=>this.loading=!1)}cancel(){this.dialogRef.close(!1)}}return i.\u0275fac=function(e){return new(e||i)(t.Y36(u.so),t.Y36(u.WI),t.Y36(f.Ob),t.Y36(h.sK),t.Y36(d.V6))},i.\u0275cmp=t.Xpm({type:i,selectors:[["app-delete-task-dialog"]],decls:13,vars:15,consts:[["mat-dialog-title",""],["class","ml-auto mr-auto",4,"ngIf"],["mat-dialog-content","",4,"ngIf"],["mat-dialog-actions",""],["mat-flat-button","",1,"ml-auto",3,"click"],["color","warn","mat-flat-button","",1,"ml-2",3,"disabled","click"],[1,"ml-auto","mr-auto"],["mat-dialog-content",""],[1,"font-weight-bold"]],template:function(e,s){1&e&&(t.TgZ(0,"h1",0),t._uU(1),t.ALo(2,"translate"),t.qZA(),t.TgZ(3,"div"),t.YNc(4,Ns,1,0,"mat-spinner",1),t.YNc(5,ks,4,3,"div",2),t.TgZ(6,"div",3)(7,"button",4),t.NdJ("click",function(){return s.cancel()}),t._uU(8),t.ALo(9,"translate"),t.qZA(),t.TgZ(10,"button",5),t.NdJ("click",function(){return s.remove()}),t._uU(11),t.ALo(12,"translate"),t.qZA()()()),2&e&&(t.xp6(1),t.Oqu(t.lcZ(2,9,"DIALOGS.DELETE_TASK.TITLE")),t.xp6(2),t.Tol(s.theme),t.xp6(1),t.Q6J("ngIf",s.loading),t.xp6(1),t.Q6J("ngIf",!s.loading),t.xp6(3),t.hij(" ",t.lcZ(9,11,"DIALOGS.DELETE_TASK.CANCEL")," "),t.xp6(2),t.Q6J("disabled",s.loading),t.xp6(1),t.hij(" ",t.lcZ(12,13,"DIALOGS.DELETE_TASK.DELETE")," "))},dependencies:[m.O5,C.lW,u.uh,u.xY,u.H8,T.Ou,h.X$]}),i})();var z=c(28255);let Ys=(()=>{class i{transform(e){return e.blockedOnFacility?"BLOCKED":e.blockedGlobally?"BLOCKED GLOBALLY":"ALLOWED"}}return i.\u0275fac=function(e){return new(e||i)},i.\u0275pipe=t.Yjl({name:"serviceStateBlockedToString",type:i,pure:!0}),i})();function Us(i,n){if(1&i){const e=t.EpF();t.TgZ(0,"th",19)(1,"mat-checkbox",20),t.NdJ("change",function(a){t.CHM(e);const o=t.oxw(2);return a&&o.masterToggle(),t.KtG(o.selectionChange.emit())}),t.ALo(2,"translate"),t.ALo(3,"masterCheckboxLabel"),t.qZA()()}if(2&i){const e=t.oxw().ngIf,s=t.oxw();t.xp6(1),t.Q6J("checked",s.selection.hasValue()&&e.all)("indeterminate",s.selection.hasValue()&&!e.all)("aria-label",t.lcZ(2,3,t.lcZ(3,5,e.all)))}}const Ms=function(i){return{name:i}};function Js(i,n){if(1&i){const e=t.EpF();t.TgZ(0,"td",21)(1,"mat-checkbox",22),t.NdJ("click",function(a){return a.stopPropagation()})("change",function(a){const r=t.CHM(e).$implicit,_=t.oxw(2);return a&&_.selection.toggle(r),t.KtG(_.selectionChange.emit())}),t.ALo(2,"translate"),t.ALo(3,"checkboxLabel"),t.qZA()()}if(2&i){const e=n.$implicit,s=t.oxw(2);t.xp6(1),t.Q6J("checked",s.selection.isSelected(e))("aria-label",t.xi3(2,2,t.lcZ(3,5,s.selection.isSelected(e)),t.VKq(7,Ms,e.service.name)))}}function Hs(i,n){1&i&&(t.ynx(0,16),t.YNc(1,Us,4,7,"th",17),t.YNc(2,Js,4,9,"td",18),t.BQk())}function Qs(i,n){1&i&&(t.TgZ(0,"th",23),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&i&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"SHARED_LIB.PERUN.COMPONENTS.SERVICES_STATUS_LIST.TASK_ID")," "))}function Gs(i,n){if(1&i&&(t.TgZ(0,"div"),t._uU(1),t.qZA()),2&i){const e=t.oxw().$implicit;t.xp6(1),t.Oqu(e.task.id)}}function qs(i,n){1&i&&(t.TgZ(0,"div"),t._uU(1,"0"),t.qZA())}function Ps(i,n){if(1&i&&(t.TgZ(0,"td",24),t.YNc(1,Gs,2,1,"div",25),t.YNc(2,qs,2,0,"div",25),t.qZA()),2&i){const e=n.$implicit;t.xp6(1),t.Q6J("ngIf",e.task),t.xp6(1),t.Q6J("ngIf",!e.task)}}function Vs(i,n){1&i&&(t.TgZ(0,"th",23),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&i&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"SHARED_LIB.PERUN.COMPONENTS.SERVICES_STATUS_LIST.SERVICE_NAME")," "))}function Bs(i,n){if(1&i&&(t.TgZ(0,"td",26),t._uU(1),t.qZA()),2&i){const e=n.$implicit;t.uIk("data-cy",e.service.name),t.xp6(1),t.hij(" ",e.service.name," ")}}function js(i,n){1&i&&(t.TgZ(0,"th",23),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&i&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"SHARED_LIB.PERUN.COMPONENTS.SERVICES_STATUS_LIST.STATUS")," "))}function Ks(i,n){1&i&&(t.TgZ(0,"mat-icon",28),t.ALo(1,"translate"),t._uU(2," warning "),t.qZA()),2&i&&t.Q6J("matTooltip",t.lcZ(1,1,"SHARED_LIB.PERUN.COMPONENTS.SERVICES_STATUS_LIST.NO_DESTINATIONS_TOOLTIP"))}function zs(i,n){if(1&i&&(t.TgZ(0,"td",26),t._uU(1),t.YNc(2,Ks,3,3,"mat-icon",27),t.qZA()),2&i){const e=n.$implicit;t.xp6(1),t.hij(" ",e.status," "),t.xp6(1),t.Q6J("ngIf",!e.hasDestinations)}}function $s(i,n){1&i&&(t.TgZ(0,"th",23),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&i&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"SHARED_LIB.PERUN.COMPONENTS.SERVICES_STATUS_LIST.BLOCKED")," "))}function Xs(i,n){if(1&i&&(t.TgZ(0,"td",26),t._uU(1),t.ALo(2,"serviceStateBlockedToString"),t.qZA()),2&i){const e=n.$implicit;t.xp6(1),t.hij(" ",t.lcZ(2,1,e)," ")}}function Ws(i,n){1&i&&(t.TgZ(0,"th",23),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&i&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"SHARED_LIB.PERUN.COMPONENTS.SERVICES_STATUS_LIST.STARTED")," "))}function ta(i,n){if(1&i&&(t.TgZ(0,"div"),t._uU(1),t.ALo(2,"date"),t.qZA()),2&i){const e=t.oxw().$implicit;t.xp6(1),t.hij(" ",t.xi3(2,1,e.task.startTime,"d.M.y H:mm:ss")," ")}}function ea(i,n){1&i&&(t.TgZ(0,"div"),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&i&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"SHARED_LIB.PERUN.COMPONENTS.SERVICES_STATUS_LIST.NOT_YET")," "))}function ia(i,n){if(1&i&&(t.TgZ(0,"td",26),t.YNc(1,ta,3,4,"div",25),t.YNc(2,ea,3,3,"div",25),t.qZA()),2&i){const e=n.$implicit;t.xp6(1),t.Q6J("ngIf",e.task&&e.task.startTime),t.xp6(1),t.Q6J("ngIf",!e.task||!e.task.startTime)}}function sa(i,n){1&i&&(t.TgZ(0,"th",23),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&i&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"SHARED_LIB.PERUN.COMPONENTS.SERVICES_STATUS_LIST.ENDED")," "))}function aa(i,n){if(1&i&&(t.TgZ(0,"div"),t._uU(1),t.ALo(2,"date"),t.qZA()),2&i){const e=t.oxw().$implicit;t.xp6(1),t.hij(" ",t.xi3(2,1,e.task.endTime,"d.M.y H:mm:ss")," ")}}function na(i,n){1&i&&(t.TgZ(0,"div"),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&i&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"SHARED_LIB.PERUN.COMPONENTS.SERVICES_STATUS_LIST.NOT_YET")," "))}function oa(i,n){if(1&i&&(t.TgZ(0,"td",26),t.YNc(1,aa,3,4,"div",25),t.YNc(2,na,3,3,"div",25),t.qZA()),2&i){const e=n.$implicit;t.xp6(1),t.Q6J("ngIf",e.task&&e.task.endTime),t.xp6(1),t.Q6J("ngIf",!e.task||!e.task.endTime)}}function la(i,n){1&i&&t._UZ(0,"tr",29)}const gt=function(i,n){return["/facilities",i,"services-status",n]};function ca(i,n){if(1&i&&t._UZ(0,"tr",30),2&i){const e=n.$implicit,s=t.oxw();t.ekj("disable-outline",s.disableRouting||!e.task)("make-yellow","WARNING"===e.status)("make-green","DONE"===e.status)("make-red","GENERROR"===e.status||"SENDERROR"===e.status||"ERROR"===e.status)("cursor-pointer",!s.disableRouting&&null!==e.task),t.Q6J("routerLink",s.disableRouting||null===e.task?null:t.WLB(12,gt,e.facility.id,e.taskId))("perunWebAppsMiddleClickRouterLink",s.disableRouting||null===e.task?null:t.WLB(15,gt,e.facility.id,e.taskId))}}function ra(i,n){1&i&&(t.TgZ(0,"perun-web-apps-alert",31),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&i&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"SHARED_LIB.UI.ALERTS.NO_FILTER_RESULTS_ALERT"),"\n"))}function ua(i,n){1&i&&(t.TgZ(0,"perun-web-apps-alert",31),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&i&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"SHARED_LIB.PERUN.COMPONENTS.SERVICES_STATUS_LIST.NO_SERVICES_STATUS_WARNING"),"\n"))}const pa=function(i){return{all:i}};let da=(()=>{class i{constructor(e,s){this.authResolver=e,this.tableCheckbox=s,this.servicesStatus=[],this.displayedColumns=["select","task.id","service.name","status","blocked","task.startTime","task.endTime"],this.selection=new A.Ov(!0,[]),this.disableRouting=!0,this.selectionChange=new t.vpe,this.pageSizeOptions=p.f7}set matSort(e){this.sort=e,this.setDataSource()}static getSortDataForColumn(e,s){switch(s){case"task.id":return e.task?e.task.id.toString():e[s];case"service.name":return e.service.name;case"status":return e.status;case"blocked":return e.blockedOnFacility?"BLOCKED":e.blockedGlobally?"BLOCKED GLOBALLY":"ALLOWED";case"task.startTime":return e.task?.startTime?(0,m.p6)(e.task.startTime,"yyyy.MM.dd HH:mm:ss","en"):e[s];case"task.endTime":return e.task?.endTime?(0,m.p6)(e.task.endTime,"yyyy.MM.dd HH:mm:ss","en"):e[s];default:return e[s]}}static getDataForColumn(e,s){switch(s){case"task.id":return e.task?e.task.id.toString():e[s];case"service.name":return e.service.name;case"status":return e.status;case"blocked":return e.blockedOnFacility?"BLOCKED":e.blockedGlobally?"BLOCKED GLOBALLY":"ALLOWED";case"task.startTime":return e.task?.startTime?(0,m.p6)(e.task.startTime,"d.M.y H:mm:ss","en"):e[s];case"task.endTime":return e.task?.endTime?(0,m.p6)(e.task.endTime,"d.M.y H:mm:ss","en"):e[s];default:return e[s]}}ngOnChanges(){this.authResolver.isPerunAdminOrObserver()||(this.displayedColumns=this.displayedColumns.filter(e=>"task.id"!==e)),this.dataSource=new l.by(this.servicesStatus),this.setDataSource(),this.dataSource.filterPredicate=(e,s)=>{const a=s.trim().toLowerCase(),o=r=>{let _="";return Object.values(r).forEach(S=>{"object"!=typeof S?_=_+" "+String(S):null!==S&&(_=_+" "+o(S))}),_.trim().toLowerCase()};return o(e).includes(a)},this.dataSource.filter=this.filterValue}exportAllData(e){(0,p.O6)((0,p.Xn)(this.dataSource.filteredData,this.displayedColumns,i.getDataForColumn),e)}exportDisplayedData(e){const s=this.dataSource.paginator.pageIndex*this.dataSource.paginator.pageSize,a=s+this.dataSource.paginator.pageSize;(0,p.O6)((0,p.Xn)(this.dataSource.sortData(this.dataSource.filteredData,this.dataSource.sort).slice(s,a),this.displayedColumns,i.getDataForColumn),e)}setDataSource(){this.dataSource&&(this.dataSource.filterPredicate=(e,s)=>(0,p.Sd)(e,s,this.displayedColumns,i.getDataForColumn),this.dataSource.sortData=(e,s)=>(0,p.pR)(e,s,i.getSortDataForColumn),this.dataSource.sort=this.sort,this.dataSource.paginator=this.child.paginator)}isAllSelected(){return this.tableCheckbox.isAllSelected(this.selection.selected.length,this.dataSource)}masterToggle(){this.tableCheckbox.masterToggle(this.isAllSelected(),this.selection,this.filterValue,this.dataSource,this.sort,this.child.paginator.pageSize,this.child.paginator.pageIndex,!1)}ngAfterViewInit(){this.dataSource.paginator=this.child.paginator}}return i.\u0275fac=function(e){return new(e||i)(t.Y36(d.x4),t.Y36(d.UA))},i.\u0275cmp=t.Xpm({type:i,selectors:[["perun-web-apps-services-status-list"]],viewQuery:function(e,s){if(1&e&&(t.Gf(p.l9,7),t.Gf(I.YE,7)),2&e){let a;t.iGM(a=t.CRH())&&(s.child=a.first),t.iGM(a=t.CRH())&&(s.matSort=a.first)}},inputs:{servicesStatus:"servicesStatus",displayedColumns:"displayedColumns",selection:"selection",filterValue:"filterValue",tableId:"tableId",disableRouting:"disableRouting"},outputs:{selectionChange:"selectionChange"},features:[t.TTD],decls:27,vars:15,consts:[[1,"card","mt-3",3,"hidden"],[3,"tableId","dataLength","pageSizeOptions","exportDisplayedData","exportAllData"],["mat-table","","matSort","","matSortActive","service.name","matSortDirection","asc","matSortDisableClear","",1,"w-100",3,"dataSource"],["matColumnDef","select",4,"ngIf"],["matColumnDef","task.id"],["mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["mat-cell","","class","static-column-size",4,"matCellDef"],["matColumnDef","service.name"],["mat-cell","",4,"matCellDef"],["matColumnDef","status"],["matColumnDef","blocked"],["matColumnDef","task.startTime"],["matColumnDef","task.endTime"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","","class","dark-hover-list-item",3,"disable-outline","make-yellow","make-green","make-red","cursor-pointer","routerLink","perunWebAppsMiddleClickRouterLink",4,"matRowDef","matRowDefColumns"],["alert_type","warn",4,"ngIf"],["matColumnDef","select"],["mat-header-cell","","class","align-checkbox",4,"matHeaderCellDef"],["mat-cell","","class","static-column-size align-checkbox",4,"matCellDef"],["mat-header-cell","",1,"align-checkbox"],["color","primary",3,"checked","indeterminate","aria-label","change"],["mat-cell","",1,"static-column-size","align-checkbox"],["color","primary",3,"checked","aria-label","click","change"],["mat-header-cell","","mat-sort-header",""],["mat-cell","",1,"static-column-size"],[4,"ngIf"],["mat-cell",""],["class","align-text-bottom ml-1",3,"matTooltip",4,"ngIf"],[1,"align-text-bottom","ml-1",3,"matTooltip"],["mat-header-row",""],["mat-row","",1,"dark-hover-list-item",3,"routerLink","perunWebAppsMiddleClickRouterLink"],["alert_type","warn"]],template:function(e,s){1&e&&(t.TgZ(0,"div",0)(1,"perun-web-apps-table-wrapper",1),t.NdJ("exportDisplayedData",function(o){return s.exportDisplayedData(o)})("exportAllData",function(o){return s.exportAllData(o)}),t.TgZ(2,"table",2),t.YNc(3,Hs,3,0,"ng-container",3),t.ALo(4,"isAllSelected"),t.ynx(5,4),t.YNc(6,Qs,3,3,"th",5),t.YNc(7,Ps,3,2,"td",6),t.BQk(),t.ynx(8,7),t.YNc(9,Vs,3,3,"th",5),t.YNc(10,Bs,2,2,"td",8),t.BQk(),t.ynx(11,9),t.YNc(12,js,3,3,"th",5),t.YNc(13,zs,3,2,"td",8),t.BQk(),t.ynx(14,10),t.YNc(15,$s,3,3,"th",5),t.YNc(16,Xs,3,3,"td",8),t.BQk(),t.ynx(17,11),t.YNc(18,Ws,3,3,"th",5),t.YNc(19,ia,3,2,"td",8),t.BQk(),t.ynx(20,12),t.YNc(21,sa,3,3,"th",5),t.YNc(22,oa,3,2,"td",8),t.BQk(),t.YNc(23,la,1,0,"tr",13),t.YNc(24,ca,1,18,"tr",14),t.qZA()()(),t.YNc(25,ra,3,3,"perun-web-apps-alert",15),t.YNc(26,ua,3,3,"perun-web-apps-alert",15)),2&e&&(t.Q6J("hidden",0===s.dataSource.filteredData.length||0===s.servicesStatus.length),t.xp6(1),t.Q6J("tableId",s.tableId)("dataLength",s.dataSource.filteredData.length)("pageSizeOptions",s.pageSizeOptions),t.xp6(1),t.Q6J("dataSource",s.dataSource),t.xp6(1),t.Q6J("ngIf",t.VKq(13,pa,t.xi3(4,10,s.dataSource,s.selection.selected.length))),t.xp6(20),t.Q6J("matHeaderRowDef",s.displayedColumns),t.xp6(1),t.Q6J("matRowDefColumns",s.displayedColumns),t.xp6(1),t.Q6J("ngIf",0===s.dataSource.filteredData.length&&0!==s.servicesStatus.length),t.xp6(1),t.Q6J("ngIf",0===s.servicesStatus.length))},dependencies:[m.O5,L.oG,l.BZ,l.fO,l.as,l.w1,l.Dz,l.nj,l.ge,l.ev,l.XQ,l.Gk,v.rH,I.YE,I.nU,Z.w,R.Hw,U.gM,N.l,K.YH,m.uU,h.X$,Ys,k.I,w.G,Y.r],styles:[".disable-outline[_ngcontent-%COMP%]{outline:none!important}.make-green[_ngcontent-%COMP%]{background-color:#c4ffcb}.make-yellow[_ngcontent-%COMP%]{background-color:#fffde7}.make-red[_ngcontent-%COMP%]{background-color:#ffcdd2}.cursor-pointer[_ngcontent-%COMP%]{cursor:pointer}"]}),i})();function _a(i,n){if(1&i){const e=t.EpF();t.TgZ(0,"button",11),t.NdJ("click",function(){t.CHM(e);const a=t.oxw();return t.KtG(a.forcePropagation())}),t._uU(1),t.ALo(2,"translate"),t.qZA()}if(2&i){const e=t.oxw();t.Q6J("disabled",0===e.selected.selected.length),t.xp6(1),t.hij(" ",t.lcZ(2,2,"FACILITY_DETAIL.SERVICES_STATUS.FORCE_PROPAGATION")," ")}}function ma(i,n){if(1&i){const e=t.EpF();t.TgZ(0,"button",11),t.NdJ("click",function(){t.CHM(e);const a=t.oxw();return t.KtG(a.allow())}),t._uU(1),t.ALo(2,"translate"),t.qZA()}if(2&i){const e=t.oxw();t.Q6J("disabled",0===e.selected.selected.length||e.disableAllowButton),t.xp6(1),t.hij(" ",t.lcZ(2,2,"FACILITY_DETAIL.SERVICES_STATUS.ALLOW")," ")}}function ha(i,n){if(1&i){const e=t.EpF();t.TgZ(0,"button",12),t.NdJ("click",function(){t.CHM(e);const a=t.oxw();return t.KtG(a.block())}),t._uU(1),t.ALo(2,"translate"),t.qZA()}if(2&i){const e=t.oxw();t.Q6J("disabled",0===e.selected.selected.length||e.disableBlockButton),t.xp6(1),t.hij(" ",t.lcZ(2,2,"FACILITY_DETAIL.SERVICES_STATUS.BLOCK")," ")}}function fa(i,n){if(1&i&&(t.TgZ(0,"button",13),t.ALo(1,"translate"),t._uU(2),t.ALo(3,"translate"),t.qZA()),2&i){const e=t.oxw(),s=t.MAs(10);t.s9C("matTooltip",t.lcZ(1,5,"DIALOGS.REMOVE_SERVICE_FROM_FACILITY.CHECKBOXES_DISABLED")),t.Q6J("disabled",e.disableRemoveButton)("matMenuTriggerFor",s)("matTooltipDisabled",!e.disableRemoveButton),t.xp6(2),t.hij(" ",t.lcZ(3,7,"FACILITY_DETAIL.SERVICES_STATUS.REMOVE")," ")}}function ga(i,n){if(1&i){const e=t.EpF();t.TgZ(0,"button",7),t.NdJ("click",function(){t.CHM(e);const a=t.oxw();return t.KtG(a.removeTaskResults())}),t._uU(1),t.ALo(2,"translate"),t.qZA()}2&i&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"FACILITY_DETAIL.SERVICES_STATUS.REMOVE_TASK_RESULTS")," "))}function Ta(i,n){1&i&&t._UZ(0,"mat-spinner",14)}function Sa(i,n){if(1&i){const e=t.EpF();t.TgZ(0,"perun-web-apps-services-status-list",15),t.NdJ("selectionChange",function(){t.CHM(e);const a=t.oxw();return t.KtG(a.selectionChanged())}),t.qZA()}if(2&i){const e=t.oxw();t.Q6J("disableRouting",!e.routeAuth)("filterValue",e.filterValue)("servicesStatus",e.servicesStates)("selection",e.selected)("tableId",e.tableId)}}let Ca=(()=>{class i{constructor(e,s,a,o,r,_,S,b,E){this.tasksManager=e,this.servicesManager=s,this.notificator=a,this.translate=o,this.authResolver=r,this.facilityManager=_,this.resourcesManager=S,this.dialog=b,this.entityStorageService=E,this.servicesStates=[],this.selected=new A.Ov(!0,[]),this.filterValue="",this.tableId=x.oK,this.disableAllowButton=!0,this.disableBlockButton=!0,this.disableRemoveButton=!0,o.get("FACILITY_DETAIL.SERVICES_STATUS.SUCCESS_FORCE_PROPAGATION").subscribe(y=>this.successFPMessage=y),o.get("FACILITY_DETAIL.SERVICES_STATUS.SUCCESS_ALLOW").subscribe(y=>this.successAllowMessage=y),o.get("FACILITY_DETAIL.SERVICES_STATUS.SUCCESS_BLOCK").subscribe(y=>this.successBlockMessage=y),o.get("FACILITY_DETAIL.SERVICES_STATUS.SUCCESS_DELETE").subscribe(y=>this.successDeleteMessage=y),o.get("FACILITY_DETAIL.SERVICES_STATUS.ALREADY_DELETED").subscribe(y=>this.allreadyDeletedMessage=y)}ngOnInit(){this.loading=!0,this.facility=this.entityStorageService.getEntity(),this.setAuthRights(),this.refreshTable()}forcePropagation(){for(const e of this.selected.selected)this.servicesManager.forceServicePropagation(e.service.id,e.facility.id).subscribe(()=>{this.refreshTable(),this.notificator.showSuccess(this.successFPMessage)})}allow(){for(const e of this.selected.selected)this.servicesManager.unblockServiceOnFacility(e.service.id,e.facility.id).subscribe(()=>{this.refreshTable(),this.notificator.showSuccess(this.successAllowMessage)})}block(){for(const e of this.selected.selected)this.servicesManager.blockServiceOnFacility(e.service.id,e.facility.id).subscribe(()=>{this.refreshTable(),this.notificator.showSuccess(this.successBlockMessage)})}removeTaskResults(){this.tasksManager.getTaskResultsForGUIByTask(this.selected.selected[0].task.id).subscribe(e=>{const s=(0,p.kZ)();s.width="600px",s.data={theme:"facility-theme",taskResults:e},this.dialog.open(ft,s)})}removeServiceFromFacility(){this.facilityManager.getAssignedResourcesByAssignedServiceForFacility(this.selected.selected[0].facility.id,this.selected.selected[0].service.id).subscribe(e=>{const s=(0,p.kZ)();s.width="600px",this.taskId=this.taskIsNull?null:this.selected.selected[0].task.id,0===e.length?(s.data={theme:"facility-theme",taskId:this.taskId},this.dialog.open(ws,s).afterClosed().subscribe(o=>{o&&(this.disableRemoveButton=!0,this.refreshTable())})):this.resourcesManager.getRichResourcesByIds(e.map(a=>a.id)).subscribe(a=>{s.data={theme:"facility-theme",taskId:this.taskId,serviceId:this.selected.selected[0].service.id,facilityId:this.selected.selected[0].facility.id,resource:a},this.dialog.open(Fs,s).afterClosed().subscribe(r=>{r&&(this.disableRemoveButton=!0,this.refreshTable())})})})}refreshTable(){this.loading=!0,this.tasksManager.getFacilityServicesState(this.facility.id).subscribe(e=>{this.servicesStates=e,this.selected.clear(),this.setAuthRights(),this.loading=!1})}setAuthRights(){this.propagationAuth=this.authResolver.isAuthorized("forceServicePropagation_Facility_Service_policy",[this.facility]),this.blockAuth=this.authResolver.isAuthorized("blockServiceOnFacility_Service_Facility_policy",[this.facility]),this.allowAuth=this.authResolver.isAuthorized("unblockServiceOnFacility_Service_Facility_policy",[this.facility]),this.deleteAuth=this.authResolver.isAuthorized("deleteTask_Task_policy",[this.facility]),this.routeAuth=this.authResolver.isAuthorized("getTaskResultsByTask_int_policy",[this.facility])}applyFilter(e){this.filterValue=e}selectionChanged(){this.disableBlockButton=!0,this.disableAllowButton=!0,this.disableRemoveButton=1!==this.selected.selected.length,this.disableRemoveButton||(this.taskIsNull=null===this.selected.selected[0].task);for(const e of this.selected.selected)e.blockedOnFacility?this.disableAllowButton=!1:this.disableBlockButton=!1}}return i.\u0275fac=function(e){return new(e||i)(t.Y36(f.Ob),t.Y36(f.KK),t.Y36(d.V6),t.Y36(h.sK),t.Y36(d.x4),t.Y36(f.IQ),t.Y36(f.xk),t.Y36(u.uw),t.Y36(d.fb))},i.\u0275cmp=t.Xpm({type:i,selectors:[["app-facility-service-status"]],decls:18,vars:14,consts:[[1,"page-subtitle"],[3,"refresh"],["class","mr-2","color","accent","mat-flat-button","",3,"disabled","click",4,"ngIf"],["class","mr-2","color","warn","mat-flat-button","",3,"disabled","click",4,"ngIf"],["mat-flat-button","","class","mr-2 dropdown-toggle","color","warn",3,"disabled","matMenuTriggerFor","matTooltipDisabled","matTooltip",4,"ngIf"],["menu","matMenu"],["mat-menu-item","",3,"click",4,"ngIf"],["mat-menu-item","",3,"click"],[3,"placeholder","filter"],["class","ml-auto mr-auto",4,"ngIf"],[3,"disableRouting","filterValue","servicesStatus","selection","tableId","selectionChange",4,"ngIf"],["color","accent","mat-flat-button","",1,"mr-2",3,"disabled","click"],["color","warn","mat-flat-button","",1,"mr-2",3,"disabled","click"],["mat-flat-button","","color","warn",1,"mr-2","dropdown-toggle",3,"disabled","matMenuTriggerFor","matTooltipDisabled","matTooltip"],[1,"ml-auto","mr-auto"],[3,"disableRouting","filterValue","servicesStatus","selection","tableId","selectionChange"]],template:function(e,s){1&e&&(t.TgZ(0,"div")(1,"h1",0),t._uU(2),t.ALo(3,"translate"),t.qZA(),t.TgZ(4,"perun-web-apps-refresh-button",1),t.NdJ("refresh",function(){return s.refreshTable()}),t.qZA(),t.YNc(5,_a,3,4,"button",2),t.YNc(6,ma,3,4,"button",2),t.YNc(7,ha,3,4,"button",3),t.YNc(8,fa,4,9,"button",4),t.TgZ(9,"mat-menu",null,5),t.YNc(11,ga,3,3,"button",6),t.TgZ(12,"button",7),t.NdJ("click",function(){return s.removeServiceFromFacility()}),t._uU(13),t.ALo(14,"translate"),t.qZA()(),t.TgZ(15,"perun-web-apps-immediate-filter",8),t.NdJ("filter",function(o){return s.applyFilter(o)}),t.qZA(),t.YNc(16,Ta,1,0,"mat-spinner",9),t.YNc(17,Sa,1,5,"perun-web-apps-services-status-list",10),t.qZA()),2&e&&(t.xp6(2),t.Oqu(t.lcZ(3,10,"FACILITY_DETAIL.SERVICES_STATUS.TITLE")),t.xp6(3),t.Q6J("ngIf",s.propagationAuth),t.xp6(1),t.Q6J("ngIf",s.allowAuth),t.xp6(1),t.Q6J("ngIf",s.blockAuth),t.xp6(1),t.Q6J("ngIf",s.deleteAuth),t.xp6(3),t.Q6J("ngIf",!s.taskIsNull),t.xp6(2),t.hij(" ",t.lcZ(14,12,"FACILITY_DETAIL.SERVICES_STATUS.REMOVE_SERVICE_FROM_FACILITY")," "),t.xp6(2),t.Q6J("placeholder","SHARED_LIB.PERUN.COMPONENTS.SERVICES_STATUS_LIST.TABLE_SEARCH"),t.xp6(1),t.Q6J("ngIf",s.loading),t.xp6(1),t.Q6J("ngIf",!s.loading))},dependencies:[m.O5,C.lW,T.Ou,U.gM,z.VK,z.OP,z.p6,O.t,D.L,da,h.X$]}),i})();var Aa=c(25610),Ia=c(76023);function ba(i,n){if(1&i){const e=t.EpF();t.TgZ(0,"th",21)(1,"mat-checkbox",22),t.NdJ("change",function(a){t.CHM(e);const o=t.oxw(2);return t.KtG(a?o.masterToggle():null)}),t.ALo(2,"translate"),t.ALo(3,"masterCheckboxLabel"),t.qZA()()}if(2&i){const e=t.oxw().ngIf,s=t.oxw();t.xp6(1),t.Q6J("aria-label",t.lcZ(2,3,t.lcZ(3,5,e.all)))("checked",s.selection.hasValue()&&e.all)("indeterminate",s.selection.hasValue()&&!e.all)}}const ya=function(i){return{name:i}};function va(i,n){if(1&i){const e=t.EpF();t.TgZ(0,"td",23)(1,"mat-checkbox",24),t.NdJ("change",function(a){const r=t.CHM(e).$implicit,_=t.oxw(2);return t.KtG(a?_.selection.toggle(r):null)})("click",function(a){return a.stopPropagation()}),t.ALo(2,"translate"),t.ALo(3,"checkboxLabel"),t.qZA()()}if(2&i){const e=n.$implicit,s=t.oxw(2);t.xp6(1),t.Q6J("aria-label",t.xi3(2,2,t.lcZ(3,5,s.selection.isSelected(e)),t.VKq(7,ya,e.destination.destination)))("checked",s.selection.isSelected(e))}}function xa(i,n){1&i&&(t.ynx(0,18),t.YNc(1,ba,4,7,"th",19),t.YNc(2,va,4,9,"td",20),t.BQk())}function Da(i,n){1&i&&(t.TgZ(0,"th",25),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&i&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"SHARED_LIB.PERUN.COMPONENTS.TASK_RESULTS_LIST.RESULT_ID")," "))}function Ea(i,n){if(1&i&&(t.TgZ(0,"td",26),t._uU(1),t.qZA()),2&i){const e=n.$implicit;t.xp6(1),t.Oqu(e.id)}}function La(i,n){1&i&&(t.TgZ(0,"th",25),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&i&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"SHARED_LIB.PERUN.COMPONENTS.TASK_RESULTS_LIST.DESTINATION")," "))}function Za(i,n){if(1&i&&(t.TgZ(0,"td",26),t.ALo(1,"multiWordDataCy"),t._uU(2),t.qZA()),2&i){const e=n.$implicit;t.uIk("data-cy",t.lcZ(1,2,e.destination.destination)),t.xp6(2),t.hij(" ",e.destination.destination," ")}}function Oa(i,n){1&i&&(t.TgZ(0,"th",25),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&i&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"SHARED_LIB.PERUN.COMPONENTS.TASK_RESULTS_LIST.TYPE")," "))}function Ra(i,n){if(1&i&&(t.TgZ(0,"td",26),t._uU(1),t.qZA()),2&i){const e=n.$implicit;t.xp6(1),t.hij(" ",e.destination.type.toUpperCase()," ")}}function Fa(i,n){1&i&&(t.TgZ(0,"th",25),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&i&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"SHARED_LIB.PERUN.COMPONENTS.TASK_RESULTS_LIST.SERVICE")," "))}function Na(i,n){if(1&i&&(t.TgZ(0,"td",26),t._uU(1),t.qZA()),2&i){const e=n.$implicit;t.xp6(1),t.hij(" ",e.service.name," ")}}function ka(i,n){1&i&&(t.TgZ(0,"th",25),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&i&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"SHARED_LIB.PERUN.COMPONENTS.TASK_RESULTS_LIST.STATUS")," "))}function wa(i,n){if(1&i&&(t.TgZ(0,"td",26),t._uU(1),t.qZA()),2&i){const e=n.$implicit;t.xp6(1),t.hij(" ",e.status," ")}}function Ya(i,n){1&i&&(t.TgZ(0,"th",25),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&i&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"SHARED_LIB.PERUN.COMPONENTS.TASK_RESULTS_LIST.TIME")," "))}function Ua(i,n){if(1&i&&(t.TgZ(0,"td",26),t._uU(1),t.ALo(2,"date"),t.qZA()),2&i){const e=n.$implicit;t.xp6(1),t.hij(" ",t.xi3(2,1,e.timestamp,"d.M.y H:mm:ss")," ")}}function Ma(i,n){1&i&&(t.TgZ(0,"th",25),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&i&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"SHARED_LIB.PERUN.COMPONENTS.TASK_RESULTS_LIST.RETURN_CODE")," "))}function Ja(i,n){if(1&i&&(t.TgZ(0,"td",26),t._uU(1),t.qZA()),2&i){const e=n.$implicit;t.xp6(1),t.hij(" ",e.returnCode," ")}}function Ha(i,n){1&i&&(t.TgZ(0,"th",25),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&i&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"SHARED_LIB.PERUN.COMPONENTS.TASK_RESULTS_LIST.STANDARD_MESSAGE")," "))}function Qa(i,n){if(1&i&&(t.TgZ(0,"span"),t._uU(1),t._UZ(2,"br"),t.qZA()),2&i){const e=n.$implicit;t.xp6(1),t.Oqu(e)}}function Ga(i,n){if(1&i&&(t.TgZ(0,"td",26),t.YNc(1,Qa,3,1,"span",27),t.qZA()),2&i){const e=n.$implicit;t.xp6(1),t.Q6J("ngForOf",e.standardMessage.split("\n"))}}function qa(i,n){1&i&&(t.TgZ(0,"th",25),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&i&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"SHARED_LIB.PERUN.COMPONENTS.TASK_RESULTS_LIST.ERROR_MESSAGE")," "))}function Pa(i,n){if(1&i&&(t.TgZ(0,"td",26),t._uU(1),t.qZA()),2&i){const e=n.$implicit;t.xp6(1),t.hij(" ",e.errorMessage," ")}}function Va(i,n){1&i&&t._UZ(0,"tr",28)}function Ba(i,n){if(1&i&&t._UZ(0,"tr",29),2&i){const e=n.$implicit;t.ekj("greenTableItem","DONE"===e.status)("redTableItem","ERROR"===e.status||"DENIED"===e.status)("yellowTableItem","WARNING"===e.status)}}function ja(i,n){1&i&&(t.TgZ(0,"perun-web-apps-alert",30),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&i&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"SHARED_LIB.UI.ALERTS.NO_FILTER_RESULTS_ALERT"),"\n"))}function Ka(i,n){1&i&&(t.TgZ(0,"perun-web-apps-alert",30),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&i&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"SHARED_LIB.PERUN.COMPONENTS.TASK_RESULTS_LIST.NO_RESULTS_WARNING"),"\n"))}const za=function(i){return{all:i}};let $a=(()=>{class i{constructor(e,s){this.authResolver=e,this.tableCheckbox=s,this.taskResults=[],this.selection=new A.Ov(!0,[]),this.displayedColumns=["select","id","destination","type","service","status","time","returnCode","standardMessage","errorMessage"],this.pageSizeOptions=p.f7}set matSort(e){this.sort=e,this.setDataSource()}static getSortDataForColumn(e,s){switch(s){case"id":return e.id.toString();case"destination":return e.destination.destination;case"type":return e.destination.type;case"service":return e.service.name;case"status":return e.status;case"time":return(0,m.p6)(e.timestamp.toString(),"yyyy.MM.dd HH:mm:ss","en");case"returnCode":return e.returnCode.toString();case"standardMessage":return e.standardMessage;case"errorMessage":return e.errorMessage;default:return""}}static getDataForColumn(e,s){switch(s){case"id":return e.id.toString();case"destination":return e.destination.destination;case"type":return e.destination.type;case"service":return e.service.name;case"status":return e.status;case"time":return(0,m.p6)(e.timestamp.toString(),"d.M.y H:mm:ss","en");case"returnCode":return e.returnCode.toString();case"standardMessage":return e.standardMessage;case"errorMessage":return e.errorMessage;default:return""}}ngOnChanges(){this.authResolver.isPerunAdminOrObserver()||(this.displayedColumns=this.displayedColumns.filter(e=>"id"!==e)),this.dataSource=new l.by(this.taskResults),this.setDataSource(),this.dataSource.filter=this.filterValue}exportAllData(e){(0,p.O6)((0,p.Xn)(this.dataSource.filteredData,this.displayedColumns,i.getDataForColumn),e)}exportDisplayedData(e){const s=this.dataSource.paginator.pageIndex*this.dataSource.paginator.pageSize,a=s+this.dataSource.paginator.pageSize;(0,p.O6)((0,p.Xn)(this.dataSource.sortData(this.dataSource.filteredData,this.dataSource.sort).slice(s,a),this.displayedColumns,i.getDataForColumn),e)}setDataSource(){this.dataSource&&(this.dataSource.sort=this.sort,this.dataSource.paginator=this.child.paginator,this.dataSource.filter=this.filterValue,this.dataSource.filterPredicate=(e,s)=>(0,p.Sd)(e,s,this.displayedColumns,i.getDataForColumn),this.dataSource.sortData=(e,s)=>(0,p.pR)(e,s,i.getSortDataForColumn))}isAllSelected(){return this.tableCheckbox.isAllSelected(this.selection.selected.length,this.dataSource)}masterToggle(){this.tableCheckbox.masterToggle(this.isAllSelected(),this.selection,this.filterValue,this.dataSource,this.sort,this.child.paginator.pageSize,this.child.paginator.pageIndex,!1)}ngAfterViewInit(){this.dataSource.paginator=this.child.paginator}}return i.\u0275fac=function(e){return new(e||i)(t.Y36(d.x4),t.Y36(d.UA))},i.\u0275cmp=t.Xpm({type:i,selectors:[["perun-web-apps-task-results-list"]],viewQuery:function(e,s){if(1&e&&(t.Gf(p.l9,7),t.Gf(I.YE,7)),2&e){let a;t.iGM(a=t.CRH())&&(s.child=a.first),t.iGM(a=t.CRH())&&(s.matSort=a.first)}},inputs:{taskResults:"taskResults",selection:"selection",filterValue:"filterValue",tableId:"tableId",displayedColumns:"displayedColumns"},features:[t.TTD],decls:36,vars:15,consts:[[1,"card","mt-3",3,"hidden"],[3,"tableId","dataLength","pageSizeOptions","exportDisplayedData","exportAllData"],["mat-table","","matSort","","matSortActive","time","matSortDirection","desc","matSortDisableClear","",1,"w-100",3,"dataSource"],["matColumnDef","select",4,"ngIf"],["matColumnDef","id"],["mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["class","static-column-size","mat-cell","",4,"matCellDef"],["matColumnDef","destination"],["matColumnDef","type"],["matColumnDef","service"],["matColumnDef","status"],["matColumnDef","time"],["matColumnDef","returnCode"],["matColumnDef","standardMessage"],["matColumnDef","errorMessage"],["mat-header-row","",4,"matHeaderRowDef"],["class","dark-hover-list-item","mat-row","",3,"greenTableItem","redTableItem","yellowTableItem",4,"matRowDef","matRowDefColumns"],["alert_type","warn",4,"ngIf"],["matColumnDef","select"],["mat-header-cell","","class","align-checkbox",4,"matHeaderCellDef"],["class","static-column-size align-checkbox","mat-cell","",4,"matCellDef"],["mat-header-cell","",1,"align-checkbox"],["color","primary",3,"aria-label","checked","indeterminate","change"],["mat-cell","",1,"static-column-size","align-checkbox"],["color","primary",3,"aria-label","checked","change","click"],["mat-header-cell","","mat-sort-header",""],["mat-cell","",1,"static-column-size"],[4,"ngFor","ngForOf"],["mat-header-row",""],["mat-row","",1,"dark-hover-list-item"],["alert_type","warn"]],template:function(e,s){1&e&&(t.TgZ(0,"div",0)(1,"perun-web-apps-table-wrapper",1),t.NdJ("exportDisplayedData",function(o){return s.exportDisplayedData(o)})("exportAllData",function(o){return s.exportAllData(o)}),t.TgZ(2,"table",2),t.YNc(3,xa,3,0,"ng-container",3),t.ALo(4,"isAllSelected"),t.ynx(5,4),t.YNc(6,Da,3,3,"th",5),t.YNc(7,Ea,2,1,"td",6),t.BQk(),t.ynx(8,7),t.YNc(9,La,3,3,"th",5),t.YNc(10,Za,3,4,"td",6),t.BQk(),t.ynx(11,8),t.YNc(12,Oa,3,3,"th",5),t.YNc(13,Ra,2,1,"td",6),t.BQk(),t.ynx(14,9),t.YNc(15,Fa,3,3,"th",5),t.YNc(16,Na,2,1,"td",6),t.BQk(),t.ynx(17,10),t.YNc(18,ka,3,3,"th",5),t.YNc(19,wa,2,1,"td",6),t.BQk(),t.ynx(20,11),t.YNc(21,Ya,3,3,"th",5),t.YNc(22,Ua,3,4,"td",6),t.BQk(),t.ynx(23,12),t.YNc(24,Ma,3,3,"th",5),t.YNc(25,Ja,2,1,"td",6),t.BQk(),t.ynx(26,13),t.YNc(27,Ha,3,3,"th",5),t.YNc(28,Ga,2,1,"td",6),t.BQk(),t.ynx(29,14),t.YNc(30,qa,3,3,"th",5),t.YNc(31,Pa,2,1,"td",6),t.BQk(),t.YNc(32,Va,1,0,"tr",15),t.YNc(33,Ba,1,6,"tr",16),t.qZA()()(),t.YNc(34,ja,3,3,"perun-web-apps-alert",17),t.YNc(35,Ka,3,3,"perun-web-apps-alert",17)),2&e&&(t.Q6J("hidden",0===s.dataSource.filteredData.length||0===s.taskResults.length),t.xp6(1),t.Q6J("tableId",s.tableId)("dataLength",s.dataSource.filteredData.length)("pageSizeOptions",s.pageSizeOptions),t.xp6(1),t.Q6J("dataSource",s.dataSource),t.xp6(1),t.Q6J("ngIf",t.VKq(13,za,t.xi3(4,10,s.dataSource,s.selection.selected.length))),t.xp6(29),t.Q6J("matHeaderRowDef",s.displayedColumns),t.xp6(1),t.Q6J("matRowDefColumns",s.displayedColumns),t.xp6(1),t.Q6J("ngIf",0===s.dataSource.filteredData.length&&0!==s.taskResults.length),t.xp6(1),t.Q6J("ngIf",0===s.taskResults.length))},dependencies:[m.sg,m.O5,L.oG,l.BZ,l.fO,l.as,l.w1,l.Dz,l.nj,l.ge,l.ev,l.XQ,l.Gk,I.YE,I.nU,Z.w,N.l,m.uU,h.X$,pt.R,k.I,w.G,Y.r],styles:[".greenTableItem[_ngcontent-%COMP%]{background-color:#c4ffcb}.yellowTableItem[_ngcontent-%COMP%]{background-color:#fffde7}.redTableItem[_ngcontent-%COMP%]{background-color:#ffcdd2}"]}),i})();function Xa(i,n){if(1&i){const e=t.EpF();t.TgZ(0,"button",7),t.NdJ("click",function(){t.CHM(e);const a=t.oxw();return t.KtG(a.removeTaskResult())}),t._uU(1),t.ALo(2,"translate"),t.qZA()}if(2&i){const e=t.oxw();t.Q6J("disabled",0===e.selection.selected.length),t.xp6(1),t.hij(" ",t.lcZ(2,2,"FACILITY_DETAIL.TASK_RESULTS.REMOVE"),"\n")}}function Wa(i,n){1&i&&t._UZ(0,"mat-spinner",8)}function tn(i,n){if(1&i&&t._UZ(0,"perun-web-apps-task-results-list",9),2&i){const e=t.oxw();t.Q6J("tableId",e.tableId)("displayedColumns",e.displayedColumns)("filterValue",e.filterValue)("selection",e.selection)("taskResults",e.taskResults)}}let en=(()=>{class i{constructor(e,s,a,o,r){this.route=e,this.taskManager=s,this.authResolver=a,this.dialog=o,this.entityStorageService=r,this.loading=!1,this.filterValue="",this.selection=new A.Ov(!0,[]),this.task={id:0},this.tableId=x.e5,this.displayedColumns=["select","id","destination","type","service","status","time","returnCode","standardMessage","errorMessage"],this.removeAuth=!1}ngOnInit(){this.loading=!0,this.facility=this.entityStorageService.getEntity(),this.removeAuth=this.authResolver.isAuthorized("deleteTask_Task_policy",[this.facility]),this.removeAuth||(this.displayedColumns=["id","destination","type","service","status","time","returnCode","standardMessage","errorMessage"]),this.route.params.subscribe(e=>{this.taskId=Number(e.taskId),this.taskManager.getTaskById(this.taskId).subscribe(s=>{this.task=s,this.refreshTable()})})}refreshTable(){this.loading=!0,this.taskManager.getTaskResultsForGUIByTask(this.taskId).subscribe(e=>{this.selection.clear(),this.taskResults=e,this.loading=!1})}removeTaskResult(){const e=(0,p.kZ)();e.width="600px",e.data={theme:"facility-theme",taskResults:this.selection.selected},this.dialog.open(ft,e).afterClosed().subscribe(a=>{a&&this.refreshTable()})}applyFilter(e){this.filterValue=e}}return i.\u0275fac=function(e){return new(e||i)(t.Y36(v.gz),t.Y36(f.Ob),t.Y36(d.x4),t.Y36(u.uw),t.Y36(d.fb))},i.\u0275cmp=t.Xpm({type:i,selectors:[["app-facility-task-results"]],decls:10,vars:9,consts:[[1,"page-subtitle"],[1,"text-muted"],[3,"refresh"],["class","mr-2","color","warn","mat-flat-button","",3,"disabled","click",4,"ngIf"],[3,"placeholder","filter"],["class","ml-auto mr-auto",4,"ngIf"],[3,"tableId","displayedColumns","filterValue","selection","taskResults",4,"ngIf"],["color","warn","mat-flat-button","",1,"mr-2",3,"disabled","click"],[1,"ml-auto","mr-auto"],[3,"tableId","displayedColumns","filterValue","selection","taskResults"]],template:function(e,s){1&e&&(t.TgZ(0,"h1",0),t._uU(1),t.ALo(2,"translate"),t.TgZ(3,"span",1),t._uU(4),t.qZA()(),t.TgZ(5,"perun-web-apps-refresh-button",2),t.NdJ("refresh",function(){return s.refreshTable()}),t.qZA(),t.YNc(6,Xa,3,4,"button",3),t.TgZ(7,"perun-web-apps-immediate-filter",4),t.NdJ("filter",function(o){return s.applyFilter(o)}),t.qZA(),t.YNc(8,Wa,1,0,"mat-spinner",5),t.YNc(9,tn,1,5,"perun-web-apps-task-results-list",6)),2&e&&(t.xp6(1),t.AsE(" ",t.lcZ(2,7,"FACILITY_DETAIL.TASK_RESULTS.TITLE")," - ",s.task.service?s.task.service.name:""," "),t.xp6(3),t.hij(" \xa0#",s.task.id," "),t.xp6(2),t.Q6J("ngIf",s.removeAuth),t.xp6(1),t.Q6J("placeholder","FACILITY_DETAIL.TASK_RESULTS.FILTER"),t.xp6(1),t.Q6J("ngIf",s.loading),t.xp6(1),t.Q6J("ngIf",!s.loading))},dependencies:[m.O5,C.lW,T.Ou,O.t,D.L,$a,h.X$]}),i})();var sn=c(20872);let an=(()=>{class i{constructor(e,s){this.dialogRef=e,this.data=s,this.theme=""}ngOnInit(){this.theme=this.data.theme}onCancel(){this.dialogRef.close(!1)}onSkip(){this.dialogRef.close(!0)}}return i.\u0275fac=function(e){return new(e||i)(t.Y36(u.so),t.Y36(u.WI))},i.\u0275cmp=t.Xpm({type:i,selectors:[["app-no-service-dialog"]],decls:14,vars:15,consts:[["mat-dialog-title",""],["mat-dialog-content",""],["matDialogActions",""],["mat-flat-button","",1,"ml-auto","mr-2",3,"click"],["color","accent","mat-flat-button","",3,"click"]],template:function(e,s){1&e&&(t.TgZ(0,"div")(1,"h1",0),t._uU(2),t.ALo(3,"translate"),t.qZA(),t.TgZ(4,"div",1),t._uU(5),t.ALo(6,"translate"),t.qZA(),t.TgZ(7,"div",2)(8,"button",3),t.NdJ("click",function(){return s.onCancel()}),t._uU(9),t.ALo(10,"translate"),t.qZA(),t.TgZ(11,"button",4),t.NdJ("click",function(){return s.onSkip()}),t._uU(12),t.ALo(13,"translate"),t.qZA()()()),2&e&&(t.Tol(s.theme),t.xp6(2),t.Oqu(t.lcZ(3,7,"DIALOGS.NO_SERVICE.TITLE")),t.xp6(3),t.hij(" ",t.lcZ(6,9,"DIALOGS.NO_SERVICE.INFO")," "),t.xp6(4),t.hij(" ",t.lcZ(10,11,"DIALOGS.NO_SERVICE.CANCEL")," "),t.xp6(3),t.hij(" ",t.lcZ(13,13,"DIALOGS.NO_SERVICE.SKIP")," "))},dependencies:[C.lW,u.uh,u.xY,u.H8,h.X$]}),i})(),nn=(()=>{class i{constructor(e,s){this.dialogRef=e,this.data=s,this.theme=""}ngOnInit(){this.theme=this.data.theme}onCancel(){this.dialogRef.close(!1)}onSkip(){this.dialogRef.close(!0)}}return i.\u0275fac=function(e){return new(e||i)(t.Y36(u.so),t.Y36(u.WI))},i.\u0275cmp=t.Xpm({type:i,selectors:[["app-config-unsaved-dialog"]],decls:14,vars:15,consts:[["mat-dialog-title",""],["mat-dialog-content",""],["matDialogActions",""],["mat-flat-button","",1,"ml-auto","mr-2",3,"click"],["color","accent","mat-flat-button","",3,"click"]],template:function(e,s){1&e&&(t.TgZ(0,"div")(1,"h1",0),t._uU(2),t.ALo(3,"translate"),t.qZA(),t.TgZ(4,"div",1),t._uU(5),t.ALo(6,"translate"),t.qZA(),t.TgZ(7,"div",2)(8,"button",3),t.NdJ("click",function(){return s.onCancel()}),t._uU(9),t.ALo(10,"translate"),t.qZA(),t.TgZ(11,"button",4),t.NdJ("click",function(){return s.onSkip()}),t._uU(12),t.ALo(13,"translate"),t.qZA()()()),2&e&&(t.Tol(s.theme),t.xp6(2),t.Oqu(t.lcZ(3,7,"DIALOGS.CONFIG_UNSAVED.TITLE")),t.xp6(3),t.hij(" ",t.lcZ(6,9,"DIALOGS.CONFIG_UNSAVED.INFO")," "),t.xp6(4),t.hij(" ",t.lcZ(10,11,"DIALOGS.CONFIG_UNSAVED.CANCEL")," "),t.xp6(3),t.hij(" ",t.lcZ(13,13,"DIALOGS.CONFIG_UNSAVED.SKIP")," "))},dependencies:[C.lW,u.uh,u.xY,u.H8,h.X$]}),i})();function on(i,n){if(1&i&&(t.TgZ(0,"div",3),t._UZ(1,"i",4),t.ALo(2,"translate"),t.qZA()),2&i){const e=t.oxw();t.xp6(1),t.Q6J("innerHTML",t.lcZ(2,1,e.info),t.oJD)}}function ln(i,n){if(1&i){const e=t.EpF();t.TgZ(0,"button",9),t.NdJ("click",function(){t.CHM(e);const a=t.oxw(2);return t.KtG(a.onKeep())}),t._uU(1),t.ALo(2,"translate"),t.qZA()}2&i&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"DIALOGS.CANCEL_CONFIG.KEEP")," "))}function cn(i,n){if(1&i){const e=t.EpF();t.TgZ(0,"div",5)(1,"button",6),t.NdJ("click",function(){t.CHM(e);const a=t.oxw();return t.KtG(a.onCancel())}),t._uU(2),t.ALo(3,"translate"),t.qZA(),t.TgZ(4,"button",7),t.NdJ("click",function(){t.CHM(e);const a=t.oxw();return t.KtG(a.onDelete())}),t.TgZ(5,"mat-icon"),t._uU(6," warning "),t.qZA(),t._uU(7),t.ALo(8,"translate"),t.qZA(),t.YNc(9,ln,3,3,"button",8),t.qZA()}if(2&i){const e=t.oxw();t.xp6(2),t.hij(" ",t.lcZ(3,3,"DIALOGS.CANCEL_CONFIG.CANCEL")," "),t.xp6(5),t.hij(" ",t.lcZ(8,5,"DIALOGS.CANCEL_CONFIG.DELETE")," "),t.xp6(2),t.Q6J("ngIf",!e.lastStep)}}let rn=(()=>{class i{constructor(e,s,a,o,r){this.dialogRef=e,this.data=s,this.facilityService=a,this.notificator=o,this.translate=r,this.theme="",this.title="",this.info="",this.loading=!1}ngOnInit(){this.theme=this.data.theme,this.lastStep=this.data.lastStep,this.lastStep?(this.title="DIALOGS.CANCEL_CONFIG.TITLE_COMPLETE",this.info="DIALOGS.CANCEL_CONFIG.INFO_COMPLETE"):(this.title="DIALOGS.CANCEL_CONFIG.TITLE_INCOMPLETE",this.info="DIALOGS.CANCEL_CONFIG.INFO_INCOMPLETE")}onCancel(){this.dialogRef.close(!1)}onDelete(){this.loading=!0,this.facilityService.deleteFacility(this.data.facilityId,!0).subscribe(()=>{this.notificator.showSuccess(this.translate.instant("DIALOGS.CANCEL_CONFIG.SUCCESS")),this.dialogRef.close(!0),this.loading=!1},()=>this.loading=!1)}onKeep(){this.dialogRef.close(!0)}}return i.\u0275fac=function(e){return new(e||i)(t.Y36(u.so),t.Y36(u.WI),t.Y36(f.IQ),t.Y36(d.V6),t.Y36(h.sK))},i.\u0275cmp=t.Xpm({type:i,selectors:[["app-cancel-configuration-dialog"]],decls:6,vars:8,consts:[["mat-dialog-title",""],["mat-dialog-content","",4,"ngIf"],["matDialogActions","",4,"ngIf"],["mat-dialog-content",""],[3,"innerHTML"],["matDialogActions",""],["mat-flat-button","",1,"mr-2",3,"click"],["color","warn","mat-flat-button","",1,"ml-auto","mr-2",3,"click"],["color","accent","mat-flat-button","",3,"click",4,"ngIf"],["color","accent","mat-flat-button","",3,"click"]],template:function(e,s){1&e&&(t.TgZ(0,"div")(1,"h1",0),t._uU(2),t.ALo(3,"translate"),t.qZA(),t.YNc(4,on,3,3,"div",1),t.YNc(5,cn,10,7,"div",2),t.qZA()),2&e&&(t.Tol(s.theme),t.xp6(2),t.Oqu(t.lcZ(3,6,s.title)),t.xp6(2),t.Q6J("ngIf",!s.loading),t.xp6(1),t.Q6J("ngIf",!s.loading))},dependencies:[m.O5,R.Hw,C.lW,u.uh,u.xY,u.H8,h.X$]}),i})();var Q=c(86257),G=c(37084),un=c(60205),pn=c(90439),dn=c(30540);const _n=["stepper"];function mn(i,n){1&i&&(t._uU(0),t.ALo(1,"translate")),2&i&&t.Oqu(t.lcZ(1,1,"FACILITY_CONFIGURATION.OWNERS"))}function hn(i,n){if(1&i){const e=t.EpF();t.TgZ(0,"app-facility-settings-owners",14),t.NdJ("ownerEmitter",function(a){t.CHM(e);const o=t.oxw();return t.KtG(o.owners=a)}),t.qZA()}}function fn(i,n){1&i&&(t._uU(0),t.ALo(1,"translate")),2&i&&t.Oqu(t.lcZ(1,1,"FACILITY_CONFIGURATION.HOSTS"))}function gn(i,n){if(1&i){const e=t.EpF();t.TgZ(0,"app-facility-hosts",15),t.NdJ("hostEmitter",function(a){t.CHM(e);const o=t.oxw();return t.KtG(o.hosts=a)}),t.qZA()}2&i&&t.Q6J("disableRouting",!0)}function Tn(i,n){1&i&&(t._uU(0),t.ALo(1,"translate")),2&i&&t.Oqu(t.lcZ(1,1,"FACILITY_CONFIGURATION.SERVICES"))}const Sn=function(){return["select","id","name","enabled","description"]};function Cn(i,n){if(1&i){const e=t.EpF();t.TgZ(0,"h1",16),t._uU(1),t.ALo(2,"translate"),t.qZA(),t.TgZ(3,"perun-web-apps-alert",17),t._uU(4),t.ALo(5,"translate"),t.qZA(),t.TgZ(6,"div",18)(7,"perun-web-apps-immediate-filter",19),t.NdJ("filter",function(a){t.CHM(e);const o=t.oxw();return t.KtG(o.applyFilter(a))}),t.qZA(),t.TgZ(8,"perun-web-apps-service-package-search-select",20),t.NdJ("packageSelected",function(a){t.CHM(e);const o=t.oxw();return t.KtG(o.packagesSelected(a))}),t.qZA()(),t.TgZ(9,"app-services-list",21),t.NdJ("selectionChanged",function(){t.CHM(e);const a=t.oxw();return t.KtG(a.singleServiceSelected())}),t.qZA()}if(2&i){const e=t.oxw();t.xp6(1),t.Oqu(t.lcZ(2,13,"FACILITY_CONFIGURATION.SERVICES")),t.xp6(3),t.hij(" ",t.lcZ(5,15,"FACILITY_CONFIGURATION.SERVICES_INFO")," "),t.xp6(3),t.Q6J("placeholder","FACILITY_CONFIGURATION.SERVICES_FILTER"),t.xp6(1),t.Q6J("disableAutoSelect",!0)("selectedPackage",e.selectedPackages)("multiple",!0)("servicePackages",e.servicePackages)("theme","facility-theme"),t.xp6(1),t.Q6J("disableRouting",!0)("displayedColumns",t.DdM(17,Sn))("selection",e.selection)("filterValue",e.filterValue)("services",e.services)}}function An(i,n){1&i&&(t._uU(0),t.ALo(1,"translate")),2&i&&t.Oqu(t.lcZ(1,1,"FACILITY_CONFIGURATION.SERVICE_CONFIG"))}function In(i,n){if(1&i){const e=t.EpF();t.TgZ(0,"perun-web-apps-service-search-select",27),t.NdJ("serviceSelected",function(a){t.CHM(e);const o=t.oxw(2);return t.KtG(o.filterAttributes(a))}),t.qZA()}if(2&i){const e=t.oxw(2);t.Q6J("disableAutoSelect",!0)("services",e.selection.selected)("multiple",!0)("theme","facility-theme")}}function bn(i,n){1&i&&t._UZ(0,"mat-spinner",28)}function yn(i,n){if(1&i&&t._UZ(0,"perun-web-apps-attributes-list",29),2&i){const e=t.oxw(2);t.Q6J("emptyListText","FACILITY_CONFIGURATION.EMPTY_REQ_ATT")("attributes",e.filteredAttributes)("selection",e.attSelection)}}function vn(i,n){if(1&i){const e=t.EpF();t.TgZ(0,"h1",16),t._uU(1),t.ALo(2,"translate"),t.qZA(),t.TgZ(3,"perun-web-apps-alert",17),t._uU(4),t.ALo(5,"translate"),t.qZA(),t.TgZ(6,"div",18)(7,"button",22),t.NdJ("click",function(){t.CHM(e);const a=t.oxw();return t.KtG(a.onRemoveAttributes())}),t._uU(8),t.ALo(9,"translate"),t.qZA(),t.TgZ(10,"button",23),t.NdJ("click",function(){t.CHM(e);const a=t.oxw();return t.KtG(a.onSaveAttributes())}),t._uU(11),t.ALo(12,"translate"),t.qZA(),t.YNc(13,In,1,4,"perun-web-apps-service-search-select",24),t.qZA(),t.YNc(14,bn,1,0,"mat-spinner",25),t.YNc(15,yn,1,3,"perun-web-apps-attributes-list",26)}if(2&i){const e=t.oxw(),s=t.MAs(5);t.xp6(1),t.Oqu(t.lcZ(2,9,"FACILITY_CONFIGURATION.SERVICE_CONFIG")),t.xp6(3),t.hij(" ",t.lcZ(5,11,"FACILITY_CONFIGURATION.ATT_INFO")," "),t.xp6(3),t.Q6J("disabled",0===e.attSelection.selected.length),t.xp6(1),t.hij(" ",t.lcZ(9,13,"FACILITY_CONFIGURATION.REMOVE")," "),t.xp6(2),t.Q6J("disabled",0===e.attSelection.selected.length),t.xp6(1),t.hij(" ",t.lcZ(12,15,"FACILITY_CONFIGURATION.SAVE")," "),t.xp6(2),t.Q6J("ngIf",s.selectedIndex===e.ATTRIBUTES_IDX),t.xp6(1),t.Q6J("ngIf",e.processing),t.xp6(1),t.Q6J("ngIf",!e.processing)}}function xn(i,n){1&i&&(t._uU(0),t.ALo(1,"translate")),2&i&&t.Oqu(t.lcZ(1,1,"FACILITY_CONFIGURATION.DESTINATION_CONFIG"))}const Dn=function(){return["select","destinationId","service","warn","destination","type","propagationType"]};function En(i,n){if(1&i){const e=t.EpF();t.TgZ(0,"app-perun-web-apps-facility-services-destinations",30),t.NdJ("destinationEmitter",function(a){t.CHM(e);const o=t.oxw();return t.KtG(o.destinations=a)}),t.qZA()}if(2&i){const e=t.oxw();t.Q6J("configServicesIds",e.serviceIds)("displayedColumns",t.DdM(5,Dn))("configServices",e.selection.selected)("loading",e.processing)("title","FACILITY_CONFIGURATION.DESTINATION_CONFIG")}}function Ln(i,n){1&i&&(t._uU(0),t.ALo(1,"translate")),2&i&&t.Oqu(t.lcZ(1,1,"FACILITY_CONFIGURATION.MANAGERS"))}function Zn(i,n){1&i&&t._UZ(0,"app-perun-web-apps-facility-settings-managers",31),2&i&&t.Q6J("disableRouting",!0)("disableSelf",!0)}function On(i,n){1&i&&(t._uU(0),t.ALo(1,"translate")),2&i&&t.Oqu(t.lcZ(1,1,"FACILITY_CONFIGURATION.SUMMARY"))}function Rn(i,n){1&i&&t._UZ(0,"mat-spinner",28)}const Fn=function(){return["id","name","contact","type"]};function Nn(i,n){if(1&i&&t._UZ(0,"perun-web-apps-owners-list",48),2&i){const e=t.oxw(3);t.Q6J("displayedColumns",t.DdM(2,Fn))("owners",e.owners)}}function kn(i,n){1&i&&t._UZ(0,"mat-spinner",28)}const wn=function(){return["id","name"]};function Yn(i,n){if(1&i&&t._UZ(0,"app-hosts-list",49),2&i){const e=t.oxw(3);t.Q6J("disableRouting",!0)("displayedColumns",t.DdM(3,wn))("hosts",e.hosts)}}function Un(i,n){1&i&&t._UZ(0,"mat-spinner",28)}const Mn=function(){return["id","name","enabled","script","description"]},Jn=function(){return["id","displayName","value","description"]},Hn=function(){return["destinationId","service","warn","destination","type","propagationType"]},Qn=function(){return["id","vo","name","description"]},Gn=function(){return["id","name","email","logins","organization"]};function qn(i,n){if(1&i){const e=t.EpF();t.TgZ(0,"mat-accordion")(1,"mat-expansion-panel",34)(2,"mat-expansion-panel-header")(3,"mat-panel-title"),t._UZ(4,"mat-icon",35),t._uU(5),t.ALo(6,"translate"),t.qZA()(),t.TgZ(7,"h1",16),t._uU(8),t.ALo(9,"translate"),t.qZA(),t.YNc(10,Rn,1,0,"mat-spinner",25),t.YNc(11,Nn,1,3,"perun-web-apps-owners-list",36),t.qZA(),t.TgZ(12,"mat-expansion-panel",34)(13,"mat-expansion-panel-header")(14,"mat-panel-title"),t._UZ(15,"mat-icon",37),t._uU(16),t.ALo(17,"translate"),t.qZA()(),t.TgZ(18,"h1",16),t._uU(19),t.ALo(20,"translate"),t.qZA(),t.YNc(21,kn,1,0,"mat-spinner",25),t.YNc(22,Yn,1,4,"app-hosts-list",38),t.qZA(),t.TgZ(23,"mat-expansion-panel",34)(24,"mat-expansion-panel-header")(25,"mat-panel-title"),t._UZ(26,"mat-icon",39),t._uU(27),t.ALo(28,"translate"),t.qZA()(),t.TgZ(29,"h1",16),t._uU(30),t.ALo(31,"translate"),t.qZA(),t._UZ(32,"app-services-list",40),t.qZA(),t.TgZ(33,"mat-expansion-panel",41),t.NdJ("opened",function(){t.CHM(e);const a=t.oxw(2);return t.KtG(a.getNonEmptyAttributes())}),t.TgZ(34,"mat-expansion-panel-header")(35,"mat-panel-title"),t._UZ(36,"mat-icon",37),t._uU(37),t.ALo(38,"translate"),t.qZA()(),t.TgZ(39,"h1",16),t._uU(40),t.ALo(41,"translate"),t.qZA(),t._UZ(42,"perun-web-apps-attributes-list",42),t.qZA(),t.TgZ(43,"mat-expansion-panel",43),t.NdJ("expandedChange",function(a){t.CHM(e);const o=t.oxw(2);return t.KtG(o.destinationServiceMissing=a)}),t.TgZ(44,"mat-expansion-panel-header")(45,"mat-panel-title"),t._UZ(46,"mat-icon",44),t._uU(47),t.ALo(48,"translate"),t.qZA()(),t.TgZ(49,"h1",16),t._uU(50),t.ALo(51,"translate"),t.qZA(),t.YNc(52,Un,1,0,"mat-spinner",25),t._UZ(53,"app-perun-web-apps-destination-list",45),t.qZA(),t.TgZ(54,"mat-expansion-panel")(55,"mat-expansion-panel-header")(56,"mat-panel-title"),t._UZ(57,"mat-icon",46),t._uU(58),t.ALo(59,"translate"),t.qZA()(),t._UZ(60,"app-managers-page",47),t.qZA()()}if(2&i){const e=t.oxw(2);t.Q6J("@.disabled",!0),t.xp6(1),t.Q6J("disabled",0===e.owners.length),t.xp6(1),t.ekj("cursor-default",0===e.owners.length),t.xp6(3),t.hij(" ",t.lcZ(6,49,"FACILITY_CONFIGURATION.OWNERS")," "),t.xp6(3),t.Oqu(t.lcZ(9,51,"FACILITY_CONFIGURATION.OWNERS")),t.xp6(2),t.Q6J("ngIf",e.processing),t.xp6(1),t.Q6J("ngIf",!e.processing),t.xp6(1),t.Q6J("disabled",0===e.hosts.length),t.xp6(1),t.ekj("cursor-default",0===e.hosts.length),t.xp6(3),t.hij(" ",t.lcZ(17,53,"FACILITY_CONFIGURATION.HOSTS")," "),t.xp6(3),t.Oqu(t.lcZ(20,55,"FACILITY_CONFIGURATION.HOSTS")),t.xp6(2),t.Q6J("ngIf",e.processing),t.xp6(1),t.Q6J("ngIf",!e.processing),t.xp6(1),t.Q6J("disabled",0===e.selection.selected.length),t.xp6(1),t.ekj("cursor-default",0===e.selection.selected.length),t.xp6(3),t.hij(" ",t.lcZ(28,57,"FACILITY_CONFIGURATION.SERVICES")," "),t.xp6(3),t.Oqu(t.lcZ(31,59,"FACILITY_CONFIGURATION.SERVICES")),t.xp6(2),t.Q6J("disableRouting",!0)("displayedColumns",t.DdM(71,Mn))("services",e.selection.selected),t.xp6(1),t.Q6J("disabled",0===e.selection.selected.length),t.xp6(1),t.ekj("cursor-default",0===e.selection.selected.length),t.xp6(3),t.hij(" ",t.lcZ(38,61,"FACILITY_CONFIGURATION.SERVICE_CONFIG")," "),t.xp6(3),t.Oqu(t.lcZ(41,63,"FACILITY_CONFIGURATION.ATTS")),t.xp6(2),t.Q6J("displayedColumns",t.DdM(72,Jn))("attributes",e.filteredAttributes)("emptyListText","FACILITY_CONFIGURATION.EMPTY_REQ_ATT"),t.xp6(1),t.Q6J("expanded",e.destinationServiceMissing)("disabled",0===e.selection.selected.length&&0===e.destinations.length),t.xp6(1),t.ekj("cursor-default",0===e.selection.selected.length&&0===e.destinations.length),t.xp6(3),t.hij(" ",t.lcZ(48,65,"FACILITY_CONFIGURATION.DESTINATION_CONFIG")," "),t.xp6(3),t.Oqu(t.lcZ(51,67,"FACILITY_CONFIGURATION.DESTINATION")),t.xp6(2),t.Q6J("ngIf",e.processing),t.xp6(1),t.Q6J("destinations",e.destinations)("displayedColumns",t.DdM(73,Hn))("services",e.serviceIds),t.xp6(5),t.hij(" ",t.lcZ(59,69,"FACILITY_CONFIGURATION.MANAGERS")," "),t.xp6(2),t.Q6J("complementaryObject",e.facility)("configMode",!0)("disableRouting",!0)("availableRoles",e.availableRoles)("complementaryObjectType","Facility")("displayedGroupColumns",t.DdM(74,Qn))("displayedUserColumns",t.DdM(75,Gn))}}function Pn(i,n){if(1&i&&(t.TgZ(0,"perun-web-apps-alert",17),t._UZ(1,"i",32),t.ALo(2,"translate"),t.qZA(),t.YNc(3,qn,61,76,"mat-accordion",33)),2&i){t.oxw();const e=t.MAs(5);t.xp6(1),t.Q6J("innerHTML",t.lcZ(2,2,"FACILITY_CONFIGURATION.SUMMARY_INFO"),t.oJD),t.xp6(2),t.Q6J("ngIf",e.selectedIndex===e.steps.length-1)}}function Vn(i,n){if(1&i){const e=t.EpF();t.TgZ(0,"button",50),t.NdJ("click",function(){t.CHM(e);const a=t.oxw();return t.KtG(a.back())}),t._uU(1),t.ALo(2,"translate"),t.qZA()}2&i&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"FACILITY_CONFIGURATION.BACK")," "))}function Bn(i,n){if(1&i){const e=t.EpF();t.TgZ(0,"button",51),t.NdJ("click",function(){t.CHM(e);const a=t.oxw();return t.KtG(a.next())}),t._uU(1),t.ALo(2,"translate"),t.qZA()}if(2&i){t.oxw();const e=t.MAs(5);t.ekj("mr-2",void 0!==e&&0!==e.selectedIndex)("ml-auto",!(void 0!==e&&0!==e.selectedIndex)),t.xp6(1),t.hij(" ",t.lcZ(2,5,"FACILITY_CONFIGURATION.NEXT")," ")}}function jn(i,n){if(1&i){const e=t.EpF();t.TgZ(0,"button",52),t.NdJ("click",function(){t.CHM(e);const a=t.oxw();return t.KtG(a.onFinish())}),t._uU(1),t.ALo(2,"translate"),t.qZA()}2&i&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"FACILITY_CONFIGURATION.FINISH")," "))}let Kn=(()=>{class i{constructor(e,s,a,o,r,_,S,b,E,y){this.attributesManager=e,this.serviceManager=s,this.facilityService=a,this.cd=o,this.dialog=r,this.notificator=_,this.translate=S,this.router=b,this.guiAuthResolver=E,this.entityStorageService=y,this.processing=!1,this.filteredAttributes=[],this.attSelection=new A.Ov(!0,[]),this.services=[],this.serviceIds=new Set,this.servicePackages=[],this.selectedPackages=[],this.selection=new A.Ov(!0,[]),this.owners=[],this.hosts=[],this.destinations=[],this.destinationServiceMissing=!1,this.availableRoles=[],this.filterValue="",this.ATTRIBUTES_IDX=3,this.serviceControl=new g.p4(!1,g.kI.requiredTrue),this.attributesControl=new g.p4(!0,g.kI.requiredTrue),this.allowNavigate=!1,this.attributes=[],this.attributeIds=new Set,this.attributesPerService=new Map,this.servicesPerPackage=new Map,this.saveMsg="",this.removeMsg="",this.BEFORE_OPTIONAL_IDX=2,this.DESTINATIONS_IDX=4,this.AFTER_OPTIONAL_IDX=5,this.translate.get("FACILITY_CONFIGURATION.ATT_SAVED").subscribe(X=>this.saveMsg=X),this.translate.get("FACILITY_CONFIGURATION.ATT_REMOVED").subscribe(X=>this.removeMsg=X)}ngOnInit(){this.facility=this.entityStorageService.getEntity(),this.guiAuthResolver.assignAvailableRoles(this.availableRoles,"Facility"),this.serviceManager.getServicesPackages().subscribe(e=>{this.servicePackages=e,this.getServicePackageServices(e,0)})}ngAfterViewInit(){this.cd.detectChanges(),this.attSelection.changed.subscribe(()=>{this.attributesControl.setValue(0===this.attSelection.selected.length)})}onCancel(){const e=(0,p.kZ)();e.width="550px",e.data={facilityId:this.facility.id,lastStep:this.stepper.selectedIndex===this.stepper.steps.length-1,theme:"facility-theme"},this.dialog.open(rn,e).afterClosed().subscribe(a=>{a&&(this.allowNavigate=!0,sessionStorage.removeItem("newFacilityId"),this.router.navigate(["facilities"],{queryParamsHandling:"merge"}))})}packagesSelected(e){if(this.packageSelectionEqual(e))return;this.processing=!0;let s=new Set;if(e&&0!==e.length?s=this.setSymDif(this.selectedPackages,e):this.selectedPackages.forEach(r=>{this.servicesPerPackage.get(r.id).forEach(_=>s.add(_))}),0===s.size)return;const a=this.filterService(s,e.filter(r=>this.selectedPackages.findIndex(_=>_.id===r.id)<0)),o=this.filterService(s,this.selectedPackages.filter(r=>e.findIndex(_=>_.id===r.id)<0));for(const r of this.services)a.has(r.id)?this.selection.select(r):o.has(r.id)&&this.selection.deselect(r);this.selectedPackages=e,this.setServiceControl(),this.processing=!1}singleServiceSelected(){this.setServiceControl(),!this.processing&&this.checkPackageComplete()}back(){this.stepper.selectedIndex<=this.BEFORE_OPTIONAL_IDX&&this.setServiceControl(),this.stepper.selectedIndex===this.AFTER_OPTIONAL_IDX&&0===this.selection.selected.length?this.stepper.selectedIndex=this.BEFORE_OPTIONAL_IDX:this.stepper.previous()}onSaveAttributes(){return new Promise((e,s)=>{this.processing=!0,this.attributesManager.setFacilityAttributes({facility:this.facility.id,attributes:this.attSelection.selected}).subscribe({next:()=>{this.notificator.showSuccess(this.saveMsg),this.attSelection.clear(),this.processing=!1,e()},error:()=>{this.processing=!1,s()}})})}next(){this.checkDestinationDependency(this.stepper.selectedIndex),this.stepper.selectedIndex===this.BEFORE_OPTIONAL_IDX?0===this.selection.selected.length?this.openSkipDialog():(this.getRequiredAttributes(),this.stepper.next()):this.stepper.selectedIndex===this.ATTRIBUTES_IDX&&0!==this.attSelection.selected.length?this.openUnsavedAttsDialog():this.stepper.next()}onFinish(){this.allowNavigate=!0,sessionStorage.removeItem("newFacilityId"),this.router.navigate(["facilities",this.facility.id],{queryParamsHandling:"merge"})}onRemoveAttributes(){this.processing=!0;const e=this.attSelection.selected.map(s=>s.id);this.attributesManager.removeFacilityAttributes(this.facility.id,e).subscribe({next:()=>{this.notificator.showSuccess(this.removeMsg),this.getRequiredAttributes(),this.processing=!1},error:()=>this.processing=!1})}filterAttributes(e){if(void 0===e||0===e.length)return void(this.filteredAttributes=this.attributes);const s=new Set;for(const a of e)this.attributesPerService.get(a.id).forEach(o=>s.add(o));this.filteredAttributes=[];for(const a of this.attributes)s.has(a.id)&&this.filteredAttributes.push(a)}getNonEmptyAttributes(){this.filteredAttributes=this.attributes.filter(e=>{if(e.value&&(!Array.isArray(e.value)||0!==e.value.length))return e})}navigationStep(e){this.checkDestinationDependency(e.previouslySelectedIndex),e.selectedIndex===this.ATTRIBUTES_IDX?this.getRequiredAttributes():e.selectedIndex===this.DESTINATIONS_IDX?this.processing=!1:e.selectedIndex<=this.BEFORE_OPTIONAL_IDX&&this.setServiceControl()}applyFilter(e){this.filterValue=e}canDeactivate(){return this.allowNavigate||this.onCancel(),this.allowNavigate}getServicePackageServices(e,s){s===e.length?this.serviceManager.getServices().subscribe(a=>{this.services=a}):this.serviceManager.getServicesFromServicesPackage(e[s].id).subscribe(a=>{this.servicesPerPackage.set(e[s].id,new Set([...a.map(o=>o.id)])),this.getServicePackageServices(e,s+1)})}getServiceRequiredAttributes(e,s){s!==e.length&&this.attributesManager.getRequiredAttributesDefinition(e[s].id).subscribe(a=>{a=a.filter(o=>this.attributeIds.has(o.id)),this.attributesPerService.set(e[s].id,a.map(o=>o.id)),this.getServiceRequiredAttributes(e,s+1)})}setServiceControl(){this.serviceControl.setValue(0!==this.selection.selected.length)}buildServiceSet(e){const s=new Set;return e.forEach(a=>{this.servicesPerPackage.get(a.id).forEach(o=>s.add(o))}),s}setDiff(e,s){return new Set([...e].filter(a=>!s.has(a)))}setIntersect(e,s){return new Set([...e].filter(a=>s.has(a)))}setSymDif(e,s){const a=this.buildServiceSet(e),o=this.buildServiceSet(s),r=this.setDiff(a,o),_=this.setDiff(o,a);return new Set([...r,..._])}filterService(e,s){const a=new Set;for(const o of s){const r=this.setIntersect(e,this.servicesPerPackage.get(o.id));0!==r.size&&r.forEach(_=>a.add(_))}return a}packageSelectionEqual(e){return e.length===this.selectedPackages.length&&(e.forEach(s=>{if(-1===this.selectedPackages.findIndex(a=>a.id===s.id))return!1}),!0)}checkPackageComplete(){const e=[];for(const s of this.selectedPackages){let a=!0;for(const o of this.servicesPerPackage.get(s.id))if(-1===this.selection.selected.findIndex(r=>r.id===o)){a=!1;break}a&&e.push(s)}this.selectedPackages=e}openSkipDialog(){const e=(0,p.kZ)();e.width="400px",e.data={theme:"facility-theme"},this.dialog.open(an,e).afterClosed().subscribe(a=>{a&&(this.serviceControl.setValue(!0),this.stepper.selectedIndex=this.AFTER_OPTIONAL_IDX)})}getRequiredAttributes(){this.processing=!0,this.attributesManager.getRequiredAttributesFacilityServices(this.selection.selected.map(e=>e.id),this.facility.id).subscribe(e=>{this.attSelection.clear(),this.attributes=e.filter(s=>!(0,p.Hm)(s)),this.filteredAttributes=this.attributes,this.attributes.forEach(s=>this.attributeIds.add(s.id)),this.getServiceRequiredAttributes(this.selection.selected,0),this.processing=!1})}openUnsavedAttsDialog(){const e=(0,p.kZ)();e.width="400px",e.data={theme:"facility-theme"},this.dialog.open(nn,e).afterClosed().subscribe(a=>{a&&this.onSaveAttributes().then(()=>{this.stepper.next()},()=>this.getRequiredAttributes())})}checkDestinationDependency(e){(e===this.BEFORE_OPTIONAL_IDX||e===this.DESTINATIONS_IDX)&&(this.serviceIds=new Set([...this.selection.selected.map(s=>s.id)]),this.destinationServicePresent())}destinationServicePresent(){for(const e of this.destinations)if(!this.serviceIds.has(e.service.id))return void(this.destinationServiceMissing=!0);this.destinationServiceMissing=!1}}return i.\u0275fac=function(e){return new(e||i)(t.Y36(f.H8),t.Y36(f.KK),t.Y36(f.IQ),t.Y36(t.sBO),t.Y36(u.uw),t.Y36(d.V6),t.Y36(h.sK),t.Y36(v.F0),t.Y36(d.x4),t.Y36(d.fb))},i.\u0275cmp=t.Xpm({type:i,selectors:[["app-facility-configuration-page"]],viewQuery:function(e,s){if(1&e&&t.Gf(_n,5),2&e){let a;t.iGM(a=t.CRH())&&(s.stepper=a.first)}},decls:34,vars:15,consts:[[1,"facility-theme"],[1,"page-title"],[3,"linear","selectionChange"],["stepper",""],["matStepLabel",""],["matStepContent",""],[3,"stepControl"],["optional","true",3,"editable","stepControl"],[3,"editable","optional"],[1,"actions"],["mat-flat-button","",3,"click"],["class","ml-auto mr-2","mat-flat-button","",3,"click",4,"ngIf"],["color","accent","mat-flat-button","",3,"mr-2","ml-auto","click",4,"ngIf"],["class","mr-2","color","accent","mat-flat-button","",3,"click",4,"ngIf"],[3,"ownerEmitter"],[3,"disableRouting","hostEmitter"],[1,"page-subtitle"],["alert_type","info"],[1,"filters"],[1,"filter",3,"placeholder","filter"],[1,"package-search-select",3,"disableAutoSelect","selectedPackage","multiple","servicePackages","theme","packageSelected"],[3,"disableRouting","displayedColumns","selection","filterValue","services","selectionChanged"],["color","warn","mat-flat-button","",1,"mr-2",3,"disabled","click"],["color","accent","mat-flat-button","",1,"mr-2",3,"disabled","click"],["class","service-search-select",3,"disableAutoSelect","services","multiple","theme","serviceSelected",4,"ngIf"],["class","ml-auto mr-auto",4,"ngIf"],[3,"emptyListText","attributes","selection",4,"ngIf"],[1,"service-search-select",3,"disableAutoSelect","services","multiple","theme","serviceSelected"],[1,"ml-auto","mr-auto"],[3,"emptyListText","attributes","selection"],[3,"configServicesIds","displayedColumns","configServices","loading","title","destinationEmitter"],[3,"disableRouting","disableSelf"],[3,"innerHTML"],[4,"ngIf"],[3,"disabled"],["svgIcon","perun-owner-grey",1,"mr-2"],[3,"displayedColumns","owners",4,"ngIf"],["svgIcon","perun-hosts",1,"mr-2"],[3,"disableRouting","displayedColumns","hosts",4,"ngIf"],["svgIcon","perun-service",1,"mr-2"],[3,"disableRouting","displayedColumns","services"],[3,"disabled","opened"],[3,"displayedColumns","attributes","emptyListText"],[3,"expanded","disabled","expandedChange"],["svgIcon","perun-service_destination",1,"mr-2"],[3,"destinations","displayedColumns","services"],["svgIcon","perun-manager",1,"mr-2"],[3,"complementaryObject","configMode","disableRouting","availableRoles","complementaryObjectType","displayedGroupColumns","displayedUserColumns"],[3,"displayedColumns","owners"],[3,"disableRouting","displayedColumns","hosts"],["mat-flat-button","",1,"ml-auto","mr-2",3,"click"],["color","accent","mat-flat-button","",3,"click"],["color","accent","mat-flat-button","",1,"mr-2",3,"click"]],template:function(e,s){if(1&e&&(t.TgZ(0,"div",0)(1,"div",1),t._uU(2),t.ALo(3,"translate"),t.qZA(),t.TgZ(4,"mat-stepper",2,3),t.NdJ("selectionChange",function(o){return s.navigationStep(o)}),t.TgZ(6,"mat-step"),t.YNc(7,mn,2,3,"ng-template",4),t.YNc(8,hn,1,0,"ng-template",5),t.qZA(),t.TgZ(9,"mat-step"),t.YNc(10,fn,2,3,"ng-template",4),t.YNc(11,gn,1,1,"ng-template",5),t.qZA(),t.TgZ(12,"mat-step",6),t.YNc(13,Tn,2,3,"ng-template",4),t.YNc(14,Cn,10,18,"ng-template",5),t.qZA(),t.TgZ(15,"mat-step",7),t.YNc(16,An,2,3,"ng-template",4),t.YNc(17,vn,16,17,"ng-template",5),t.qZA(),t.TgZ(18,"mat-step",8),t.YNc(19,xn,2,3,"ng-template",4),t.YNc(20,En,1,6,"ng-template",5),t.qZA(),t.TgZ(21,"mat-step"),t.YNc(22,Ln,2,3,"ng-template",4),t.YNc(23,Zn,1,2,"ng-template",5),t.qZA(),t.TgZ(24,"mat-step"),t.YNc(25,On,2,3,"ng-template",4),t.YNc(26,Pn,4,4,"ng-template",5),t.qZA()(),t.TgZ(27,"div",9)(28,"button",10),t.NdJ("click",function(){return s.onCancel()}),t._uU(29),t.ALo(30,"translate"),t.qZA(),t.YNc(31,Vn,3,3,"button",11),t.YNc(32,Bn,3,7,"button",12),t.YNc(33,jn,3,3,"button",13),t.qZA()()),2&e){const a=t.MAs(5);t.xp6(2),t.hij(" ",t.lcZ(3,11,"FACILITY_CONFIGURATION.TITLE")," "),t.xp6(2),t.Q6J("linear",!0),t.xp6(8),t.Q6J("stepControl",s.serviceControl),t.xp6(3),t.Q6J("editable",0!==s.selection.selected.length)("stepControl",s.attributesControl),t.xp6(3),t.Q6J("editable",0!==s.selection.selected.length||0!==s.destinations.length)("optional",0===s.destinations.length),t.xp6(11),t.hij(" ",t.lcZ(30,13,"FACILITY_CONFIGURATION.CANCEL")," "),t.xp6(2),t.Q6J("ngIf",void 0!==a&&0!==a.selectedIndex),t.xp6(1),t.Q6J("ngIf",void 0!==a&&a.selectedIndex!==a.steps.length-1),t.xp6(1),t.Q6J("ngIf",void 0!==a&&a.selectedIndex===a.steps.length-1)}},dependencies:[m.O5,R.Hw,C.lW,T.Ou,Q.C0,Q.VY,Q.Vq,Q.BY,G.pp,G.ib,G.yz,G.yK,ot.s,ct.q,_t,un.Q,Z.w,D.L,ht.p,j.Q,pn.F,dn.J,lt,rt,ut,mt,h.X$],styles:[".icon-scale[_ngcontent-%COMP%]{transform:scale(1.7);margin-left:.5rem;margin-top:-.6rem;margin-right:.9rem}.filters[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;align-items:baseline}.package-search-select[_ngcontent-%COMP%]{width:650px}.service-search-select[_ngcontent-%COMP%]{width:400px}.filter[_ngcontent-%COMP%]{width:350px;margin-right:20px}.actions[_ngcontent-%COMP%]{background-color:#fff;display:flex;padding:20px}.cursor-default[_ngcontent-%COMP%]{cursor:default}"]}),i})(),Tt=(()=>{class i{constructor(e){this.router=e}canActivate(e){return e.parent.params.facilityId===sessionStorage.getItem("newFacilityId")||(this.router.navigate(["/home"],{queryParamsHandling:"merge"}),!1)}canDeactivate(e){return e.canDeactivate()}}return i.\u0275fac=function(e){return new(e||i)(t.LFG(v.F0))},i.\u0275prov=t.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i})();var $=c(71992);const zn=[{path:"",component:tt.P,canActivateChild:[$.a],children:[{path:"",component:tt.P,data:{animation:"FacilitySelectPage"}}]},{path:":facilityId",component:Rt,canActivateChild:[$.a],children:[{path:"",component:kt,data:{animation:"FacilityOverviewPage"}},{path:"attributes",component:$t,data:{animation:"FacilityAttributesPage"}},{path:"resources",component:wt.f,data:{animation:"FacilityResourcesPage"}},{path:"allowed-users",component:Aa._,data:{animation:"FacilityAllowedUsersPage"}},{path:"allowed-groups",component:Yt.o,data:{animation:"FacilityAllowedGroupsPage"}},{path:"services-status",component:Ca,data:{animation:"FacilityServiceStatusPage"}},{path:"services-status/:taskId",component:en,data:{animation:"FacilityTaskResultsPage"}},{path:"service-config",component:de,data:{animation:"FacilityServiceConfigPage"}},{path:"services-destinations",component:rt,data:{animation:"FacilityServicesDestinationsPage"}},{path:"hosts",component:mt,data:{animation:"FacilityHostsPage"}},{path:"hosts/:hostId",component:Ki,data:{animation:"FacilityHostsDetailPage"}},{path:"settings",component:Jt,children:[{path:"",component:Gt,data:{animation:"FacilitySettingsOverviewPage"}},{path:"owners",component:ut,data:{animation:"FacilitySettingOwnersPage"}},{path:"managers",component:lt,data:{animation:"FacilitySettingsManagersPage"}},{path:"security-teams",component:ms,data:{animation:"FacilitySecurityTeamsPage"}},{path:"blacklist",component:Qi,data:{animation:"FacilitySettingsBlackListPage"}}]},{path:"configuration",component:Kn,canActivate:[Tt],canDeactivate:[Tt]}]},{path:":facilityId/resources/:resourceId",component:Ut.b,canActivateChild:[$.a],children:[{path:"",component:Mt.H,data:{animation:"ResourceOverviewPage"}},{path:"attributes",component:te.X,data:{animation:"ResourceAttributesPage"}},{path:"groups",component:ee.K,data:{animation:"ResourceGroupsComponent"}},{path:"services",component:fs.D,data:{animation:"ResourceAssignedServicesComponent"}},{path:"members",component:Ia.y,data:{animation:"ResourceAssignedMembersComponent"}},{path:"tags",component:sn.v,data:{animation:"ResourceTagsComponent"}},{path:"settings",component:Xt.t,children:[{path:"",component:Wt.h,data:{animation:"ResourceSettingsOverviewPage"}},{path:"managers",component:hs.O,data:{animation:"ResourceSettingsManagersPage"}}]}]}];let $n=(()=>{class i{}return i.\u0275fac=function(e){return new(e||i)},i.\u0275mod=t.oAB({type:i}),i.\u0275inj=t.cJS({imports:[v.Bz.forChild(zn),v.Bz]}),i})();var Xn=c(14264),Wn=c(63189),to=c(38338),eo=c(82745);let io=(()=>{class i{}return i.\u0275fac=function(e){return new(e||i)},i.\u0275mod=t.oAB({type:i}),i.\u0275inj=t.cJS({providers:[V.dp],imports:[m.ez,$n,Xn.m,Wn.r,Gi.ez,V.d4,to.UsersModule,eo.AdminModule]}),i})()}}]);